# ğŸ¯ **æ—§ç³»ç»Ÿæ¸…ç† - ç»†åŒ–æ‰§è¡Œå¾…åŠæ¸…å•**

> åŸºäºéªŒè¯åçš„è¿ç§»è®¡åˆ’v2.0ï¼Œåˆ¶å®šå¯ç›´æ¥æ‰§è¡Œçš„ç»†åˆ†ä»»åŠ¡æ¸…å•

---

## ğŸ“… **P0 ç´§æ€¥ä»»åŠ¡ - Day 1ï¼ˆé¢„è®¡8-10å°æ—¶ï¼‰**

### âœ… **ä»»åŠ¡ç»„1ï¼šStreamCacheService é—ç•™ä»£ç æ¸…ç†ï¼ˆ4-6å°æ—¶ï¼‰**

#### å‡†å¤‡å·¥ä½œï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] åˆ›å»ºä»Šæ—¥å·¥ä½œåˆ†æ”¯ï¼š`git checkout -b cleanup/stream-cache-legacy`
- [ ] åˆ›å»ºå¤‡ä»½ç›®å½•ï¼š`mkdir -p backup/$(date +%Y%m%d)`
- [ ] å¤‡ä»½é—ç•™æ–‡ä»¶ï¼š`cp src/core/05-caching/module/stream-cache/services/stream-cache.service.ts.legacy backup/$(date +%Y%m%d)/`

#### æ‰§è¡Œæ¸…ç†ï¼ˆ1å°æ—¶ï¼‰
- [ ] åˆ é™¤é—ç•™æ–‡ä»¶ï¼š`rm src/core/05-caching/module/stream-cache/services/stream-cache.service.ts.legacy`
- [ ] æ‰“å¼€ `src/core/05-caching/module/stream-cache/module/stream-cache.module.ts`
- [ ] åˆ é™¤ç¬¬133-134è¡Œçš„ Provider é…ç½®ï¼š`provide: 'StreamCacheService'`
- [ ] åˆ é™¤ç¬¬142è¡Œçš„ Export é…ç½®ï¼š`'StreamCacheService'`
- [ ] ä¿å­˜æ–‡ä»¶

#### éªŒè¯æµ‹è¯•ï¼ˆ2-3å°æ—¶ï¼‰
- [ ] è¿è¡Œæ ‡å‡†åŒ–æœåŠ¡æµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:unit:cache --testNamePattern="StreamCacheStandardized"`
- [ ] è¿è¡Œå®Œæ•´ç¼“å­˜æ¨¡å—æµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:unit:cache`
- [ ] è¿è¡Œé›†æˆæµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:integration:cache`
- [ ] åº”ç”¨å¯åŠ¨æµ‹è¯•ï¼š`timeout 30s DISABLE_AUTO_INIT=false bun run start`
- [ ] ç¡®è®¤æ‰€æœ‰æµ‹è¯•é€šè¿‡

#### æ”¶å°¾å·¥ä½œï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] æäº¤ä»£ç ï¼š`git add -A && git commit -m "chore: ç§»é™¤StreamCacheServiceé—ç•™ä»£ç "`
- [ ] è®°å½•å®ŒæˆçŠ¶æ€å’Œæµ‹è¯•ç»“æœ

---

### âœ… **ä»»åŠ¡ç»„2ï¼šProcessingTime å­—æ®µè¿ç§»ï¼ˆ6-8å°æ—¶ï¼‰**

#### å‡†å¤‡å·¥ä½œï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] åˆ›å»ºåˆ†æ”¯ï¼š`git checkout -b cleanup/processing-time-field`
- [ ] ç¡®è®¤å½±å“èŒƒå›´ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
- [ ] å¤‡ä»½ç›¸å…³æ–‡ä»¶

#### å­—æ®µé‡å‘½åï¼ˆ2å°æ—¶ï¼‰
- [ ] ä¿®æ”¹ `src/core/01-entry/stream-receiver/interfaces/data-processing.interface.ts`
  - [ ] å°†ç¬¬59è¡Œ `processingTime: number` æ”¹ä¸º `processingTimeMs: number`
- [ ] ä¿®æ”¹ `src/core/01-entry/stream-receiver/services/stream-data-processor.service.ts`
  - [ ] å°†ç¬¬458è¡Œå‡½æ•°å‚æ•° `processingTime` æ”¹ä¸º `processingTimeMs`
  - [ ] å°†ç¬¬461è¡Œ `this.dataProcessingStats.totalProcessingTime` æ”¹ä¸º `totalProcessingTimeMs`
- [ ] ä¿®æ”¹ `src/monitoring/config/unified/monitoring-events.config.ts`
  - [ ] å°†ç¬¬951è¡Œ `processingTimeoutMs` ä¿æŒä¸å˜ï¼ˆå·²ç»æ˜¯æ­£ç¡®å‘½åï¼‰
- [ ] ä¿®æ”¹ `src/monitoring/config/unified/monitoring-enhanced.config.ts`
  - [ ] å°†ç¬¬528è¡Œå¼•ç”¨æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ›´æ–° `src/common/interfaces/time-fields.interface.ts` ä¸­çš„æ³¨é‡Šè¯´æ˜

#### è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼ˆ1å°æ—¶ï¼‰
- [ ] è¿è¡ŒESLintåºŸå¼ƒå­—æ®µæ£€æµ‹ï¼š`bun run lint:deprecated-fields`
- [ ] è¿è¡Œå®Œæ•´ESLintï¼š`bun run lint`
- [ ] ä¿®å¤æ‰€æœ‰ESLintæŠ¥å‘Šçš„é—®é¢˜

#### éªŒè¯æµ‹è¯•ï¼ˆ2å°æ—¶ï¼‰
- [ ] TypeScriptç±»å‹æ£€æŸ¥ï¼š`DISABLE_AUTO_INIT=true npm run typecheck`
- [ ] ç›‘æ§æ¨¡å—æµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:unit:monitoring`
- [ ] æ ¸å¿ƒæ¨¡å—æµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:unit:core`
- [ ] ç¡®è®¤æ— ç¼–è¯‘é”™è¯¯å’Œæµ‹è¯•å¤±è´¥

#### æ”¶å°¾å·¥ä½œï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] æäº¤ä»£ç ï¼š`git add -A && git commit -m "refactor: å°†processingTimeè¿ç§»ä¸ºprocessingTimeMs"`
- [ ] åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼ˆå¦‚é€‚ç”¨ï¼‰

---

## ğŸ“ˆ **P1 é«˜ä¼˜å…ˆçº§ä»»åŠ¡ - Day 2-4ï¼ˆé¢„è®¡4-6å°æ—¶ï¼‰**

### âœ… **ä»»åŠ¡ç»„3ï¼šFeature Flags æ¸…ç†ï¼ˆ4-6å°æ—¶ï¼‰**

#### è°ƒç ”åˆ†æï¼ˆ1å°æ—¶ï¼‰
- [ ] æ£€æŸ¥ `metricsLegacyModeEnabled` ä½¿ç”¨æƒ…å†µï¼š`grep -r "metricsLegacyModeEnabled" src/`
- [ ] æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®ï¼š`grep -r "METRICS_LEGACY_MODE_ENABLED" .`
- [ ] è®°å½•æ‰€æœ‰ä½¿ç”¨ä½ç½®
- [ ] ç¡®è®¤æ˜¯å¦æœ‰ç”Ÿäº§ç¯å¢ƒä¾èµ–

#### æ¸è¿›å¼æ¸…ç†ï¼ˆ2å°æ—¶ï¼‰
- [ ] ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä½¿ç”¨ç›‘æ§æ—¥å¿—
  - [ ] åœ¨ä½¿ç”¨å¤„æ·»åŠ è­¦å‘Šæ—¥å¿—ï¼š`logger.warn('METRICS_LEGACY_MODE is enabled - consider migration')`
  - [ ] éƒ¨ç½²å¹¶è§‚å¯Ÿ1-2å¤©ï¼ˆå¯é€‰ï¼‰
- [ ] ç¬¬äºŒæ­¥ï¼šç§»é™¤Feature Flag
  - [ ] æ‰“å¼€ `src/appcore/config/feature-flags.config.ts`
  - [ ] åˆ é™¤ç¬¬42-43è¡Œï¼š`readonly metricsLegacyModeEnabled: boolean = ...`
  - [ ] åˆ é™¤ç¬¬12è¡Œç¯å¢ƒå˜é‡æ³¨é‡Š
  - [ ] æ›´æ–° `getAllFlags()` æ–¹æ³•ï¼ˆåˆ é™¤ç›¸å…³è¿”å›å€¼ï¼‰

#### éªŒè¯æµ‹è¯•ï¼ˆ1.5å°æ—¶ï¼‰
- [ ] é…ç½®æ–‡ä»¶ç±»å‹æ£€æŸ¥ï¼š`DISABLE_AUTO_INIT=true npm run typecheck:file -- src/appcore/config/feature-flags.config.ts`
- [ ] ç›‘æ§æ¨¡å—æµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:unit:monitoring`
- [ ] æŒ‡æ ‡æ¨¡å—æµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:unit:metrics`
- [ ] åº”ç”¨å¯åŠ¨æµ‹è¯•ï¼š`timeout 30s DISABLE_AUTO_INIT=false bun run start`

#### æ”¶å°¾å·¥ä½œï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] æäº¤ä»£ç ï¼š`git add -A && git commit -m "chore: ç§»é™¤metricsLegacyModeEnabled feature flag"`
- [ ] æ›´æ–°ç¯å¢ƒå˜é‡æ–‡æ¡£

---

## âš™ï¸ **P2 ä¸­ç­‰ä¼˜å…ˆçº§ä»»åŠ¡ - Day 5-7ï¼ˆé¢„è®¡8-10å°æ—¶ï¼‰**

### âœ… **ä»»åŠ¡ç»„4ï¼šæµ‹è¯•æ–‡ä»¶æ›´æ–°ï¼ˆ6-8å°æ—¶ï¼‰**

#### æµ‹è¯•æ–‡ä»¶è¿ç§»ï¼ˆ4å°æ—¶ï¼‰
- [ ] æ›´æ–° `test/jest/unit/stream-cache/stream-cache-migration-validation.spec.ts`
  - [ ] å°†æ‰€æœ‰ `StreamCacheService` å¼•ç”¨æ”¹ä¸º `StreamCacheStandardizedService`
- [ ] æ›´æ–° `test/jest/unit/core/05-caching/stream-cache/stream-cache-memory-leak.spec.ts`
  - [ ] æ›´æ–°importè¯­å¥å’Œç±»åå¼•ç”¨
- [ ] æ›´æ–° `test/jest/integration/monitoring/presenter.controller.integration.spec.ts`
  - [ ] ç§»é™¤legacyç«¯ç‚¹ç›¸å…³æµ‹è¯•ï¼ˆå¦‚å­˜åœ¨ï¼‰
- [ ] æ›´æ–° `test/manual/data-fetcher-compatibility.test.js`
  - [ ] ç¡®è®¤å…¼å®¹æ€§æµ‹è¯•ä»ç„¶æœ‰æ•ˆ

#### è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆ2å°æ—¶ï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:unit:cache`
- [ ] é›†æˆæµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:integration:cache`
- [ ] ç›‘æ§æµ‹è¯•ï¼š`DISABLE_AUTO_INIT=true bun run test:integration:monitoring`
- [ ] ä¿®å¤æ‰€æœ‰å¤±è´¥çš„æµ‹è¯•

### âœ… **ä»»åŠ¡ç»„5ï¼šESLint é…ç½®ä¼˜åŒ–ï¼ˆ2-4å°æ—¶ï¼‰**

#### é…ç½®æ£€æŸ¥ï¼ˆ1å°æ—¶ï¼‰
- [ ] æ‰‹åŠ¨æ£€æŸ¥ `eslint.config.mts` å®Œæ•´æ–‡ä»¶
- [ ] æœç´¢ "legacy" å…³é”®è¯ï¼š`grep -n "legacy" eslint.config.mts`
- [ ] ç¡®è®¤æ˜¯å¦å­˜åœ¨legacyç›®å½•å¿½ç•¥è§„åˆ™
- [ ] å¦‚å­˜åœ¨ï¼Œè®°å½•å…·ä½“è¡Œå·

#### æ¸…ç†é…ç½®ï¼ˆ1å°æ—¶ï¼‰
- [ ] ç§»é™¤legacyç›®å½•å¿½ç•¥è§„åˆ™ï¼ˆå¦‚å­˜åœ¨ï¼‰
- [ ] ä¿ç•™processingTimeåºŸå¼ƒæ£€æµ‹è§„åˆ™ï¼ˆæš‚æ—¶ï¼‰
- [ ] æ›´æ–°lintè„šæœ¬é…ç½®

---

## ğŸ§¹ **P3 æ¸…ç†ä»»åŠ¡ - Week 2ï¼ˆé¢„è®¡3-4å°æ—¶ï¼‰**

### âœ… **ä»»åŠ¡ç»„6ï¼šæ–‡æ¡£å’Œæ³¨é‡Šæ›´æ–°ï¼ˆ2-3å°æ—¶ï¼‰**

#### ä»£ç æ³¨é‡Šæ›´æ–°ï¼ˆ1å°æ—¶ï¼‰
- [ ] æ›´æ–° `src/core/01-entry/stream-receiver/services/stream-receiver.service.ts` ç¬¬67è¡Œæ³¨é‡Š
- [ ] æœç´¢æ‰€æœ‰æåŠ `StreamCacheService` çš„æ³¨é‡Šï¼š`grep -r "StreamCacheService" src/ --include="*.ts"`
- [ ] æ‰¹é‡æ›´æ–°ä¸º `StreamCacheStandardizedService`

#### é¡¹ç›®æ–‡æ¡£æ›´æ–°ï¼ˆ1å°æ—¶ï¼‰
- [ ] æ›´æ–° `CLAUDE.md` ä¸­çš„ç›¸å…³æè¿°
- [ ] æ›´æ–°è¿ç§»æ–‡æ¡£çŠ¶æ€
- [ ] åˆ›å»ºæœ¬æ¬¡æ¸…ç†çš„æ€»ç»“æ–‡æ¡£

### âœ… **ä»»åŠ¡ç»„7ï¼šéªŒè¯è„šæœ¬åˆ›å»ºï¼ˆ1-2å°æ—¶ï¼‰**

#### åˆ›å»ºæ£€æŸ¥è„šæœ¬ï¼ˆ1å°æ—¶ï¼‰
- [ ] åˆ›å»º `scripts/check-legacy-cleanup.sh`
- [ ] æ·»åŠ legacyæ–‡ä»¶æ£€æŸ¥é€»è¾‘
- [ ] æ·»åŠ åºŸå¼ƒå­—æ®µæ£€æŸ¥é€»è¾‘
- [ ] æ·»åŠ æ‰§è¡Œæƒé™ï¼š`chmod +x scripts/check-legacy-cleanup.sh`

#### æ›´æ–°package.jsonï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] æ·»åŠ è„šæœ¬å‘½ä»¤ï¼š`"check:legacy-cleanup": "scripts/check-legacy-cleanup.sh"`
- [ ] è¿è¡ŒéªŒè¯ï¼š`npm run check:legacy-cleanup`

---

## ğŸ“Š **æœ€ç»ˆéªŒæ”¶æ¸…å•**

### âœ… **æŠ€æœ¯éªŒè¯**
- [ ] æ‰€æœ‰ `.legacy` æ–‡ä»¶å·²åˆ é™¤
- [ ] StreamCacheService åˆ«åå·²ç§»é™¤
- [ ] processingTime å­—æ®µå·²å…¨éƒ¨è¿ç§»
- [ ] metricsLegacyModeEnabled å·²æ¸…ç†
- [ ] ESLint æ£€æŸ¥æ— é”™è¯¯
- [ ] TypeScript ç¼–è¯‘é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

### âœ… **æ€§èƒ½éªŒè¯**
- [ ] åº”ç”¨å¯åŠ¨æ—¶é—´ < 5% å¢åŠ 
- [ ] å†…å­˜ä½¿ç”¨ < 10% å¢åŠ 
- [ ] API å“åº”æ—¶é—´ç¨³å®š

### âœ… **æ–‡æ¡£å®Œå–„**
- [ ] ä»£ç æ³¨é‡Šå·²æ›´æ–°
- [ ] é¡¹ç›®æ–‡æ¡£å·²æ›´æ–°
- [ ] è¿ç§»è®°å½•å·²å½’æ¡£

---

## ğŸ“ **æ‰§è¡Œæ³¨æ„äº‹é¡¹**

1. **æ¯ä¸ªä»»åŠ¡ç»„å¯ç‹¬ç«‹æ‰§è¡Œ**ï¼Œå»ºè®®æŒ‰é¡ºåºä½†å¯å¹¶è¡Œ
2. **æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ç»„å³å¯æäº¤**ï¼Œä¸å¿…ç­‰å¾…å…¨éƒ¨å®Œæˆ
3. **é‡åˆ°é—®é¢˜éšæ—¶åœæ­¢**ï¼Œä¸è¦å¼ºè¡Œæ¨è¿›
4. **ä¿æŒå¤‡ä»½ä¹ æƒ¯**ï¼Œå…³é”®æ“ä½œå‰å…ˆå¤‡ä»½
5. **æµ‹è¯•å……åˆ†**ï¼Œå®å¯å¤šæµ‹ä¸å¯å°‘æµ‹

---

*ç”Ÿæˆæ—¶é—´ï¼š2024å¹´9æœˆ24æ—¥*
*ç‰ˆæœ¬ï¼šv1.0*
*é¢„è®¡æ€»è€—æ—¶ï¼š8-10ä¸ªå·¥ä½œæ—¥ â†’ å®é™…å¯å‹ç¼©è‡³5-7å¤©*