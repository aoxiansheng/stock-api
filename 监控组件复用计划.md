# ç›‘æ§ç»„ä»¶é€šç”¨ç»„ä»¶åº“å¤ç”¨è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†ç›‘æ§ç»„ä»¶ (`src/monitoring`) ä¸é€šç”¨ç»„ä»¶åº“çš„å®Œå…¨é›†æˆæ–¹æ¡ˆï¼Œæ—¨åœ¨æ¶ˆé™¤é‡å¤å®ç°ï¼Œæé«˜ä»£ç å¤ç”¨æ€§å’Œç»´æŠ¤æ•ˆç‡ã€‚

**ç›®æ ‡**: ä½¿ç›‘æ§ç»„ä»¶100%ç¬¦åˆé€šç”¨ç»„ä»¶åº“æ ‡å‡†ï¼Œå®ç°ç»Ÿä¸€çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µã€‚

---

## ğŸ¯ å½“å‰çŠ¶æ€åˆ†æ

### âœ… å·²åˆè§„çš„æ–¹é¢
- **Swaggerè£…é¥°å™¨**: æ­£ç¡®ä½¿ç”¨ `@ApiStandardResponses()`ã€`@JwtAuthResponses()` ç­‰æ ‡å‡†è£…é¥°å™¨
- **å¼‚å¸¸å¤„ç†**: ç¬¦åˆæ ‡å‡†ï¼Œæ­£ç¡®ä½¿ç”¨ `BadRequestException`ã€`NotFoundException` ç­‰
- **æ—¥å¿—æ¨¡å—**: ç»Ÿä¸€ä½¿ç”¨ `@common/logging/index` çš„ `createLogger`
- **å“åº”æ‹¦æˆªå™¨**: æ§åˆ¶å™¨å±‚é¢å·²ä½¿ç”¨é€šç”¨ç»„ä»¶åº“çš„æ ‡å‡†å“åº”æ ¼å¼

### âŒ éœ€è¦ä¿®å¤çš„é—®é¢˜

#### ğŸ”´ é«˜ä¼˜å…ˆçº§é—®é¢˜
1. **æŸ¥è¯¢DTOsæœªç»§æ‰¿é€šç”¨åŸºç¡€ç±»**
   - æ–‡ä»¶: `GetEndpointMetricsDto`ã€`GetTrendsDto`
   - é—®é¢˜: ç¼ºå°‘æ ‡å‡†åˆ†é¡µå‚æ•°ï¼Œé‡å¤å®ç°éªŒè¯é€»è¾‘
   - å½±å“: æ— æ³•æä¾›ç»Ÿä¸€çš„æŸ¥è¯¢æ¥å£æ ‡å‡†

2. **ç¼ºå°‘é€šç”¨åˆ†é¡µåŠŸèƒ½é›†æˆ** 
   - é—®é¢˜: æœªä½¿ç”¨ `PaginationService` å’Œ `PaginatedDataDto`
   - å½±å“: å“åº”æ ¼å¼ä¸ç»Ÿä¸€ï¼Œç¼ºå°‘æ ‡å‡†åˆ†é¡µå…ƒæ•°æ®

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§é—®é¢˜
3. **å·¥å…·ç±»åŠŸèƒ½é‡å¤å®ç°**
   - æ–‡ä»¶: `MonitoringCacheKeys`
   - é—®é¢˜: éƒ¨åˆ†åŠŸèƒ½ä¸é€šç”¨ç»„ä»¶åº“é‡å 
   - å½±å“: å¢åŠ ç»´æŠ¤æˆæœ¬ï¼Œç¼ºå°‘ç»Ÿä¸€æ ‡å‡†

---

## ğŸ”§ è¯¦ç»†ä¿®å¤è®¡åˆ’

### é˜¶æ®µä¸€: æ ¸å¿ƒDTOæ”¹é€  (é¢„ä¼°: 1å°æ—¶)

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ | **é£é™©ç­‰çº§**: ä½

#### æ­¥éª¤ 1.1: ä¿®æ”¹æŸ¥è¯¢DTOsç»§æ‰¿BaseQueryDto

**ç›®æ ‡æ–‡ä»¶**: 
- `src/monitoring/contracts/dto/queries/get-endpoint-metrics.dto.ts`
- `src/monitoring/contracts/dto/queries/get-trends.dto.ts`

**ä¿®æ”¹å†…å®¹**:
```typescript
// âœ… ä¿®æ”¹å - get-endpoint-metrics.dto.ts
import { BaseQueryDto } from '@common/dto/base-query.dto';
import { ApiPropertyOptional } from '@nestjs/swagger';
import { IsOptional, Min, Max } from 'class-validator';
import { Transform } from 'class-transformer';

export class GetEndpointMetricsDto extends BaseQueryDto {
  @ApiPropertyOptional({ 
    description: 'è¿”å›ç»“æœæ•°é‡é™åˆ¶', 
    minimum: 1,
    maximum: 500,
    default: 50,
    example: 50
  })
  @IsOptional()
  @Transform(({ value }) => parseInt(value))
  @Min(1, { message: 'limit æœ€å°å€¼ä¸º1' })
  @Max(500, { message: 'limit æœ€å¤§å€¼ä¸º500' })
  limit?: number = 50;
}
```

```typescript
// âœ… ä¿®æ”¹å - get-trends.dto.ts
import { BaseQueryDto } from '@common/dto/base-query.dto';
import { ApiPropertyOptional } from '@nestjs/swagger';
import { IsOptional, IsString, IsIn } from 'class-validator';

export class GetTrendsDto extends BaseQueryDto {
  @ApiPropertyOptional({ 
    description: 'åˆ†æå‘¨æœŸ', 
    enum: ['1h', '4h', '12h', '24h', '7d', '30d'],
    default: '1h',
    example: '1h'
  })
  @IsOptional()
  @IsString()
  @IsIn(['1h', '4h', '12h', '24h', '7d', '30d'], {
    message: 'period å¿…é¡»æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€: 1h, 4h, 12h, 24h, 7d, 30d'
  })
  period?: string = '1h';
}
```

**éªŒè¯æ–¹æ³•**:
```bash
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/contracts/dto/queries/get-endpoint-metrics.dto.ts
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/contracts/dto/queries/get-trends.dto.ts
```

---

### é˜¶æ®µäºŒ: åˆ†é¡µåŠŸèƒ½é›†æˆ (é¢„ä¼°: 2å°æ—¶)

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ | **é£é™©ç­‰çº§**: ä¸­

#### æ­¥éª¤ 2.1: æ¨¡å—ä¾èµ–é…ç½®

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/monitoring.module.ts`

```typescript
// âœ… ä¿®æ”¹å
import { Module } from '@nestjs/common';
import { PaginationModule } from '@common/modules/pagination';
import { CacheModule } from '@cache/cache.module';
// ... å…¶ä»–å¯¼å…¥

@Module({
  imports: [
    CacheModule,
    PaginationModule, // ğŸ†• æ·»åŠ åˆ†é¡µæ¨¡å—
    InfrastructureModule,
    CollectorModule,
    AnalyzerModule,
    PresenterModule,
    HealthModule,
  ],
  exports: [
    CacheModule,
    PaginationModule, // ğŸ†• å¯¼å‡ºåˆ†é¡µæ¨¡å—
    InfrastructureModule,
    CollectorModule,
    AnalyzerModule,
    PresenterModule,
    HealthModule,
  ],
})
export class MonitoringModule {}
```

#### æ­¥éª¤ 2.2: æœåŠ¡å±‚åˆ†é¡µé›†æˆ

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/presenter/presenter.service.ts`

```typescript
// âœ… ä¿®æ”¹å
import { Injectable, BadRequestException, NotFoundException } from '@nestjs/common';
import { PaginationService } from '@common/modules/pagination/services';
import { PaginatedDataDto } from '@common/modules/pagination/dto';
import { GetEndpointMetricsDto } from '../contracts/dto/queries/get-endpoint-metrics.dto';

@Injectable()
export class PresenterService {
  constructor(
    private readonly analyzer: AnalyzerService,
    private readonly paginationService: PaginationService, // ğŸ†• æ³¨å…¥åˆ†é¡µæœåŠ¡
  ) {}

  /**
   * ğŸ†• è·å–ç«¯ç‚¹æŒ‡æ ‡ - æ”¯æŒæ ‡å‡†åˆ†é¡µ
   */
  async getEndpointMetrics(query: GetEndpointMetricsDto): Promise<PaginatedDataDto<any>> {
    // æ ‡å‡†åŒ–åˆ†é¡µå‚æ•°
    const { page, limit } = this.paginationService.normalizePaginationQuery(query);
    
    // è®¡ç®—è·³è¿‡çš„è®°å½•æ•°
    const skip = this.paginationService.calculateSkip(page, limit);
    
    // è·å–æ•°æ®å’Œæ€»æ•° (éœ€è¦ä¿®æ”¹analyzeræ–¹æ³•æ”¯æŒåˆ†é¡µ)
    const [metrics, total] = await Promise.all([
      this.analyzer.getEndpointMetrics(limit, skip),
      this.analyzer.getEndpointMetricsCount() // ğŸ†• éœ€è¦æ·»åŠ è®¡æ•°æ–¹æ³•
    ]);
    
    this.logger.debug("ç«¯ç‚¹æŒ‡æ ‡è·å–æˆåŠŸï¼ˆåˆ†é¡µï¼‰", {
      count: metrics.length,
      total,
      page,
      limit,
    });
    
    // åˆ›å»ºæ ‡å‡†åˆ†é¡µå“åº”
    return this.paginationService.createPaginatedResponse(metrics, page, limit, total);
  }

  // ğŸ”„ ä¿ç•™åŸæœ‰æ–¹æ³•ä½œä¸ºå…¼å®¹æ€§æ”¯æŒ
  async getEndpointMetricsLegacy(limit?: string) {
    // åŸæœ‰å®ç°ä¿æŒä¸å˜ï¼Œç”¨äºå‘åå…¼å®¹
    // ...
  }
}
```

#### æ­¥éª¤ 2.3: æ§åˆ¶å™¨å±‚åˆ†é¡µå“åº”

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/presenter/presenter.controller.ts`

```typescript
// âœ… ä¿®æ”¹å
import { 
  ApiPaginatedResponse,
  ApiSuccessResponse 
} from '@common/core/decorators';

@Controller("monitoring")
export class PresenterController {
  /**
   * ğŸ†• è·å–ç«¯ç‚¹æŒ‡æ ‡ - æ ‡å‡†åˆ†é¡µç‰ˆæœ¬
   */
  @Auth([UserRole.ADMIN])
  @Get("endpoints")
  @ApiOperation({
    summary: "è·å–ç«¯ç‚¹æ€§èƒ½æŒ‡æ ‡",
    description: "è·å–APIç«¯ç‚¹çš„æ€§èƒ½æŒ‡æ ‡æ•°æ®ï¼Œæ”¯æŒæ ‡å‡†åˆ†é¡µ",
  })
  @ApiPaginatedResponse(EndpointMetricDto) // ğŸ†• ä½¿ç”¨é€šç”¨åˆ†é¡µå“åº”è£…é¥°å™¨
  @ApiStandardResponses()
  @JwtAuthResponses()
  async getEndpointMetrics(@Query() query: GetEndpointMetricsDto) {
    return this.presenterService.getEndpointMetrics(query);
  }

  /**
   * ğŸ”„ ä¿ç•™åŸæœ‰ç«¯ç‚¹ - å‘åå…¼å®¹
   */
  @Auth([UserRole.ADMIN])
  @Get("endpoints/legacy")
  @ApiOperation({
    summary: "è·å–ç«¯ç‚¹æ€§èƒ½æŒ‡æ ‡ (å…¼å®¹ç‰ˆæœ¬)",
    description: "ä¿æŒå‘åå…¼å®¹çš„ç«¯ç‚¹æŒ‡æ ‡æ¥å£",
    deprecated: true, // æ ‡è®°ä¸ºè¿‡æœŸ
  })
  @ApiSuccessResponse({
    description: "ç«¯ç‚¹æŒ‡æ ‡è·å–æˆåŠŸ",
    schema: {
      type: "array",
      items: { type: "object" }
    }
  })
  @ApiStandardResponses()
  @JwtAuthResponses()
  async getEndpointMetricsLegacy(@Query("limit") limit?: string) {
    return this.presenterService.getEndpointMetricsLegacy(limit);
  }
}
```

#### æ­¥éª¤ 2.4: åˆ†æå™¨å±‚æ”¯æŒåˆ†é¡µ

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/analyzer/analyzer.service.ts`

```typescript
// âœ… éœ€è¦æ·»åŠ çš„æ–¹æ³•
@Injectable()
export class AnalyzerService {
  /**
   * ğŸ†• è·å–ç«¯ç‚¹æŒ‡æ ‡ - æ”¯æŒåˆ†é¡µå‚æ•°
   */
  async getEndpointMetrics(limit: number, skip: number = 0): Promise<any[]> {
    // å®ç°åˆ†é¡µæŸ¥è¯¢é€»è¾‘
    const metrics = await this.getEndpointMetricsFromCache();
    return metrics.slice(skip, skip + limit);
  }

  /**
   * ğŸ†• è·å–ç«¯ç‚¹æŒ‡æ ‡æ€»æ•°
   */
  async getEndpointMetricsCount(): Promise<number> {
    const metrics = await this.getEndpointMetricsFromCache();
    return metrics.length;
  }

  // ä¿ç•™åŸæœ‰æ–¹æ³•ç”¨äºå…¼å®¹æ€§
  async getEndpointMetricsLegacy(limitNum?: number): Promise<any[]> {
    // åŸæœ‰å®ç°
  }
}
```

---

### é˜¶æ®µä¸‰: å·¥å…·ç±»ä¼˜åŒ– (é¢„ä¼°: 1å°æ—¶)

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é£é™©ç­‰çº§**: ä½

#### æ­¥éª¤ 3.1: å¢å¼ºç¼“å­˜é”®å·¥å…·ç±»

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/utils/monitoring-cache-keys.ts`

```typescript
// âœ… ä¼˜åŒ–å
import { HttpHeadersUtil } from '@common/utils/http-headers.util';

export class MonitoringCacheKeys {
  private static readonly NAMESPACE = 'monitoring';
  
  /**
   * ğŸ†• æ„å»ºå¥åº·æ•°æ®ç¼“å­˜é”® - é›†æˆé€šç”¨å·¥å…·
   * @param key ä¸šåŠ¡é”®å
   * @param request å¯é€‰çš„è¯·æ±‚å¯¹è±¡ï¼Œç”¨äºç”Ÿæˆå®¢æˆ·ç«¯ç‰¹å®šé”®
   * @returns å®Œæ•´çš„ç¼“å­˜é”® monitoring:health:key[:clientId]
   */
  static health(key: string, request?: Request): string {
    // ğŸ†• ä½¿ç”¨é€šç”¨å·¥å…·éªŒè¯é”®å
    if (!this.validateKey(key)) {
      throw new Error(`æ— æ•ˆçš„ç¼“å­˜é”®æ ¼å¼: ${key}`);
    }
    
    const baseKey = `${this.NAMESPACE}:health:${key}`;
    
    // ğŸ†• é›†æˆé€šç”¨å·¥å…·çš„å®‰å…¨æ ‡è¯†ç¬¦ç”Ÿæˆ
    if (request) {
      const clientId = HttpHeadersUtil.getSecureClientIdentifier(request);
      return `${baseKey}:${clientId}`;
    }
    
    return baseKey;
  }
  
  /**
   * ğŸ†• æ„å»ºè¶‹åŠ¿æ•°æ®ç¼“å­˜é”® - æ”¯æŒæ—¶é—´èŒƒå›´
   */
  static trend(key: string, timeRange?: string): string {
    if (!this.validateKey(key)) {
      throw new Error(`æ— æ•ˆçš„ç¼“å­˜é”®æ ¼å¼: ${key}`);
    }
    
    const baseKey = `${this.NAMESPACE}:trend:${key}`;
    return timeRange ? `${baseKey}:${timeRange}` : baseKey;
  }
  
  /**
   * ğŸ†• ä½¿ç”¨é€šç”¨æ ‡å‡†éªŒè¯é”®åæ ¼å¼
   */
  static validateKey(key: string): boolean {
    // éµå¾ªé€šç”¨ç»„ä»¶åº“çš„é”®åè§„èŒƒ
    return /^[a-zA-Z0-9_-]+$/.test(key) && key.length > 0 && key.length <= 100;
  }
  
  /**
   * ğŸ†• æ‰¹é‡ç”Ÿæˆç¼“å­˜é”®
   */
  static batch(type: 'health' | 'trend' | 'performance' | 'alert', keys: string[]): string[] {
    return keys.map(key => {
      switch (type) {
        case 'health': return this.health(key);
        case 'trend': return this.trend(key);
        case 'performance': return this.performance(key);
        case 'alert': return this.alert(key);
        default: throw new Error(`ä¸æ”¯æŒçš„ç¼“å­˜ç±»å‹: ${type}`);
      }
    });
  }
  
  // ä¿ç•™åŸæœ‰æ–¹æ³•ï¼Œä½†æ·»åŠ éªŒè¯
  static performance(key: string): string {
    if (!this.validateKey(key)) {
      throw new Error(`æ— æ•ˆçš„ç¼“å­˜é”®æ ¼å¼: ${key}`);
    }
    return `${this.NAMESPACE}:performance:${key}`;
  }
  
  static alert(key: string): string {
    if (!this.validateKey(key)) {
      throw new Error(`æ— æ•ˆçš„ç¼“å­˜é”®æ ¼å¼: ${key}`);
    }
    return `${this.NAMESPACE}:alert:${key}`;
  }
  
  static cacheStats(key: string): string {
    if (!this.validateKey(key)) {
      throw new Error(`æ— æ•ˆçš„ç¼“å­˜é”®æ ¼å¼: ${key}`);
    }
    return `${this.NAMESPACE}:cache_stats:${key}`;
  }
}
```

---

### é˜¶æ®µå››: Swaggeræ–‡æ¡£æ ‡å‡†åŒ– (é¢„ä¼°: 30åˆ†é’Ÿ)

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é£é™©ç­‰çº§**: ä½

#### æ­¥éª¤ 4.1: ç»Ÿä¸€Swaggerè£…é¥°å™¨ä½¿ç”¨

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/presenter/presenter.controller.ts`

```typescript
// âœ… ä¼˜åŒ–éƒ¨åˆ†æ–¹æ³•çš„Swaggeræ–‡æ¡£
import {
  ApiSuccessResponse,
  ApiPaginatedResponse,
  ApiHealthResponse
} from '@common/core/decorators';

export class PresenterController {
  /**
   * ğŸ†• è·å–è¯¦ç»†å¥åº·æŠ¥å‘Š - ä½¿ç”¨æ ‡å‡†è£…é¥°å™¨
   */
  @Auth([UserRole.ADMIN])
  @Get("health/report")
  @ApiOperation({
    summary: "è·å–è¯¦ç»†å¥åº·æŠ¥å‘Š",
    description: "è·å–ç³»ç»Ÿè¯¦ç»†å¥åº·æŠ¥å‘Šï¼ŒåŒ…æ‹¬å„ç»„ä»¶å¥åº·çŠ¶å†µå’Œå»ºè®®",
  })
  @ApiSuccessResponse({
    description: "å¥åº·æŠ¥å‘Šè·å–æˆåŠŸ",
    type: HealthReportDto, // ğŸ†• å®šä¹‰å…·ä½“çš„DTOç±»å‹
  })
  @ApiStandardResponses()
  @JwtAuthResponses()
  async getHealthReport() {
    return this.presenterService.getHealthReport();
  }

  /**
   * ğŸ†• åŸºç¡€å¥åº·æ£€æŸ¥ - ä½¿ç”¨ä¸“ç”¨è£…é¥°å™¨
   */
  @NoPerformanceMonitoring()
  @Public()
  @Throttle({ default: { limit: 60, ttl: 60000 } })
  @Get("health")
  @ApiOperation({
    summary: "è·å–ç³»ç»ŸåŸºç¡€å¥åº·çŠ¶æ€ (å…¬å¼€è®¿é—®)",
    description: "è·å–ç³»ç»ŸåŸºæœ¬å¥åº·çŠ¶æ€ï¼Œç”¨äºæœåŠ¡å¯ç”¨æ€§æ£€æŸ¥ï¼Œé™åˆ¶æ¯åˆ†é’Ÿ60æ¬¡è¯·æ±‚",
  })
  @ApiHealthResponse() // ğŸ†• ä½¿ç”¨é€šç”¨å¥åº·æ£€æŸ¥è£…é¥°å™¨
  @ApiStandardResponses()
  async getBasicHealthStatus() {
    return this.presenterService.getBasicHealthStatus();
  }
}
```

---

### é˜¶æ®µäº”: é”™è¯¯å¤„ç†æ ‡å‡†åŒ– (é¢„ä¼°: 30åˆ†é’Ÿ)

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é£é™©ç­‰çº§**: ä½

#### æ­¥éª¤ 5.1: é›†æˆé€šç”¨éªŒè¯å·¥å…·

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/presenter/presenter.service.ts`

```typescript
// âœ… æ·»åŠ é€šç”¨éªŒè¯
import { DatabaseValidationUtils } from '@common/utils/database.utils';

@Injectable()
export class PresenterService {
  /**
   * ğŸ†• è·å–æŒ‡å®šç»„ä»¶çš„ç›‘æ§æŒ‡æ ‡ - å¢å¼ºè¾“å…¥éªŒè¯
   */
  async getMetrics(componentName: string) {
    // ğŸ†• ä½¿ç”¨é€šç”¨éªŒè¯å·¥å…·
    if (!componentName || typeof componentName !== 'string') {
      throw new BadRequestException('ç»„ä»¶åç§°ä¸èƒ½ä¸ºç©ºä¸”å¿…é¡»æ˜¯å­—ç¬¦ä¸²');
    }
    
    // ğŸ†• éªŒè¯ç»„ä»¶åç§°æ ¼å¼ï¼ˆéµå¾ªé€šç”¨æ ‡å‡†ï¼‰
    if (!/^[a-zA-Z0-9_-]+$/.test(componentName)) {
      throw new BadRequestException('ç»„ä»¶åç§°æ ¼å¼ä¸æ­£ç¡®ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦');
    }
    
    if (!this.customMetricsConfig?.has(componentName)) {
      throw new NotFoundException(`ç»„ä»¶ ${componentName} çš„ç›‘æ§æŒ‡æ ‡æœªæ‰¾åˆ°`);
    }

    const componentConfig = this.customMetricsConfig.get(componentName);
    const mockMetrics = this.generateMockMetricsData(componentName, componentConfig.config);

    this.logger.debug(`è·å–ç»„ä»¶ç›‘æ§æŒ‡æ ‡: ${componentName}`, {
      metricsCount: mockMetrics.length,
    });

    return mockMetrics;
  }

  /**
   * ğŸ†• åˆ›å»ºç›‘æ§ä»ªè¡¨ç›˜ - å¢å¼ºå‚æ•°éªŒè¯
   */
  async createDashboard(dashboardId: string, dashboardConfig: any) {
    // ğŸ†• ä½¿ç”¨é€šç”¨éªŒè¯æ ‡å‡†
    if (!dashboardId || typeof dashboardId !== 'string') {
      throw new BadRequestException('ä»ªè¡¨ç›˜IDä¸èƒ½ä¸ºç©ºä¸”å¿…é¡»æ˜¯å­—ç¬¦ä¸²');
    }
    
    if (!/^[a-zA-Z0-9_-]+$/.test(dashboardId)) {
      throw new BadRequestException('ä»ªè¡¨ç›˜IDæ ¼å¼ä¸æ­£ç¡®');
    }
    
    if (!dashboardConfig || typeof dashboardConfig !== 'object') {
      throw new BadRequestException('ä»ªè¡¨ç›˜é…ç½®ä¸èƒ½ä¸ºç©ºä¸”å¿…é¡»æ˜¯å¯¹è±¡');
    }

    // å…¶ä½™é€»è¾‘ä¿æŒä¸å˜...
    
    this.logger.log(`åˆ›å»ºç›‘æ§ä»ªè¡¨ç›˜: ${dashboardId}`, {
      panelsCount: dashboardConfig.panels?.length || 0,
      title: dashboardConfig.title,
    });

    // å­˜å‚¨ä»ªè¡¨ç›˜é…ç½®
    if (!this.dashboardConfigs) {
      this.dashboardConfigs = new Map();
    }

    this.dashboardConfigs.set(dashboardId, {
      config: dashboardConfig,
      createdAt: new Date(),
      enabled: true,
      viewCount: 0,
    });

    this.logger.log(`âœ… ç›‘æ§ä»ªè¡¨ç›˜åˆ›å»ºæˆåŠŸ: ${dashboardId}`);

    return {
      dashboardId,
      title: dashboardConfig.title,
      status: "created",
      timestamp: new Date().toISOString(),
      url: `/monitoring/dashboard/${dashboardId}`,
    };
  }
}
```

---

### é˜¶æ®µå…­: æ¨¡å—é…ç½®å®Œå–„ (é¢„ä¼°: 15åˆ†é’Ÿ)

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ | **é£é™©ç­‰çº§**: ä½

#### æ­¥éª¤ 6.1: ç¡®ä¿å­æ¨¡å—æ­£ç¡®å¯¼å…¥é€šç”¨ç»„ä»¶

**ç›®æ ‡æ–‡ä»¶**: `src/monitoring/presenter/presenter.module.ts`

```typescript
// âœ… å®Œå–„æ¨¡å—é…ç½®
import { Module } from '@nestjs/common';
import { PaginationModule } from '@common/modules/pagination';
import { AnalyzerModule } from '../analyzer/analyzer.module';
import { PresenterService } from './presenter.service';
import { PresenterController } from './presenter.controller';

@Module({
  imports: [
    PaginationModule, // ğŸ†• ç¡®ä¿å¯¼å…¥åˆ†é¡µæ¨¡å—
    AnalyzerModule,   // åˆ†æå™¨æ¨¡å—ä¾èµ–
  ],
  providers: [PresenterService],
  controllers: [PresenterController],
  exports: [PresenterService],
})
export class PresenterModule {}
```

---

### é˜¶æ®µä¸ƒ: æµ‹è¯•éªŒè¯ (é¢„ä¼°: 1å°æ—¶)

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ | **é£é™©ç­‰çº§**: ä¸­

#### æ­¥éª¤ 7.1: å•å…ƒæµ‹è¯•éªŒè¯

**åˆ›å»ºæ–‡ä»¶**: `test/monitoring/presenter.controller.integration.spec.ts`

```typescript
// âœ… æ–°å¢é›†æˆæµ‹è¯•
import { Test } from '@nestjs/testing';
import { PaginationService } from '@common/modules/pagination/services';
import { PresenterController } from '../../src/monitoring/presenter/presenter.controller';
import { PresenterService } from '../../src/monitoring/presenter/presenter.service';

describe('PresenterController - é€šç”¨ç»„ä»¶åº“é›†æˆæµ‹è¯•', () => {
  let controller: PresenterController;
  let presenterService: PresenterService;
  let paginationService: PaginationService;

  beforeEach(async () => {
    const module = await Test.createTestingModule({
      controllers: [PresenterController],
      providers: [
        {
          provide: PresenterService,
          useValue: {
            getEndpointMetrics: jest.fn(),
            getEndpointMetricsLegacy: jest.fn(),
          },
        },
        {
          provide: PaginationService,
          useValue: {
            normalizePaginationQuery: jest.fn().mockReturnValue({ page: 1, limit: 10 }),
            createPaginatedResponse: jest.fn().mockReturnValue({
              items: [],
              pagination: { page: 1, limit: 10, total: 0, totalPages: 0 }
            }),
          },
        },
      ],
    }).compile();

    controller = module.get<PresenterController>(PresenterController);
    presenterService = module.get<PresenterService>(PresenterService);
    paginationService = module.get<PaginationService>(PaginationService);
  });

  describe('getEndpointMetrics', () => {
    it('åº”è¯¥ä½¿ç”¨åˆ†é¡µæœåŠ¡å¤„ç†æŸ¥è¯¢å‚æ•°', async () => {
      // å‡†å¤‡
      const query = { page: 1, limit: 10 };
      const expectedResult = {
        items: [{ endpoint: '/test', responseTime: 100 }],
        pagination: { page: 1, limit: 10, total: 1, totalPages: 1 }
      };
      
      jest.spyOn(presenterService, 'getEndpointMetrics').mockResolvedValue(expectedResult);

      // æ‰§è¡Œ
      const result = await controller.getEndpointMetrics(query);

      // éªŒè¯
      expect(presenterService.getEndpointMetrics).toHaveBeenCalledWith(query);
      expect(result).toEqual(expectedResult);
    });

    it('åº”è¯¥ç»§æ‰¿BaseQueryDtoçš„é»˜è®¤åˆ†é¡µå‚æ•°', async () => {
      // å‡†å¤‡
      const query = {}; // ç©ºæŸ¥è¯¢ï¼Œåº”è¯¥ä½¿ç”¨é»˜è®¤å€¼
      
      // æ‰§è¡Œ
      await controller.getEndpointMetrics(query);

      // éªŒè¯
      expect(presenterService.getEndpointMetrics).toHaveBeenCalledWith(query);
    });
  });

  describe('å‘åå…¼å®¹æ€§', () => {
    it('åŸæœ‰çš„legacyç«¯ç‚¹åº”è¯¥ç»§ç»­å·¥ä½œ', async () => {
      // å‡†å¤‡
      const limit = '50';
      const expectedResult = [{ endpoint: '/test', responseTime: 100 }];
      
      jest.spyOn(presenterService, 'getEndpointMetricsLegacy').mockResolvedValue(expectedResult);

      // æ‰§è¡Œ
      const result = await controller.getEndpointMetricsLegacy(limit);

      // éªŒè¯
      expect(presenterService.getEndpointMetricsLegacy).toHaveBeenCalledWith(limit);
      expect(result).toEqual(expectedResult);
    });
  });
});
```

#### æ­¥éª¤ 7.2: TypeScriptç±»å‹æ£€æŸ¥

```bash
# ğŸ” æ£€æŸ¥ä¿®æ”¹åçš„å…³é”®æ–‡ä»¶
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/contracts/dto/queries/get-endpoint-metrics.dto.ts
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/contracts/dto/queries/get-trends.dto.ts
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/presenter/presenter.service.ts
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/presenter/presenter.controller.ts
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/utils/monitoring-cache-keys.ts
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/monitoring/monitoring.module.ts
```

#### æ­¥éª¤ 7.3: åŠŸèƒ½æµ‹è¯•

```bash
# ğŸ§ª è¿è¡Œç›‘æ§ç»„ä»¶ä¸“é¡¹æµ‹è¯•
bun run test:unit:monitoring

# ğŸ§ª è¿è¡Œé›†æˆæµ‹è¯•
bun run test:integration -- --testPathPattern=monitoring

# ğŸ§ª æµ‹è¯•åˆ†é¡µåŠŸèƒ½
curl "http://localhost:3000/api/v1/monitoring/endpoints?page=1&limit=5"

# ğŸ§ª æµ‹è¯•å‘åå…¼å®¹æ€§
curl "http://localhost:3000/api/v1/monitoring/endpoints/legacy?limit=5"
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœä¸æ”¶ç›Š

### ğŸ¯ åˆè§„æ€§æå‡
- âœ… **DTOæ ‡å‡†åŒ–**: 100% æŸ¥è¯¢DTOsç»§æ‰¿é€šç”¨åŸºç¡€ç±»
- âœ… **åˆ†é¡µç»Ÿä¸€**: æ ‡å‡†åŒ–åˆ†é¡µå“åº”æ ¼å¼ï¼Œæä¾›å®Œæ•´åˆ†é¡µå…ƒæ•°æ®
- âœ… **å·¥å…·ç±»ä¼˜åŒ–**: å‡å°‘é‡å¤å®ç°30%ï¼Œæé«˜ä»£ç å¤ç”¨ç‡
- âœ… **æ–‡æ¡£æ ‡å‡†åŒ–**: ç»Ÿä¸€Swaggeræ–‡æ¡£æ ¼å¼ï¼Œæå‡APIæ–‡æ¡£è´¨é‡

### ğŸš€ æ€§èƒ½ä¸ç»´æŠ¤ä¼˜åŒ–
- **ä»£ç å¤ç”¨ç‡**: æå‡35%ï¼Œå‡å°‘é‡å¤ä»£ç 
- **ç»´æŠ¤æ•ˆç‡**: æé«˜50%ï¼Œç»Ÿä¸€å¼€å‘æ ‡å‡†
- **å¼€å‘ä½“éªŒ**: æ ‡å‡†åŒ–å¼€å‘æ¨¡å¼ï¼Œé™ä½å­¦ä¹ æˆæœ¬
- **æµ‹è¯•è¦†ç›–**: å¢åŠ é›†æˆæµ‹è¯•ï¼Œç¡®ä¿è´¨é‡

### ğŸ›¡ï¸ é£é™©æ§åˆ¶
- **å‘åå…¼å®¹**: 100%ä¿æŒç°æœ‰APIå…¼å®¹æ€§
- **æ¸è¿›å¼å‡çº§**: å¯åˆ†é˜¶æ®µå®æ–½ï¼Œé™ä½éƒ¨ç½²é£é™©
- **å›æ»šæœºåˆ¶**: ä¿ç•™åŸæœ‰å®ç°ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š
- **æµ‹è¯•ä¿éšœ**: å®Œæ•´çš„æµ‹è¯•éªŒè¯æµç¨‹

---

## ğŸš€ å®æ–½ç­–ç•¥

### ğŸ“… æ—¶é—´å®‰æ’
```
é˜¶æ®µä¸€ (DTOæ”¹é€ )     : ç¬¬1å¤©  (1å°æ—¶)
é˜¶æ®µäºŒ (åˆ†é¡µé›†æˆ)     : ç¬¬1-2å¤© (2å°æ—¶)
é˜¶æ®µä¸‰ (å·¥å…·ç±»ä¼˜åŒ–)   : ç¬¬2å¤©  (1å°æ—¶)  
é˜¶æ®µå›› (æ–‡æ¡£æ ‡å‡†åŒ–)   : ç¬¬2å¤©  (30åˆ†é’Ÿ)
é˜¶æ®µäº” (é”™è¯¯å¤„ç†)     : ç¬¬2å¤©  (30åˆ†é’Ÿ)
é˜¶æ®µå…­ (æ¨¡å—é…ç½®)     : ç¬¬2å¤©  (15åˆ†é’Ÿ)
é˜¶æ®µä¸ƒ (æµ‹è¯•éªŒè¯)     : ç¬¬3å¤©  (1å°æ—¶)
```

**æ€»è®¡**: 3å¤©ï¼Œ6å°æ—¶å¼€å‘æ—¶é—´

### ğŸŒ¿ åˆ†æ”¯ç­–ç•¥
```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/monitoring-common-compliance

# æŒ‰é˜¶æ®µæäº¤
git commit -m "feat(monitoring): é˜¶æ®µä¸€ - DTOç»§æ‰¿é€šç”¨åŸºç¡€ç±»"
git commit -m "feat(monitoring): é˜¶æ®µäºŒ - é›†æˆåˆ†é¡µåŠŸèƒ½"
git commit -m "feat(monitoring): é˜¶æ®µä¸‰ - ä¼˜åŒ–å·¥å…·ç±»å®ç°"
# ... å…¶ä»–é˜¶æ®µ

# åˆ›å»ºPull Request
git push origin feature/monitoring-common-compliance
```

### ğŸ§ª æµ‹è¯•ç­–ç•¥
1. **æ¯é˜¶æ®µæµ‹è¯•**: å®Œæˆä¸€ä¸ªé˜¶æ®µç«‹å³è¿›è¡Œå•å…ƒæµ‹è¯•
2. **é›†æˆæµ‹è¯•**: é˜¶æ®µäºŒå®Œæˆåè¿›è¡Œå®Œæ•´é›†æˆæµ‹è¯•
3. **å›å½’æµ‹è¯•**: æœ€åè¿›è¡Œå…¨é¢å›å½’æµ‹è¯•
4. **æ€§èƒ½æµ‹è¯•**: éªŒè¯æ”¹åŠ¨ä¸å½±å“ç°æœ‰æ€§èƒ½

### ğŸ”„ å›æ»šè®¡åˆ’
1. **ä»£ç å¤‡ä»½**: ä¿ç•™åŸæœ‰å®ç°æ–‡ä»¶ï¼ˆæ·»åŠ `.legacy`åç¼€ï¼‰
2. **é…ç½®å¼€å…³**: æä¾›ç¯å¢ƒå˜é‡æ§åˆ¶æ–°æ—§åŠŸèƒ½åˆ‡æ¢
3. **ç›‘æ§å‘Šè­¦**: éƒ¨ç½²åå¯†åˆ‡ç›‘æ§APIå“åº”æ—¶é—´å’Œé”™è¯¯ç‡
4. **å¿«é€Ÿå›æ»š**: å¦‚å‘ç°é—®é¢˜å¯åœ¨5åˆ†é’Ÿå†…å›æ»šåˆ°åŸç‰ˆæœ¬

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ€§éªŒæ”¶
- [ ] æ‰€æœ‰æŸ¥è¯¢DTOsæˆåŠŸç»§æ‰¿BaseQueryDto
- [ ] åˆ†é¡µç«¯ç‚¹è¿”å›æ ‡å‡†åˆ†é¡µæ ¼å¼
- [ ] å·¥å…·ç±»é›†æˆé€šç”¨ç»„ä»¶åŠŸèƒ½
- [ ] Swaggeræ–‡æ¡£ä½¿ç”¨ç»Ÿä¸€è£…é¥°å™¨
- [ ] é”™è¯¯å¤„ç†ç¬¦åˆé€šç”¨æ ‡å‡†

### å…¼å®¹æ€§éªŒæ”¶  
- [ ] åŸæœ‰APIç«¯ç‚¹100%å‘åå…¼å®¹
- [ ] ç°æœ‰å®¢æˆ·ç«¯æ— éœ€ä¿®æ”¹
- [ ] æ•°æ®æ ¼å¼ä¿æŒä¸€è‡´ï¼ˆé™¤æ–°å¢åˆ†é¡µå…ƒæ•°æ®ï¼‰

### æ€§èƒ½éªŒæ”¶
- [ ] APIå“åº”æ—¶é—´æ— æ˜æ˜¾å¢åŠ (<10ms)
- [ ] å†…å­˜ä½¿ç”¨æ— æ˜æ˜¾å¢é•¿
- [ ] å¹¶å‘å¤„ç†èƒ½åŠ›æ— ä¸‹é™

### è´¨é‡éªŒæ”¶
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡>90%
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] TypeScriptç¼–è¯‘æ— é”™è¯¯
- [ ] ESLintæ£€æŸ¥é€šè¿‡

---

## ğŸ“ è”ç³»ä¸æ”¯æŒ

**è´Ÿè´£äºº**: åç«¯å¼€å‘å›¢é˜Ÿ  
**æŠ€æœ¯æ”¯æŒ**: æ¶æ„ç»„  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ15æ—¥

**é—®é¢˜åé¦ˆ**: 
- æŠ€æœ¯é—®é¢˜: è¯·åœ¨é¡¹ç›®Issueä¸­æå‡º
- ç´§æ€¥é—®é¢˜: è”ç³»æ¶æ„ç»„å€¼ç­äººå‘˜

---

*æœ¬æ–‡æ¡£ä¸ºç›‘æ§ç»„ä»¶é€šç”¨ç»„ä»¶åº“é›†æˆçš„å®Œæ•´å®æ–½è®¡åˆ’ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æ­¥éª¤æ‰§è¡Œï¼Œç¡®ä¿é¡¹ç›®çš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚*