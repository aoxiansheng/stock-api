# WebSocket特性开关配置示例
# 用于WebSocket双实例清理后的功能控制和回退策略

# ===========================================
# 🚀 生产环境推荐配置 (默认)
# ===========================================

# Gateway-only模式 (推荐: true)
# 启用后只使用Gateway服务器，完全禁用Legacy双实例架构
WS_GATEWAY_ONLY_MODE=true

# Legacy回退模式 (推荐: false)
# 生产环境应禁用，仅在紧急情况下临时启用
WS_ALLOW_LEGACY_FALLBACK=false

# 严格模式 (推荐: true)
# 启用后禁止所有Legacy代码路径，确保架构纯净
WS_STRICT_MODE=true

# 验证模式 (推荐: production)
# production: 禁止动态配置更新，确保生产稳定性
# development: 允许动态配置更新，便于调试
WS_VALIDATION_MODE=production

# 健康检查间隔 (毫秒，推荐: 30000)
# 监控WebSocket架构健康状态的频率
WS_HEALTH_CHECK_INTERVAL=30000

# Gateway故障转移超时 (毫秒，推荐: 5000)
# Gateway不可用时的最大等待时间
WS_GATEWAY_FAILOVER_TIMEOUT=5000

# ===========================================
# 🔧 开发环境配置
# ===========================================

# 开发环境可以使用以下配置进行测试
# WS_GATEWAY_ONLY_MODE=true
# WS_ALLOW_LEGACY_FALLBACK=false
# WS_STRICT_MODE=false  # 开发时可适当放松
# WS_VALIDATION_MODE=development  # 允许动态配置
# WS_HEALTH_CHECK_INTERVAL=10000  # 更频繁的检查
# WS_GATEWAY_FAILOVER_TIMEOUT=3000

# ===========================================
# 🚨 紧急回退配置 (仅紧急情况使用)
# ===========================================

# 当Gateway服务器出现问题时的紧急配置
# 使用前必须确认问题无法通过其他方式解决

# 步骤1: 禁用Gateway-only模式
# WS_GATEWAY_ONLY_MODE=false

# 步骤2: 启用Legacy回退
# WS_ALLOW_LEGACY_FALLBACK=true

# 步骤3: 禁用严格模式
# WS_STRICT_MODE=false

# 步骤4: 保持生产验证模式
# WS_VALIDATION_MODE=production

# 注意: 紧急回退后请尽快恢复正常配置

# ===========================================
# 📊 监控和告警配置
# ===========================================

# 这些环境变量会影响WebSocket服务的监控行为
# 建议配合监控系统使用，确保及时发现问题

# 监控相关配置 (来自其他模块)
# MONITORING_ENABLED=true
# MONITORING_WEBSOCKET_INTERVAL=30000
# CACHE_WEBSOCKET_TTL=300

# 日志级别配置
# LOG_LEVEL=info  # 生产环境
# LOG_LEVEL=debug  # 开发环境或故障排查

# ===========================================
# 🔍 配置验证命令
# ===========================================

# 验证配置是否正确加载:
# curl http://localhost:3000/api/v1/monitoring/feature-flags/websocket

# 检查WebSocket健康状态:
# curl http://localhost:3000/api/health/websocket

# 检查特性开关状态:
# curl http://localhost:3000/api/v1/monitoring/websocket-feature-flags

# ===========================================
# 📝 重要说明
# ===========================================

# 1. 生产环境部署前必须验证所有配置
# 2. 修改配置后需要重启应用服务
# 3. 紧急回退配置仅在严重故障时使用
# 4. 所有配置变更都应记录和监控
# 5. 定期检查特性开关健康状态

# 技术支持：
# - 查看回退策略文档: docs/WebSocket双实例清理回退策略.md
# - 配置迁移指南: docs/Stream Config 配置迁移指南.md
# - 效果报告: docs/Stream Data Fetcher 清理效果报告.md