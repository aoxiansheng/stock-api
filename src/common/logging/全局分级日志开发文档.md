# å…¨å±€åˆ†çº§æ—¥å¿—æ§åˆ¶ç³»ç»Ÿå¼€å‘æ–‡æ¡£

## ğŸ“š ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [é…ç½®ä½“ç³»](#é…ç½®ä½“ç³»)
- [é…ç½®æ–‡ä»¶ä¸ç¯å¢ƒå˜é‡å…³ç³»](#é…ç½®æ–‡ä»¶ä¸ç¯å¢ƒå˜é‡å…³ç³»)
- [å®ç°ç»†èŠ‚](#å®ç°ç»†èŠ‚)
- [APIå‚è€ƒ](#apiå‚è€ƒ)
- [è¿ç§»æŒ‡å—](#è¿ç§»æŒ‡å—)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [ç‰ˆæœ¬å†å²](#ç‰ˆæœ¬å†å²)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç›®æ ‡

å…¨å±€åˆ†çº§æ—¥å¿—æ§åˆ¶ç³»ç»Ÿæ˜¯ä¸€ä¸ª**é›†ä¸­å¼ã€å…¨å±€ç®¡ç†**çš„æ—¥å¿—çº§åˆ«æ§åˆ¶è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨ï¼š

1. **ç»Ÿä¸€ç®¡ç†**ï¼šæä¾›å•ä¸€æ§åˆ¶ç‚¹ç®¡ç†æ‰€æœ‰ç»„ä»¶çš„æ—¥å¿—çº§åˆ«
2. **çµæ´»æ§åˆ¶**ï¼šæ”¯æŒå…¨å±€ã€æ¨¡å—ã€å‘½åç©ºé—´ä¸‰çº§ç²¾ç»†åŒ–æ§åˆ¶
3. **é«˜æ€§èƒ½**ï¼šé€šè¿‡ç¼“å­˜å’Œé¢„è®¡ç®—ä¼˜åŒ–æ€§èƒ½å¼€é”€
4. **æ˜“äºä½¿ç”¨**ï¼šé›¶ä¾µå…¥å¼é›†æˆï¼ŒAPIå®Œå…¨å…¼å®¹ç°æœ‰ä»£ç 
5. **åŠ¨æ€è°ƒæ•´**ï¼šæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ›´æ–°æ—¥å¿—çº§åˆ«ï¼Œæ— éœ€é‡å¯åº”ç”¨

### æ ¸å¿ƒç‰¹æ€§

- âœ… **ä¸‰çº§æ§åˆ¶ä½“ç³»**ï¼šå…¨å±€çº§åˆ« â†’ æ¨¡å—çº§åˆ« â†’ å‘½åç©ºé—´çº§åˆ«
- âœ… **é€šé…ç¬¦æ”¯æŒ**ï¼šå‘½åç©ºé—´æ”¯æŒ `*` å’Œ `?` é€šé…ç¬¦åŒ¹é…
- âœ… **é…ç½®çƒ­æ›´æ–°**ï¼šæ”¯æŒé…ç½®æ–‡ä»¶å’ŒREST APIåŠ¨æ€æ›´æ–°
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šç»“æœç¼“å­˜ã€é¢„è®¡ç®—ã€æ€§èƒ½æ¨¡å¼
- âœ… **å®Œå…¨å…¼å®¹**ï¼šæ— ç¼æ›¿æ¢ç°æœ‰æ—¥å¿—ç³»ç»Ÿ

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨å±‚ (Application Layer)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   MonitoringService â”‚ AuthService â”‚ CacheService â”‚ ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ ä½¿ç”¨
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ControlledLogger (å—æ§æ—¥å¿—å™¨)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æä¾›æ ‡å‡†æ—¥å¿—æ¥å£ï¼šdebug, info, warn, error      â”‚   â”‚
â”‚  â”‚  é›†æˆçº§åˆ«æ£€æŸ¥ï¼šisDebugEnabled, isInfoEnabled    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ æŸ¥è¯¢
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LogLevelController (çº§åˆ«æ§åˆ¶å™¨-å•ä¾‹)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  é…ç½®ç®¡ç† â”‚ çº§åˆ«è®¡ç®— â”‚ ç¼“å­˜ä¼˜åŒ– â”‚ åŠ¨æ€æ›´æ–°       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è¯»å–
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é…ç½®æº (Configuration Sources)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¯å¢ƒå˜é‡      â”‚ é…ç½®æ–‡ä»¶      â”‚ REST API                 â”‚
â”‚ (.env)       â”‚ (log-levels.json) â”‚ (/api/admin/log-levels) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çº§åˆ«ä¼˜å…ˆçº§

æ—¥å¿—çº§åˆ«æ£€æŸ¥æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§é¡ºåºè¿›è¡Œï¼š

1. **æ¨¡å—çº§åˆ«**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ï¼šç²¾ç¡®åŒ¹é…æ¨¡å—åç§°
2. **å‘½åç©ºé—´çº§åˆ«**ï¼šé€šé…ç¬¦åŒ¹é…
3. **å…¨å±€çº§åˆ«**ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰ï¼šé»˜è®¤çº§åˆ«

### æ—¥å¿—çº§åˆ«å±‚æ¬¡

```
silent < fatal < error < warn < info < debug < trace
  0       1       2      3      4      5       6
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. LogLevelControllerï¼ˆçº§åˆ«æ§åˆ¶å™¨ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`src/common/logging/log-level-controller.ts`

#### ä¸»è¦èŒè´£
- ç®¡ç†å…¨å±€æ—¥å¿—çº§åˆ«é…ç½®
- è®¡ç®—ç‰¹å®šä¸Šä¸‹æ–‡çš„æ—¥å¿—çº§åˆ«
- æä¾›åŠ¨æ€æ›´æ–°æ¥å£
- ä¼˜åŒ–æ€§èƒ½ï¼ˆç¼“å­˜æœºåˆ¶ï¼‰

#### æ ¸å¿ƒæ–¹æ³•

```typescript
class LogLevelController {
  // æ£€æŸ¥æ˜¯å¦åº”è¯¥è®°å½•æ—¥å¿—
  shouldLog(context: string, level: LogLevel): boolean
  
  // åŠ¨æ€æ›´æ–°æ—¥å¿—çº§åˆ«
  updateLogLevel(target: string, level: LogLevel, type: 'module' | 'namespace' | 'global'): void
  
  // è·å–å½“å‰é…ç½®
  getConfiguration(): any
  
  // æ‰¹é‡æ›´æ–°
  batchUpdate(updates: Array<UpdateConfig>): void
  
  // é‡ç½®é…ç½®
  reset(): void
}
```

### 2. ControlledLoggerï¼ˆå—æ§æ—¥å¿—å™¨ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`src/common/logging/controlled-logger.ts`

#### ä¸»è¦èŒè´£
- æä¾›æ ‡å‡†æ—¥å¿—æ¥å£
- é›†æˆçº§åˆ«æ§åˆ¶é€»è¾‘
- ä¿æŒAPIå…¼å®¹æ€§

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
export class MyService {
  private readonly logger = createControlledLogger(MyService.name);
  
  someMethod() {
    // æ ‡å‡†æ—¥å¿—æ–¹æ³•
    this.logger.debug('Debug message');
    this.logger.info('Info message');
    this.logger.warn('Warning message');
    this.logger.error('Error message');
    
    // æ€§èƒ½ä¼˜åŒ–ï¼šå…ˆæ£€æŸ¥çº§åˆ«
    if (this.logger.isDebugEnabled()) {
      const expensiveData = this.calculateExpensiveData();
      this.logger.debug('Debug with expensive data', expensiveData);
    }
  }
}
```

### 3. LogLevelManagementControllerï¼ˆç®¡ç†APIï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`src/common/logging/log-level.controller.ts`

#### REST APIç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/admin/log-levels` | è·å–å½“å‰é…ç½® |
| PUT | `/api/admin/log-levels/global/:level` | æ›´æ–°å…¨å±€çº§åˆ« |
| PUT | `/api/admin/log-levels/module/:module/:level` | æ›´æ–°æ¨¡å—çº§åˆ« |
| PUT | `/api/admin/log-levels/batch` | æ‰¹é‡æ›´æ–° |
| PUT | `/api/admin/log-levels/reset` | é‡ç½®ä¸ºé»˜è®¤ |

---

## ğŸ”§ å®ç°ç»†èŠ‚

### é…ç½®åŠ è½½å’Œåˆå¹¶å®ç°

```typescript
// src/common/logging/log-level-controller.ts

export class LogLevelController implements OnModuleInit {
  private config: LogLevelConfig;
  private configFilePath: string;
  private envOverrides: Map<string, any> = new Map();
  
  /**
   * åŠ è½½é…ç½®çš„ä¸»æµç¨‹
   */
  private loadConfiguration(): void {
    // 1. åŠ è½½é»˜è®¤é…ç½®
    const defaultConfig = this.getDefaultConfig();
    
    // 2. åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆå›ºå®šé…ç½®ï¼‰
    const fileConfig = this.loadFromConfigFile();
    
    // 3. åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆåŠ¨æ€è¦†ç›–ï¼‰
    const envOverrides = this.loadEnvironmentOverrides();
    
    // 4. æ™ºèƒ½åˆå¹¶é…ç½®
    this.config = this.mergeConfigurations(
      defaultConfig,
      fileConfig,
      envOverrides
    );
    
    // 5. éªŒè¯é…ç½®å®Œæ•´æ€§
    this.validateConfiguration();
    
    // 6. è®°å½•æœ€ç»ˆé…ç½®
    this.logConfiguration();
  }
  
  /**
   * ä»é…ç½®æ–‡ä»¶åŠ è½½ï¼ˆä¸»è¦é…ç½®æºï¼‰
   */
  private loadFromConfigFile(): Partial<LogLevelConfig> | null {
    // æ”¯æŒå¤šä¸ªé…ç½®æ–‡ä»¶è·¯å¾„
    const configPaths = [
      process.env.LOG_CONFIG_PATH,
      path.join(process.cwd(), 'config', 'log-levels.json'),
      path.join(process.cwd(), 'log-levels.json'),
      path.join(process.cwd(), `.log-levels.${process.env.NODE_ENV}.json`),
    ].filter(Boolean);
    
    for (const configPath of configPaths) {
      if (fs.existsSync(configPath)) {
        try {
          const content = fs.readFileSync(configPath, 'utf-8');
          const config = JSON.parse(content);
          
          console.log(`âœ… Loaded log config from: ${configPath}`);
          this.configFilePath = configPath;
          
          return this.parseFileConfig(config);
        } catch (error) {
          console.error(`âŒ Failed to load config from ${configPath}:`, error);
        }
      }
    }
    
    console.warn('âš ï¸ No log config file found, using defaults');
    return null;
  }
  
  /**
   * æ™ºèƒ½åˆå¹¶é…ç½®
   * ä¼˜å…ˆçº§: ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼
   */
  private mergeConfigurations(
    defaultConfig: LogLevelConfig,
    fileConfig: Partial<LogLevelConfig> | null,
    envOverrides: Partial<LogLevelConfig>
  ): LogLevelConfig {
    let merged = { ...defaultConfig };
    
    if (fileConfig) {
      merged = this.deepMerge(merged, fileConfig);
    }
    
    if (envOverrides) {
      merged = this.deepMerge(merged, envOverrides);
    }
    
    return merged;
  }
}
```

### é…ç½®æ–‡ä»¶ç»„ç»‡ç»“æ„

```
config/
â”œâ”€â”€ log-levels.json                 # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ log-levels.schema.json         # JSON Schema éªŒè¯
â”œâ”€â”€ log-levels.development.json    # å¼€å‘ç¯å¢ƒè¡¥å……
â”œâ”€â”€ log-levels.production.json     # ç”Ÿäº§ç¯å¢ƒè¡¥å……
â””â”€â”€ log-levels.test.json          # æµ‹è¯•ç¯å¢ƒè¡¥å……
```

### é…ç½®éªŒè¯ Schema

```json
// config/log-levels.schema.json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "global": {
      "type": "string",
      "enum": ["fatal", "error", "warn", "info", "debug", "trace", "silent"]
    },
    "modules": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "enum": ["fatal", "error", "warn", "info", "debug", "trace", "silent"]
      }
    },
    "namespaces": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "enum": ["fatal", "error", "warn", "info", "debug", "trace", "silent"]
      }
    },
    "features": {
      "type": "object"
    },
    "performance": {
      "type": "object"
    },
    "output": {
      "type": "object"
    }
  },
  "required": ["global"]
}
```

### ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

```gitignore
# .gitignore
.env                    # ä¸æäº¤ï¼ŒåŒ…å«æ•æ„Ÿä¿¡æ¯
.env.local             # ä¸æäº¤ï¼Œæœ¬åœ°è¦†ç›–

# æäº¤è¿™äº›æ–‡ä»¶
.env.example           # æäº¤ï¼Œç¤ºä¾‹é…ç½®
config/log-levels.json # æäº¤ï¼Œæ ‡å‡†é…ç½®
config/log-levels.*.json # æäº¤ï¼Œç¯å¢ƒç‰¹å®šé…ç½®
```

### å¿«é€Ÿå¼€å§‹

#### 1. å®‰è£…å’Œé…ç½®

```typescript
// src/common/logging/logging.module.ts
import { Global, Module } from '@nestjs/common';
import { LogLevelController } from './log-level-controller';
import { LogLevelManagementController } from './log-level.controller';

@Global()
@Module({
  controllers: [LogLevelManagementController],
  providers: [
    {
      provide: LogLevelController,
      useFactory: () => new LogLevelController(),
    },
  ],
  exports: [LogLevelController],
})
export class LoggingModule {}
```

#### 2. åœ¨AppModuleä¸­å¯¼å…¥

```typescript
// src/app.module.ts
import { LoggingModule } from './common/logging/logging.module';

@Module({
  imports: [
    LoggingModule, // æ·»åŠ å…¨å±€æ—¥å¿—æ¨¡å—
    // ... å…¶ä»–æ¨¡å—
  ],
})
export class AppModule {}
```

#### 3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```typescript
// ä»»æ„æœåŠ¡æˆ–ç»„ä»¶
import { createControlledLogger } from '@common/logging/controlled-logger';

@Injectable()
export class MonitoringService {
  private readonly logger = createControlledLogger(MonitoringService.name);
  
  async processData() {
    this.logger.debug('Starting data processing');
    
    try {
      // ä¸šåŠ¡é€»è¾‘
      const result = await this.doProcessing();
      this.logger.info('Processing completed', { result });
      return result;
    } catch (error) {
      this.logger.error('Processing failed', error);
      throw error;
    }
  }
}
```

### é«˜çº§ç”¨æ³•

#### æ¡ä»¶æ—¥å¿—è®°å½•

```typescript
// é¿å…ä¸å¿…è¦çš„è®¡ç®—
if (this.logger.isDebugEnabled()) {
  // åªæœ‰åœ¨debugçº§åˆ«å¯ç”¨æ—¶æ‰æ‰§è¡Œ
  const metrics = this.calculateComplexMetrics();
  this.logger.debug('Performance metrics', metrics);
}
```

#### ç»“æ„åŒ–æ—¥å¿—

```typescript
this.logger.info('User action', {
  userId: user.id,
  action: 'login',
  timestamp: new Date().toISOString(),
  metadata: {
    ip: request.ip,
    userAgent: request.headers['user-agent'],
  }
});
```

---

## ğŸ“‹ é…ç½®ä½“ç³»

### é…ç½®è®¾è®¡åŸåˆ™

- **é…ç½®æ–‡ä»¶**ï¼šå­˜å‚¨**å›ºå®šçš„ã€ç»“æ„åŒ–çš„ã€è¯¦ç»†çš„**é…ç½®
- **ç¯å¢ƒå˜é‡**ï¼šå­˜å‚¨**å˜åŒ–çš„ã€æ•æ„Ÿçš„ã€ç¯å¢ƒç‰¹å®šçš„**é…ç½®
- **ä¼˜å…ˆçº§**ï¼šç¯å¢ƒå˜é‡è¦†ç›– > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼

### é…ç½®èŒè´£åˆ’åˆ†

#### é…ç½®æ–‡ä»¶è´Ÿè´£çš„å†…å®¹
- è¯¦ç»†çš„æ¨¡å—çº§åˆ«æ˜ å°„
- å‘½åç©ºé—´åŒ¹é…è§„åˆ™
- åŠŸèƒ½ç‰¹æ€§å¼€å…³
- æ€§èƒ½å‚æ•°è®¾ç½®
- è¾“å‡ºæ ¼å¼é…ç½®
- é€šç”¨ä¸šåŠ¡è§„åˆ™

#### ç¯å¢ƒå˜é‡è´Ÿè´£çš„å†…å®¹
- ç¯å¢ƒæ ‡è¯†ï¼ˆNODE_ENVï¼‰
- ä¸´æ—¶è°ƒè¯•è¦†ç›–
- æ•æ„Ÿä¿¡æ¯ï¼ˆAPIå¯†é’¥ã€URLï¼‰
- ç¯å¢ƒç‰¹å®šè·¯å¾„
- ç´§æ€¥è°ƒæ•´å¼€å…³
- å¤–éƒ¨æœåŠ¡é…ç½®

---

## ğŸ”„ é…ç½®æ–‡ä»¶ä¸ç¯å¢ƒå˜é‡å…³ç³»

### é…ç½®åŠ è½½æµç¨‹

```
å¯åŠ¨åº”ç”¨
    â”‚
    â–¼
åŠ è½½é»˜è®¤é…ç½®ï¼ˆç¡¬ç¼–ç ï¼‰
    â”‚
    â–¼
æŸ¥æ‰¾é…ç½®æ–‡ä»¶
    â”‚
    â”œâ”€â–º LOG_CONFIG_PATH ç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„
    â”œâ”€â–º config/log-levels.json
    â”œâ”€â–º log-levels.json
    â””â”€â–º log-levels.{NODE_ENV}.json
    â”‚
    â–¼
åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    â”‚
    â–¼
åŠ è½½ç¯å¢ƒå˜é‡è¦†ç›–
    â”‚
    â”œâ”€â–º LOG_LEVELï¼ˆå…¨å±€çº§åˆ«ï¼‰
    â”œâ”€â–º LOG_LEVEL_OVERRIDE_MODULEï¼ˆæ¨¡å—è¦†ç›–ï¼‰
    â””â”€â–º å…¶ä»–åŠŸèƒ½å¼€å…³
    â”‚
    â–¼
åˆå¹¶é…ç½®ï¼ˆç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤ï¼‰
    â”‚
    â–¼
éªŒè¯é…ç½®å®Œæ•´æ€§
    â”‚
    â–¼
åº”ç”¨æœ€ç»ˆé…ç½®
```

### æ ‡å‡†é…ç½®æ–‡ä»¶ç»“æ„ï¼ˆconfig/log-levels.jsonï¼‰

```json
{
  "$schema": "./log-levels.schema.json",
  "version": "1.0.0",
  "description": "ç”Ÿäº§ç¯å¢ƒæ—¥å¿—çº§åˆ«é…ç½®",
  
  "global": "info",
  
  "modules": {
    "// ç›‘æ§ç»„ä»¶": "===================",
    "MonitoringEventBridge": "info",
    "MonitoringCacheService": "warn",
    "CollectorService": "warn",
    "AnalyzerService": "info",
    "PresenterService": "info",
    
    "// æ ¸å¿ƒç»„ä»¶": "===================",
    "AuthService": "warn",
    "AuthGuard": "error",
    "JwtStrategy": "error",
    
    "// æ•°æ®å±‚": "===================",
    "DatabaseService": "error",
    "MongoRepository": "error",
    "RedisService": "warn",
    "CacheService": "info"
  },
  
  "namespaces": {
    "*Service": "info",
    "*Controller": "info",
    "*Repository": "warn",
    "*Handler": "info",
    "*Interceptor": "info",
    "*Guard": "warn",
    "Monitor*": "debug",
    "Test*": "silent"
  },
  
  "features": {
    "enableStructuredLogging": true,
    "enableTimestamps": true,
    "enableMetadata": true,
    "enableCallerInfo": false,
    "enableColorOutput": false
  },
  
  "performance": {
    "cacheEnabled": true,
    "cacheExpiry": 5000,
    "maxCacheSize": 1000,
    "batchSize": 100,
    "flushInterval": 1000
  },
  
  "output": {
    "format": "json",
    "prettyPrint": false,
    "maxMessageLength": 10000,
    "maxDepth": 5,
    "includeStackTrace": true
  }
}
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env æ–‡ä»¶

# ============= å…¨å±€é…ç½® =============
LOG_LEVEL=info                              # å…¨å±€é»˜è®¤çº§åˆ«

# ============= æ¨¡å—çº§åˆ«é…ç½® =============
# æ ¼å¼: module1:level1,module2:level2
LOG_LEVEL_MODULES=monitoring:debug,auth:warn,cache:info,database:error

# ============= å‘½åç©ºé—´é…ç½® =============
# æ”¯æŒé€šé…ç¬¦: * åŒ¹é…ä»»æ„å­—ç¬¦, ? åŒ¹é…å•ä¸ªå­—ç¬¦
LOG_LEVEL_NAMESPACES=Monitor*:debug,*Service:info,*Controller:debug,*Repository:warn

# ============= åŠŸèƒ½å¼€å…³ =============
DYNAMIC_LOG_LEVEL=true                      # å¯ç”¨åŠ¨æ€æ›´æ–°
LOG_PERFORMANCE_MODE=true                   # å¯ç”¨æ€§èƒ½æ¨¡å¼
```

### ç¯å¢ƒç‰¹å®šé…ç½®ç¤ºä¾‹

#### å¼€å‘ç¯å¢ƒï¼ˆ.env.developmentï¼‰
```bash
# ç¯å¢ƒæ ‡è¯†
NODE_ENV=development

# è¦†ç›–å…¨å±€çº§åˆ«ï¼ˆä¸´æ—¶è°ƒè¯•ï¼‰
LOG_LEVEL=debug

# ä¸´æ—¶è°ƒè¯•ç‰¹å®šæ¨¡å—
LOG_LEVEL_OVERRIDE_MODULE=DatabaseService:trace

# å¼€å‘ç‰¹å®šè®¾ç½®
LOG_TO_FILE=false
LOG_CONFIG_DEBUG=true
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆ.env.productionï¼‰
```bash
# ç¯å¢ƒæ ‡è¯†
NODE_ENV=production

# ä½¿ç”¨é…ç½®æ–‡ä»¶çš„è®¾ç½®ï¼Œä¸è¦†ç›–
# LOG_LEVEL ä¸è®¾ç½®ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶çš„ "info"

# è¿œç¨‹æ—¥å¿—æœåŠ¡ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰
LOG_REMOTE_URL=https://logs.company.com/api
LOG_REMOTE_API_KEY=${SECRET_LOG_API_KEY}

# ç”Ÿäº§ç‰¹å®šè®¾ç½®
LOG_TO_FILE=true
LOG_FILE_PATH=/var/log/application
LOG_TO_REMOTE=true

# æ€§èƒ½ä¼˜åŒ–
LOG_PERFORMANCE_MODE=true
```

#### æµ‹è¯•ç¯å¢ƒï¼ˆ.env.testï¼‰
```bash
# ç¯å¢ƒæ ‡è¯†
NODE_ENV=test

# æµ‹è¯•æ—¶é™é»˜å¤§éƒ¨åˆ†æ—¥å¿—
LOG_LEVEL=error

# ç¦ç”¨ä¸å¿…è¦çš„åŠŸèƒ½
DYNAMIC_LOG_LEVEL=false
LOG_TO_FILE=false
LOG_TO_REMOTE=false
```

### ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶

```json
// config/log-levels.development.json
{
  "global": "info",
  "modules": {
    "MonitoringEventBridge": "debug",
    "MonitoringCacheService": "info",
    "CollectorService": "warn",
    "AnalyzerService": "debug",
    "PresenterService": "info",
    "AuthService": "warn",
    "DatabaseService": "error",
    "CacheService": "info"
  },
  "namespaces": {
    "*Service": "info",
    "*Controller": "debug",
    "Monitor*": "debug",
    "*Repository": "warn",
    "*Handler": "info",
    "*Interceptor": "debug",
    "Test*": "silent"
  },
  "dynamicEnabled": true,
  "performanceMode": true
}
```

### é…ç½®ä¼˜å…ˆçº§

å½“å¤šä¸ªé…ç½®æºå­˜åœ¨æ—¶ï¼ŒæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§ç”Ÿæ•ˆï¼š

1. **é…ç½®æ–‡ä»¶** (`log-levels.json`) - æœ€é«˜ä¼˜å…ˆçº§
2. **ç¯å¢ƒå˜é‡** (`.env`) - ä¸­ç­‰ä¼˜å…ˆçº§
3. **é»˜è®¤å€¼** - æœ€ä½ä¼˜å…ˆçº§

---

## ğŸ”Œ APIå‚è€ƒ

### LogLevelController API

```typescript
interface LogLevelController {
  /**
   * æ£€æŸ¥æŒ‡å®šä¸Šä¸‹æ–‡å’Œçº§åˆ«æ˜¯å¦åº”è¯¥è®°å½•
   * @param context - æ—¥å¿—ä¸Šä¸‹æ–‡ï¼ˆç±»åã€æ¨¡å—åç­‰ï¼‰
   * @param level - æ—¥å¿—çº§åˆ«
   * @returns æ˜¯å¦åº”è¯¥è®°å½•
   */
  shouldLog(context: string, level: LogLevel): boolean;
  
  /**
   * åŠ¨æ€æ›´æ–°æ—¥å¿—çº§åˆ«
   * @param target - ç›®æ ‡ï¼ˆæ¨¡å—åã€å‘½åç©ºé—´æˆ–ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºå…¨å±€ï¼‰
   * @param level - æ–°çš„æ—¥å¿—çº§åˆ«
   * @param type - æ›´æ–°ç±»å‹
   */
  updateLogLevel(
    target: string,
    level: LogLevel,
    type: 'module' | 'namespace' | 'global'
  ): void;
  
  /**
   * è·å–å½“å‰é…ç½®
   * @returns é…ç½®å¯¹è±¡
   */
  getConfiguration(): LogLevelConfig;
  
  /**
   * æ‰¹é‡æ›´æ–°é…ç½®
   * @param updates - æ›´æ–°æ•°ç»„
   */
  batchUpdate(updates: UpdateConfig[]): void;
  
  /**
   * é‡ç½®ä¸ºé»˜è®¤é…ç½®
   */
  reset(): void;
}
```

### ControlledLogger API

```typescript
interface ControlledLogger {
  // æ ‡å‡†æ—¥å¿—æ–¹æ³•
  debug(message: any, ...optionalParams: any[]): void;
  log(message: any, ...optionalParams: any[]): void;
  info(message: any, ...optionalParams: any[]): void;
  warn(message: any, ...optionalParams: any[]): void;
  error(message: any, ...optionalParams: any[]): void;
  verbose(message: any, ...optionalParams: any[]): void;
  
  // çº§åˆ«æ£€æŸ¥æ–¹æ³•
  isDebugEnabled(): boolean;
  isInfoEnabled(): boolean;
  isWarnEnabled(): boolean;
  isErrorEnabled(): boolean;
  isVerboseEnabled(): boolean;
}
```

### REST API

#### è·å–é…ç½®
```http
GET /api/admin/log-levels
Authorization: Bearer {admin-token}

Response:
{
  "global": "info",
  "modules": {
    "monitoring": "debug",
    "auth": "warn"
  },
  "namespaces": {
    "*Service": "info"
  },
  "dynamicEnabled": true,
  "performanceMode": true,
  "cacheSize": 42
}
```

#### æ›´æ–°å…¨å±€çº§åˆ«
```http
PUT /api/admin/log-levels/global/debug
Authorization: Bearer {admin-token}

Response:
{
  "message": "Global log level updated",
  "level": "debug"
}
```

#### æ‰¹é‡æ›´æ–°
```http
PUT /api/admin/log-levels/batch
Authorization: Bearer {admin-token}
Content-Type: application/json

Body:
[
  { "target": "monitoring", "level": "debug", "type": "module" },
  { "target": "*Controller", "level": "info", "type": "namespace" }
]

Response:
{
  "message": "Batch update completed",
  "count": 2
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

ä½¿ç”¨æ¸…æ™°ã€ä¸€è‡´çš„å‘½åè§„èŒƒæœ‰åŠ©äºæ—¥å¿—ç®¡ç†ï¼š

```typescript
// âœ… æ¨èï¼šä½¿ç”¨ç±»åä½œä¸ºcontext
private readonly logger = createControlledLogger(MonitoringService.name);

// âœ… æ¨èï¼šä½¿ç”¨æ¨¡å—åä½œä¸ºcontext
private readonly logger = createControlledLogger('monitoring.cache');

// âŒ é¿å…ï¼šä½¿ç”¨æ¨¡ç³Šçš„åç§°
private readonly logger = createControlledLogger('service');
```

### 2. æ€§èƒ½ä¼˜åŒ–

#### ä½¿ç”¨çº§åˆ«æ£€æŸ¥é¿å…ä¸å¿…è¦çš„è®¡ç®—

```typescript
// âœ… æ¨èï¼šå…ˆæ£€æŸ¥çº§åˆ«
if (this.logger.isDebugEnabled()) {
  const stats = this.calculateStatistics(); // æ˜‚è´µçš„æ“ä½œ
  this.logger.debug('Statistics', stats);
}

// âŒ é¿å…ï¼šæ€»æ˜¯æ‰§è¡Œè®¡ç®—
this.logger.debug('Statistics', this.calculateStatistics());
```

#### å¯ç”¨æ€§èƒ½æ¨¡å¼

```bash
# åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ€§èƒ½æ¨¡å¼
LOG_PERFORMANCE_MODE=true
```

### 3. ç»“æ„åŒ–æ—¥å¿—

ä½¿ç”¨ç»“æ„åŒ–æ•°æ®è€Œéå­—ç¬¦ä¸²æ‹¼æ¥ï¼š

```typescript
// âœ… æ¨èï¼šç»“æ„åŒ–æ•°æ®
this.logger.info('Request processed', {
  requestId: req.id,
  userId: user.id,
  duration: endTime - startTime,
  status: 'success'
});

// âŒ é¿å…ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
this.logger.info(`Request ${req.id} for user ${user.id} took ${endTime - startTime}ms`);
```

### 4. é”™è¯¯æ—¥å¿—

å§‹ç»ˆåŒ…å«é”™è¯¯å †æ ˆå’Œä¸Šä¸‹æ–‡ï¼š

```typescript
catch (error) {
  this.logger.error('Operation failed', {
    error: error.message,
    stack: error.stack,
    context: {
      userId: user.id,
      operation: 'updateProfile',
      params: { ...params, password: '[REDACTED]' }
    }
  });
}
```

### 5. ç¯å¢ƒç‰¹å®šé…ç½®

ä¸ºä¸åŒç¯å¢ƒè®¾ç½®é€‚å½“çš„æ—¥å¿—çº§åˆ«ï¼š

```bash
# .env.development
LOG_LEVEL=debug
LOG_LEVEL_MODULES=*:debug

# .env.production
LOG_LEVEL=info
LOG_LEVEL_MODULES=monitoring:warn,auth:error,critical:info

# .env.test
LOG_LEVEL=error
LOG_LEVEL_MODULES=*:error
```

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»ç°æœ‰æ—¥å¿—ç³»ç»Ÿè¿ç§»

#### æ­¥éª¤1ï¼šå®‰è£…æ–°çš„æ—¥å¿—æ¨¡å—

```bash
# åˆ›å»ºæ—¥å¿—æ¨¡å—æ–‡ä»¶
mkdir -p src/common/logging
touch src/common/logging/log-level-controller.ts
touch src/common/logging/controlled-logger.ts
touch src/common/logging/logging.module.ts
```

#### æ­¥éª¤2ï¼šæ‰¹é‡æ›¿æ¢å¯¼å…¥

```bash
# æ›¿æ¢å¯¼å…¥è¯­å¥
find src -name "*.ts" -type f -exec sed -i \
  's|import { createLogger } from.*|import { createControlledLogger } from "@common/logging/controlled-logger"|g' {} \;

# æ›¿æ¢å‡½æ•°è°ƒç”¨
find src -name "*.ts" -type f -exec sed -i \
  's/createLogger(/createControlledLogger(/g' {} \;
```

#### æ­¥éª¤3ï¼šæ›´æ–°ç¯å¢ƒå˜é‡

```bash
# æ·»åŠ åˆ° .env æ–‡ä»¶
echo "LOG_LEVEL_MODULES=monitoring:debug,auth:warn" >> .env
echo "LOG_LEVEL_NAMESPACES=*Service:info,*Controller:debug" >> .env
echo "DYNAMIC_LOG_LEVEL=true" >> .env
echo "LOG_PERFORMANCE_MODE=true" >> .env
```

#### æ­¥éª¤4ï¼šéªŒè¯è¿ç§»

```typescript
// åˆ›å»ºæµ‹è¯•æ–‡ä»¶
// test/logging-migration.spec.ts
describe('Logging Migration', () => {
  it('should use controlled logger', () => {
    const logger = createControlledLogger('TestService');
    expect(logger).toBeDefined();
    expect(logger.isDebugEnabled).toBeDefined();
  });
});
```

### å…¼å®¹æ€§ä¿è¯

æ–°ç³»ç»Ÿå®Œå…¨å…¼å®¹ç°æœ‰æ—¥å¿—APIï¼š

```typescript
// ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
logger.debug('message');
logger.info('message', data);
logger.warn('message', { context });
logger.error('message', error);

// æ–°å¢çš„åŠŸèƒ½æ˜¯å¯é€‰çš„
if (logger.isDebugEnabled()) { // å¯é€‰ä¼˜åŒ–
  logger.debug('expensive operation');
}
```

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ—¥å¿—æœªæŒ‰é¢„æœŸè¾“å‡º

**ç—‡çŠ¶**ï¼šè®¾ç½®äº†debugçº§åˆ«ä½†æœªçœ‹åˆ°debugæ—¥å¿—

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $LOG_LEVEL
echo $LOG_LEVEL_MODULES

# 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat log-levels.json

# 3. é€šè¿‡APIæŸ¥çœ‹è¿è¡Œæ—¶é…ç½®
curl http://localhost:3000/api/admin/log-levels

# 4. æ£€æŸ¥contextåç§°åŒ¹é…
# ç¡®ä¿loggerçš„contextä¸é…ç½®åŒ¹é…
```

#### 2. æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**ï¼šæ—¥å¿—ç³»ç»Ÿé€ æˆæ€§èƒ½ä¸‹é™

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¯ç”¨æ€§èƒ½æ¨¡å¼
LOG_PERFORMANCE_MODE=true

# å‡å°‘æ—¥å¿—çº§åˆ«
LOG_LEVEL=warn

# ç¦ç”¨ä¸å¿…è¦çš„æ¨¡å—æ—¥å¿—
LOG_LEVEL_MODULES=critical:info,monitoring:warn
```

#### 3. é…ç½®æœªç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼šä¿®æ”¹é…ç½®åæœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// æ‰‹åŠ¨è§¦å‘é…ç½®é‡è½½
logLevelController.reset();

// æˆ–é€šè¿‡API
curl -X PUT http://localhost:3000/api/admin/log-levels/reset
```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹æ—¥å¿—ç³»ç»Ÿå†…éƒ¨è¿è¡Œï¼š

```bash
# ç¯å¢ƒå˜é‡
DEBUG_LOG_SYSTEM=true
LOG_LEVEL=trace

# æŸ¥çœ‹å†…éƒ¨æ—¥å¿—
tail -f logs/system.log | grep LogLevelController
```

### å¥åº·æ£€æŸ¥

```typescript
// æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
@Get('/health/logging')
async checkLoggingHealth() {
  const config = this.logLevelController.getConfiguration();
  return {
    status: 'healthy',
    config: config,
    cacheSize: config.cacheSize,
    performanceMode: config.performanceMode,
  };
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜æœºåˆ¶

ç³»ç»Ÿä½¿ç”¨å¤šçº§ç¼“å­˜ä¼˜åŒ–æ€§èƒ½ï¼š

```typescript
// ç¼“å­˜é…ç½®
{
  cacheExpiry: 5000,        // 5ç§’è¿‡æœŸ
  maxCacheSize: 1000,       // æœ€å¤§ç¼“å­˜æ¡ç›®
  performanceMode: true,    // å¯ç”¨æ€§èƒ½æ¨¡å¼
}
```

### æ€§èƒ½æŒ‡æ ‡

å…¸å‹æ€§èƒ½æŒ‡æ ‡ï¼ˆåŸºäº1000æ¬¡/ç§’æ—¥å¿—è°ƒç”¨ï¼‰ï¼š

| æ“ä½œ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æ€§èƒ½æ¨¡å¼ |
|------|--------|--------|----------|
| shouldLogæ£€æŸ¥ | 0.5ms | 0.05ms | 0.01ms |
| å†…å­˜ä½¿ç”¨ | åŸºå‡† | +10KB | +50KB |
| CPUä½¿ç”¨ç‡ | åŸºå‡† | -30% | -50% |

### ä¼˜åŒ–å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå§‹ç»ˆå¯ç”¨æ€§èƒ½æ¨¡å¼
2. **é«˜é¢‘æ—¥å¿—**ï¼šä½¿ç”¨çº§åˆ«æ£€æŸ¥é¿å…ä¸å¿…è¦çš„æ—¥å¿—
3. **æ‰¹é‡æ“ä½œ**ï¼šä½¿ç”¨æ‰¹é‡æ›´æ–°APIå‡å°‘å¼€é”€
4. **å®šæœŸæ¸…ç†**ï¼šé…ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´

### åŸºå‡†æµ‹è¯•

```typescript
// benchmark.ts
import { createControlledLogger } from '@common/logging/controlled-logger';

const logger = createControlledLogger('BenchmarkTest');
const iterations = 100000;

console.time('Performance Test');
for (let i = 0; i < iterations; i++) {
  if (logger.isDebugEnabled()) {
    logger.debug(`Test message ${i}`);
  }
}
console.timeEnd('Performance Test');

// é¢„æœŸç»“æœï¼š
// æ€§èƒ½æ¨¡å¼å¼€å¯: ~500ms
// æ€§èƒ½æ¨¡å¼å…³é—­: ~1500ms
```

---

## ğŸ“Š ç›‘æ§å’ŒæŒ‡æ ‡

### é›†æˆPrometheusæŒ‡æ ‡

```typescript
// æ·»åŠ æ—¥å¿—ç³»ç»ŸæŒ‡æ ‡
@Injectable()
export class LoggingMetricsService {
  private readonly logCallsCounter = new Counter({
    name: 'log_calls_total',
    help: 'Total number of log calls',
    labelNames: ['level', 'module'],
  });
  
  private readonly cacheHitRate = new Gauge({
    name: 'log_cache_hit_rate',
    help: 'Log level cache hit rate',
  });
  
  trackLogCall(level: string, module: string) {
    this.logCallsCounter.inc({ level, module });
  }
  
  updateCacheMetrics(hits: number, total: number) {
    this.cacheHitRate.set(hits / total);
  }
}
```

### Grafanaä»ªè¡¨æ¿é…ç½®

```json
{
  "dashboard": {
    "title": "æ—¥å¿—ç³»ç»Ÿç›‘æ§",
    "panels": [
      {
        "title": "æ—¥å¿—è°ƒç”¨é¢‘ç‡",
        "targets": [
          {
            "expr": "rate(log_calls_total[5m])"
          }
        ]
      },
      {
        "title": "ç¼“å­˜å‘½ä¸­ç‡",
        "targets": [
          {
            "expr": "log_cache_hit_rate"
          }
        ]
      }
    ]
  }
}
```

---

## ğŸ” å®‰å…¨è€ƒè™‘

### è®¿é—®æ§åˆ¶

ç®¡ç†APIå¿…é¡»æ·»åŠ é€‚å½“çš„æƒé™æ§åˆ¶ï¼š

```typescript
@Controller('api/admin/log-levels')
@UseGuards(AdminGuard) // ä»…ç®¡ç†å‘˜å¯è®¿é—®
@UseInterceptors(AuditInterceptor) // å®¡è®¡æ—¥å¿—
export class LogLevelManagementController {
  // ...
}
```

### æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

ç¡®ä¿æ—¥å¿—ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼š

```typescript
// è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿå­—æ®µ
const sanitizeData = (data: any) => {
  const sensitive = ['password', 'token', 'secret', 'key'];
  const cleaned = { ...data };
  
  sensitive.forEach(field => {
    if (cleaned[field]) {
      cleaned[field] = '[REDACTED]';
    }
  });
  
  return cleaned;
};
```

---

## ğŸ“… ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ”¹å†…å®¹ |
|------|------|----------|
| 1.0.0 | 2024-01-11 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€åŠŸèƒ½å®ç° |
| 1.1.0 | å¾…å®š | æ·»åŠ WebSocketæ”¯æŒ |
| 1.2.0 | å¾…å®š | æ·»åŠ æ—¥å¿—èšåˆåŠŸèƒ½ |
| 2.0.0 | å¾…å®š | æ·»åŠ åˆ†å¸ƒå¼æ—¥å¿—æ”¯æŒ |

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›æ—¥å¿—ç³»ç»Ÿã€‚

### æäº¤Issue

è¯·åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- é—®é¢˜æè¿°
- å¤ç°æ­¥éª¤
- æœŸæœ›è¡Œä¸º
- å®é™…è¡Œä¸º
- ç¯å¢ƒä¿¡æ¯

### å¼€å‘æµç¨‹

1. Forkä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/improved-logging`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add: improved logging feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/improved-logging`
5. åˆ›å»ºPull Request

---

## ğŸ“ æ”¯æŒ

- **æ–‡æ¡£**ï¼šæœ¬æ–‡æ¡£
- **ç¤ºä¾‹**ï¼š`examples/logging/`
- **æµ‹è¯•**ï¼š`test/logging/`
- **é—®é¢˜åé¦ˆ**ï¼šåˆ›å»ºGitHub Issue

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0.0  
**æœ€åæ›´æ–°**ï¼š2024-01-11  
**ç»´æŠ¤è€…**ï¼šç³»ç»Ÿæ¶æ„å›¢é˜Ÿ