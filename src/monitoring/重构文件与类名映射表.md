# 📋 Monitoring组件重构 - 文件与类名映射表

> 遵循原则：文件名与父目录名保持一致，类名与文件名保持一致

## 🎯 重构原则

1. **文件命名规范**
   - 主服务文件：`{directory-name}.service.ts`
   - 主控制器文件：`{directory-name}.controller.ts`
   - 主模块文件：`{directory-name}.module.ts`
   - 子功能文件：`{directory-name}-{feature}.service.ts`

2. **类命名规范**
   - 服务类：`{PascalCase}Service`
   - 控制器类：`{PascalCase}Controller`
   - 模块类：`{PascalCase}Module`
   - 拦截器类：`{PascalCase}Interceptor`
   - 仓库类：`{PascalCase}Repository`

## 📁 Infrastructure层 重构映射

### 文件名映射表

| 当前文件路径 | 目标文件路径 | 变更说明 |
|------------|------------|---------|
| `infrastructure/infrastructure.module.ts` | ✅ 保持不变 | 已符合规范 |
| `infrastructure/metrics/infrastructure-metrics.module.ts` | `infrastructure/metrics/metrics.module.ts` | 去除冗余前缀 |
| `infrastructure/metrics/infrastructure-metrics.constants.ts` | `infrastructure/metrics/metrics.constants.ts` | 去除冗余前缀 |
| `infrastructure/metrics/infrastructure-metrics-registry.service.ts` | `infrastructure/metrics/metrics-registry.service.ts` | 去除冗余前缀 |
| `infrastructure/interceptors/infrastructure-performance.interceptor.ts` | `infrastructure/interceptors/infrastructure.interceptor.ts` | 主拦截器 |
| `infrastructure/interceptors/infrastructure-metrics.interceptor.ts` | `infrastructure/interceptors/infrastructure-metrics.interceptor.ts` | 子功能拦截器 |
| `infrastructure/decorators/infrastructure-monitoring-config.decorator.ts` | `infrastructure/decorators/infrastructure-config.decorator.ts` | 简化命名 |
| `infrastructure/decorators/infrastructure-database-performance.decorator.ts` | `infrastructure/decorators/infrastructure-database.decorator.ts` | 简化命名 |
| `infrastructure/helper/metrics-helper.ts` | `infrastructure/helper/infrastructure-helper.ts` | 与目录一致 |
| **新增** | `infrastructure/infrastructure.service.ts` | 基础设施主服务 |
| **新增** | `infrastructure/infrastructure-cache.service.ts` | 缓存服务 |
| **新增** | `infrastructure/infrastructure-lock.service.ts` | 分布式锁服务 |
| **新增** | `infrastructure/infrastructure-sanitizer.service.ts` | 数据脱敏服务 |

### 类名映射表

| 当前类名 | 目标类名 | 文件位置 |
|---------|---------|---------|
| `InfrastructureMetricsRegistryService` | `MetricsRegistryService` | `metrics/metrics-registry.service.ts` |
| `InfrastructurePerformanceInterceptor` | `InfrastructureInterceptor` | `interceptors/infrastructure.interceptor.ts` |
| `InfrastructureMetricsInterceptor` | `InfrastructureMetricsInterceptor` | `interceptors/infrastructure-metrics.interceptor.ts` |
| **新增** | `InfrastructureService` | `infrastructure.service.ts` |
| **新增** | `InfrastructureCacheService` | `infrastructure-cache.service.ts` |
| **新增** | `InfrastructureLockService` | `infrastructure-lock.service.ts` |
| **新增** | `InfrastructureSanitizerService` | `infrastructure-sanitizer.service.ts` |

## 📊 Collector层 重构映射

### 文件名映射表

| 当前文件路径 | 目标文件路径 | 变更说明 |
|------------|------------|---------|
| `collector/collector.module.ts` | ✅ 保持不变 | 已符合规范 |
| `collector/services/collector.service.ts` | `collector/collector.service.ts` | 移到根目录 |
| `collector/interceptors/collector.interceptor.ts` | ✅ 保持不变 | 已符合规范 |
| `collector/repositories/collector.repository.ts` | ✅ 保持不变 | 已符合规范 |
| **新增** | `collector/collector-validation.service.ts` | 数据验证服务 |
| **新增** | `collector/collector-task.service.ts` | 异步任务服务 |

### 类名映射表

| 当前类名 | 目标类名 | 文件位置 |
|---------|---------|---------|
| `CollectorService` | ✅ 保持不变 | `collector.service.ts` |
| `CollectorInterceptor` | ✅ 保持不变 | `collector.interceptor.ts` |
| `CollectorRepository` | ✅ 保持不变 | `collector.repository.ts` |
| **新增** | `CollectorValidationService` | `collector-validation.service.ts` |
| **新增** | `CollectorTaskService` | `collector-task.service.ts` |

## 🧠 Analyzer层 重构映射

### 文件名映射表

| 当前文件路径 | 目标文件路径 | 变更说明 |
|------------|------------|---------|
| `analyzer/analyzer.module.ts` | ✅ 保持不变 | 已符合规范 |
| `analyzer/services/analyzer.service.ts` | `analyzer/analyzer.service.ts` | 移到根目录 |
| `analyzer/services/analyzer-health.service.ts` | `analyzer/analyzer-health.service.ts` | 移到根目录 |
| `analyzer/services/analyzer-trend.service.ts` | `analyzer/analyzer-trend.service.ts` | 移到根目录 |
| `analyzer/cache/analyzer-cache.service.ts` | `analyzer/analyzer-cache.service.ts` | 移到根目录 |
| `analyzer/calculators/analyzer-metrics.calculator.ts` | `analyzer/analyzer-metrics.service.ts` | 改为service |
| `analyzer/calculators/analyzer-health-score.calculator.ts` | `analyzer/analyzer-score.service.ts` | 改为service |
| **新增** | `analyzer/analyzer.repository.ts` | 分析数据仓库 |
| **新增** | `analyzer/analyzer-engine.service.ts` | 统计引擎服务 |

### 类名映射表

| 当前类名 | 目标类名 | 文件位置 |
|---------|---------|---------|
| `AnalyzerService` | ✅ 保持不变 | `analyzer.service.ts` |
| `HealthAnalyzerService` | `AnalyzerHealthService` | `analyzer-health.service.ts` |
| `TrendAnalyzerService` | `AnalyzerTrendService` | `analyzer-trend.service.ts` |
| `AnalyzerCacheService` | ✅ 保持不变 | `analyzer-cache.service.ts` |
| **新增** | `AnalyzerRepository` | `analyzer.repository.ts` |
| **新增** | `AnalyzerEngineService` | `analyzer-engine.service.ts` |
| **新增** | `AnalyzerMetricsService` | `analyzer-metrics.service.ts` |
| **新增** | `AnalyzerScoreService` | `analyzer-score.service.ts` |

## 📈 Presenter层 重构映射

### 文件名映射表

| 当前文件路径 | 目标文件路径 | 变更说明 |
|------------|------------|---------|
| `presenter/presenter.module.ts` | ✅ 保持不变 | 已符合规范 |
| `presenter/controllers/presenter.controller.ts` | `presenter/presenter.controller.ts` | 移到根目录 |
| `presenter/services/presenter.service.ts` | `presenter/presenter.service.ts` | 移到根目录 |
| `presenter/services/presenter-error-handler.service.ts` | `presenter/presenter-error.service.ts` | 简化命名 |
| `presenter/dto/presenter-response.dto.ts` | ✅ 保持不变 | 已符合规范 |
| `presenter/dto/presenter-query.dto.ts` | ✅ 保持不变 | 已符合规范 |
| **新增** | `presenter/presenter-formatter.service.ts` | 格式化服务 |
| **新增** | `presenter/presenter-report.service.ts` | 报告生成服务 |

### 类名映射表

| 当前类名 | 目标类名 | 文件位置 |
|---------|---------|---------|
| `PresenterController` | ✅ 保持不变 | `presenter.controller.ts` |
| `PresenterService` | ✅ 保持不变 | `presenter.service.ts` |
| `PresenterErrorHandlerService` | `PresenterErrorService` | `presenter-error.service.ts` |
| **新增** | `PresenterFormatterService` | `presenter-formatter.service.ts` |
| **新增** | `PresenterReportService` | `presenter-report.service.ts` |

## 🔧 Shared/Contracts层 重构映射

### 文件名映射表

| 当前文件路径 | 目标文件路径 | 变更说明 |
|------------|------------|---------|
| `shared/types/monitoring.types.ts` | `shared/types/shared.types.ts` | 与目录一致 |
| `shared/constants/monitoring.constants.ts` | `shared/constants/shared.constants.ts` | 与目录一致 |
| `shared/utils/monitoring.utils.ts` | `shared/utils/shared.utils.ts` | 与目录一致 |
| `shared/interfaces/monitoring.interface.ts` | `shared/interfaces/shared.interface.ts` | 与目录一致 |
| `contracts/interfaces/collector.interface.ts` | ✅ 保持不变 | 保持语义清晰 |
| `contracts/interfaces/analyzer.interface.ts` | ✅ 保持不变 | 保持语义清晰 |
| `contracts/interfaces/error-handler.interface.ts` | ✅ 保持不变 | 保持语义清晰 |

## 🚀 重构执行脚本

```bash
#!/bin/bash
# 文件重命名脚本

# Infrastructure层
mv src/monitoring/infrastructure/metrics/infrastructure-metrics.module.ts src/monitoring/infrastructure/metrics/metrics.module.ts
mv src/monitoring/infrastructure/metrics/infrastructure-metrics.constants.ts src/monitoring/infrastructure/metrics/metrics.constants.ts
mv src/monitoring/infrastructure/metrics/infrastructure-metrics-registry.service.ts src/monitoring/infrastructure/metrics/metrics-registry.service.ts
mv src/monitoring/infrastructure/interceptors/infrastructure-performance.interceptor.ts src/monitoring/infrastructure/interceptors/infrastructure.interceptor.ts
mv src/monitoring/infrastructure/decorators/infrastructure-monitoring-config.decorator.ts src/monitoring/infrastructure/decorators/infrastructure-config.decorator.ts
mv src/monitoring/infrastructure/decorators/infrastructure-database-performance.decorator.ts src/monitoring/infrastructure/decorators/infrastructure-database.decorator.ts
mv src/monitoring/infrastructure/helper/metrics-helper.ts src/monitoring/infrastructure/helper/infrastructure-helper.ts

# Collector层
mv src/monitoring/collector/services/collector.service.ts src/monitoring/collector/collector.service.ts
rmdir src/monitoring/collector/services

# Analyzer层
mv src/monitoring/analyzer/services/analyzer.service.ts src/monitoring/analyzer/analyzer.service.ts
mv src/monitoring/analyzer/services/analyzer-health.service.ts src/monitoring/analyzer/analyzer-health.service.ts
mv src/monitoring/analyzer/services/analyzer-trend.service.ts src/monitoring/analyzer/analyzer-trend.service.ts
mv src/monitoring/analyzer/cache/analyzer-cache.service.ts src/monitoring/analyzer/analyzer-cache.service.ts
mv src/monitoring/analyzer/calculators/analyzer-metrics.calculator.ts src/monitoring/analyzer/analyzer-metrics.service.ts
mv src/monitoring/analyzer/calculators/analyzer-health-score.calculator.ts src/monitoring/analyzer/analyzer-score.service.ts
rmdir src/monitoring/analyzer/services
rmdir src/monitoring/analyzer/cache
rmdir src/monitoring/analyzer/calculators

# Presenter层
mv src/monitoring/presenter/controllers/presenter.controller.ts src/monitoring/presenter/presenter.controller.ts
mv src/monitoring/presenter/services/presenter.service.ts src/monitoring/presenter/presenter.service.ts
mv src/monitoring/presenter/services/presenter-error-handler.service.ts src/monitoring/presenter/presenter-error.service.ts
rmdir src/monitoring/presenter/controllers
rmdir src/monitoring/presenter/services

# Shared层
mv src/monitoring/shared/types/monitoring.types.ts src/monitoring/shared/types/shared.types.ts
mv src/monitoring/shared/constants/monitoring.constants.ts src/monitoring/shared/constants/shared.constants.ts
mv src/monitoring/shared/utils/monitoring.utils.ts src/monitoring/shared/utils/shared.utils.ts
mv src/monitoring/shared/interfaces/monitoring.interface.ts src/monitoring/shared/interfaces/shared.interface.ts
```

## 📝 导入路径更新示例

### 更新前
```typescript
import { InfrastructureMetricsRegistryService } from './metrics/infrastructure-metrics-registry.service';
import { HealthAnalyzerService } from './services/analyzer-health.service';
import { PresenterErrorHandlerService } from './services/presenter-error-handler.service';
```

### 更新后
```typescript
import { MetricsRegistryService } from './metrics/metrics-registry.service';
import { AnalyzerHealthService } from './analyzer-health.service';
import { PresenterErrorService } from './presenter-error.service';
```

## ⚠️ 注意事项

1. **逐层重构** - 建议按层级顺序进行重构，从Infrastructure开始
2. **测试验证** - 每完成一层的重构，运行相关测试确保功能正常
3. **导入更新** - 使用IDE的重构功能自动更新所有导入路径
4. **版本控制** - 在重构前创建备份分支
5. **代码审查** - 重构完成后进行代码审查，确保一致性

## 📊 重构统计

- **需要重命名的文件**: 23个
- **需要重命名的类**: 8个  
- **需要创建的新文件**: 14个
- **需要删除的空目录**: 6个
- **预计工作量**: 4-6小时

## ✅ 重构后的优势

1. **命名一致性** - 文件名、类名、目录名高度一致
2. **易于维护** - 看文件名即知功能和层级
3. **减少嵌套** - 扁平化目录结构，减少不必要的子目录
4. **符合规范** - 完全符合NestJS最佳实践
5. **提高效率** - 开发者更容易定位和理解代码结构