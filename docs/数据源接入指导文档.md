# æ–°æ•°æ®æºæ¥å…¥å·¥ä½œæŒ‡å¯¼æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸ºæ™ºèƒ½è‚¡ç¥¨æ•°æ®ç³»ç»Ÿæ¥å…¥æ–°çš„æ•°æ®æºæä¾›å•†ã€‚ç³»ç»Ÿé‡‡ç”¨è‡ªåŠ¨å‘ç°æœºåˆ¶ï¼Œåªéœ€æŒ‰ç…§æ ‡å‡†ç»“æ„åˆ›å»ºæ–‡ä»¶ï¼Œç³»ç»Ÿä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œæ‰€æœ‰èƒ½åŠ›ã€‚

## ğŸ¯ è‡ªåŠ¨å‘ç°æœºåˆ¶åŸç†

### å·¥ä½œæµç¨‹

1. **å¯åŠ¨æ—¶æ‰«æ**: ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œ`CapabilityRegistryService` è‡ªåŠ¨æ‰«æ `src/providers/` ç›®å½•
2. **ç›®å½•éå†**: è¯†åˆ«æ‰€æœ‰æä¾›å•†ç›®å½•ï¼ˆæ’é™¤ `node_modules`ã€`interfaces` ç­‰ç³»ç»Ÿç›®å½•ï¼‰
3. **èƒ½åŠ›å‘ç°**: åœ¨æ¯ä¸ªæä¾›å•†çš„ `capabilities/` å­ç›®å½•ä¸­æŸ¥æ‰¾èƒ½åŠ›æ–‡ä»¶
4. **åŠ¨æ€åŠ è½½**: é€šè¿‡ ES6 åŠ¨æ€å¯¼å…¥åŠ è½½èƒ½åŠ›æ¨¡å—
5. **è‡ªåŠ¨æ³¨å†Œ**: å°†æœ‰æ•ˆçš„èƒ½åŠ›è‡ªåŠ¨æ³¨å†Œåˆ°èƒ½åŠ›æ³¨å†Œè¡¨

### æ ¸å¿ƒä»£ç å®ç°

```typescript
// CapabilityRegistryService.discoverCapabilities()
async discoverCapabilities(): Promise<void> {
  this.logger.log('å¼€å§‹è‡ªåŠ¨å‘ç°æ•°æ®æºèƒ½åŠ›...');
  
  const providersPath = __dirname;
  try {
    const providerDirs = await readdir(providersPath, { withFileTypes: true });

    // æ’é™¤ç³»ç»Ÿç›®å½•å’Œæ–‡ä»¶ï¼Œåªæ‰«æå¯èƒ½çš„æä¾›å•†ç›®å½•
    const excludedDirs = ['node_modules', 'interfaces'];
    
    for (const dirent of providerDirs) {
      if (dirent.isDirectory() && 
          !excludedDirs.includes(dirent.name) &&
          !dirent.name.startsWith('.')) {
        await this.loadProviderCapabilities(dirent.name);
      }
    }

    this.logger.log({
      message: 'èƒ½åŠ›å‘ç°å®Œæˆ',
      totalCapabilities: this.getTotalCapabilitiesCount(),
    });
  } catch (error) {
    this.logger.error(
      { error: error.stack },
      'è‡ªåŠ¨å‘ç°èƒ½åŠ›æ—¶å‘ç”Ÿé”™è¯¯',
    );
  }
}
```

## ğŸ—ï¸ æ¥å…¥æ–°æ•°æ®æºæ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæä¾›å•†ç›®å½•ç»“æ„

åœ¨ `src/providers/` ä¸‹åˆ›å»ºæ–°çš„æä¾›å•†ç›®å½•ï¼š

```
src/providers/
â””â”€â”€ [æ–°æä¾›å•†åç§°]/
    â”œâ”€â”€ capabilities/           # èƒ½åŠ›å®ç°ç›®å½•ï¼ˆå¿…éœ€ï¼‰
    â”œâ”€â”€ [æä¾›å•†åç§°].provider.ts   # æä¾›å•†ä¸»ç±»ï¼ˆå¿…éœ€ï¼‰
    â”œâ”€â”€ [æä¾›å•†åç§°].module.ts     # NestJSæ¨¡å—ï¼ˆå¿…éœ€ï¼‰
    â”œâ”€â”€ types.ts               # ç±»å‹å®šä¹‰ï¼ˆæ¨èï¼‰
    â””â”€â”€ [æä¾›å•†åç§°]-context.service.ts  # ä¸Šä¸‹æ–‡æœåŠ¡ï¼ˆå¯é€‰ï¼‰
```

### ç¬¬äºŒæ­¥ï¼šå®ç°æä¾›å•†ä¸»ç±»

åˆ›å»ºæä¾›å•†ç±»ï¼Œå®ç° `IDataProvider` æ¥å£ï¼š

```typescript
// src/providers/newprovider/newprovider.provider.ts
import { Injectable } from '@nestjs/common';
import { createLogger } from '@common/config/logger.config';
import { IDataProvider } from '../interfaces/provider.interface';
import { ICapability } from '../interfaces/capability.interface';

@Injectable()
export class NewProviderProvider implements IDataProvider {
  private readonly logger = createLogger(NewProviderProvider.name);
  
  readonly name = 'newprovider';
  readonly description = 'æ–°æ•°æ®æä¾›å•†æè¿°';
  readonly capabilities: ICapability[] = [];

  constructor(
    // æ³¨å…¥é…ç½®æœåŠ¡ã€ä¸Šä¸‹æ–‡æœåŠ¡ç­‰ä¾èµ–
  ) {}

  async initialize(): Promise<void> {
    this.logger.log('åˆå§‹åŒ–æ–°æ•°æ®æä¾›å•†...');
    // å®ç°åˆå§‹åŒ–é€»è¾‘
    this.logger.log('æ–°æ•°æ®æä¾›å•†åˆå§‹åŒ–å®Œæˆ');
  }

  async testConnection(): Promise<boolean> {
    try {
      // å®ç°è¿æ¥æµ‹è¯•é€»è¾‘
      return true;
    } catch (error) {
      this.logger.error('è¿æ¥æµ‹è¯•å¤±è´¥', { error: error.message });
      return false;
    }
  }

  getCapability(name: string): ICapability | null {
    return this.capabilities.find(cap => cap.name === name) || null;
  }
}
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºNestJSæ¨¡å—

```typescript
// src/providers/newprovider/newprovider.module.ts
import { Module } from '@nestjs/common';
import { NewProviderProvider } from './newprovider.provider';

@Module({
  providers: [NewProviderProvider],
  exports: [NewProviderProvider],
})
export class NewProviderModule {}
```

### ç¬¬å››æ­¥ï¼šå®ç°èƒ½åŠ›æ–‡ä»¶

åœ¨ `capabilities/` ç›®å½•ä¸‹åˆ›å»ºèƒ½åŠ›å®ç°æ–‡ä»¶ï¼š

```typescript
// src/providers/newprovider/capabilities/get-stock-quote.ts
import { ICapability } from '../../interfaces/capability.interface';
import { MARKETS } from '@common/constants/market.constants';

/**
 * æ–°æä¾›å•†è‚¡ç¥¨æŠ¥ä»·è·å–èƒ½åŠ›
 */
export const getStockQuote: ICapability = {
  name: 'get-stock-quote',
  description: 'è·å–è‚¡ç¥¨å®æ—¶æŠ¥ä»·æ•°æ®',
  supportedMarkets: [MARKETS.HK, MARKETS.US, MARKETS.SZ, MARKETS.SH],
  supportedSymbolFormats: ['700.HK', 'AAPL.US', '000001.SZ', '600000.SH'],
  rateLimit: {
    requestsPerSecond: 10,
    requestsPerDay: 10000,
  },

  async execute(params: { symbols: string[], contextService?: any }): Promise<any> {
    try {
      console.log('è°ƒç”¨æ–°æä¾›å•†APIè·å–è‚¡ç¥¨æŠ¥ä»·:', params.symbols);
      
      // å®ç°å…·ä½“çš„APIè°ƒç”¨é€»è¾‘
      // const quotes = await this.callProviderAPI(params.symbols);
      
      // è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
      const secu_quote = []; // è½¬æ¢åçš„æ•°æ®
      
      return { secu_quote };
    } catch (error) {
      throw new Error(`æ–°æä¾›å•†è·å–è‚¡ç¥¨æŠ¥ä»·å¤±è´¥: ${error.message}`);
    }
  },
};

// é‡è¦ï¼šå¿…é¡»é»˜è®¤å¯¼å‡º
export default getStockQuote;
```

### ç¬¬äº”æ­¥ï¼šæ³¨å†Œåˆ°ä¸»æ¨¡å—

åœ¨ `src/providers/providers.module.ts` ä¸­æ·»åŠ æ–°æ¨¡å—ï¼š

```typescript
import { Module, OnModuleInit } from '@nestjs/common';
import { CapabilityRegistryService } from './capability-registry.service';
import { ProvidersController } from './providers-controller';
import { AuthModule } from '../auth/auth.module';

// Provider modules
import { LongportModule } from './longport/longport.module';
import { LongportSgModule } from './longport-sg/longport-sg.module';
import { NewProviderModule } from './newprovider/newprovider.module'; // æ–°å¢

// Providerå®ä¾‹å¯¼å…¥
import { LongportProvider } from './longport/longport.provider';
import { LongportSgProvider } from './longport-sg/longport-sg.provider';
import { NewProviderProvider } from './newprovider/newprovider.provider'; // æ–°å¢

@Module({
  imports: [
    AuthModule,
    LongportModule,
    LongportSgModule,
    NewProviderModule, // æ–°å¢
  ],
  controllers: [ProvidersController],
  providers: [CapabilityRegistryService],
  exports: [CapabilityRegistryService],
})
export class ProvidersModule implements OnModuleInit {
  constructor(
    private readonly capabilityRegistry: CapabilityRegistryService,
    private readonly longportProvider: LongportProvider,
    private readonly longportSgProvider: LongportSgProvider,
    private readonly newProvider: NewProviderProvider, // æ–°å¢
  ) {}

  async onModuleInit() {
    // ğŸ¯ è‡ªåŠ¨æ³¨å†Œæ‰€æœ‰Providerå®ä¾‹
    await this.registerProviders();
  }

  private async registerProviders(): Promise<void> {
    // æ³¨å†Œç°æœ‰Provider
    this.capabilityRegistry.registerProvider(this.longportProvider);
    this.capabilityRegistry.registerProvider(this.longportSgProvider);
    
    // æ³¨å†Œæ–°Provider
    this.capabilityRegistry.registerProvider(this.newProvider); // æ–°å¢
  }
}
```

**é‡è¦è¯´æ˜**ï¼š
- é™¤äº†æ·»åŠ æ¨¡å—å¯¼å…¥å¤–ï¼Œè¿˜å¿…é¡»æ‰‹åŠ¨æ³¨å†ŒProviderå®ä¾‹
- Providerå®ä¾‹æ³¨å†Œæ˜¯å¿…éœ€çš„ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶è·å–Providerçš„ä¸Šä¸‹æ–‡æœåŠ¡
- è‡ªåŠ¨å‘ç°æœºåˆ¶åªè´Ÿè´£æ‰«æå’Œæ³¨å†Œèƒ½åŠ›ï¼Œä¸è´Ÿè´£Providerå®ä¾‹ç®¡ç†

## ğŸ“‹ æ¥å£è§„èŒƒ

### IDataProvider æ¥å£

**ä½ç½®**: `src/providers/interfaces/provider.interface.ts`

```typescript
export interface IDataProvider {
  name: string;                                    // æä¾›å•†åç§°
  description: string;                             // æä¾›å•†æè¿°
  capabilities: ICapability[];                     // èƒ½åŠ›åˆ—è¡¨
  initialize(): Promise<void>;                     // åˆå§‹åŒ–æ–¹æ³•
  testConnection(): Promise<boolean>;               // è¿æ¥æµ‹è¯•
  getCapability(name: string): ICapability | null; // è·å–æŒ‡å®šèƒ½åŠ›
}
```

### ICapability æ¥å£

**ä½ç½®**: `src/providers/interfaces/capability.interface.ts`

```typescript
export interface ICapability {
  name: string;                    // èƒ½åŠ›åç§°
  description: string;             // èƒ½åŠ›æè¿°
  supportedMarkets: string[];      // æ”¯æŒçš„å¸‚åœº
  supportedSymbolFormats: string[]; // æ”¯æŒçš„è‚¡ç¥¨ä»£ç æ ¼å¼
  rateLimit?: {                    // é€Ÿç‡é™åˆ¶ï¼ˆå¯é€‰ï¼‰
    requestsPerSecond: number;
    requestsPerDay: number;
  };
  execute(params: any): Promise<any>; // æ‰§è¡Œæ–¹æ³•
}
```

**æ­£ç¡®çš„å¯¼å…¥æ–¹å¼**ï¼š
```typescript
import { IDataProvider } from '../interfaces/provider.interface';
import { ICapability } from '../interfaces/capability.interface';
```

## ğŸ¯ æ ‡å‡†èƒ½åŠ›ç±»å‹

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹æ ‡å‡†èƒ½åŠ›ç±»å‹ï¼Œå»ºè®®æ–°æä¾›å•†å®ç°ï¼š

| èƒ½åŠ›åç§° | æè¿° | å¯¹åº”APIæ•°æ®ç±»å‹ |
|---------|------|---------------|
| `get-stock-quote` | è·å–è‚¡ç¥¨å®æ—¶æŠ¥ä»· | `stock-quote` |
| `get-stock-basic-info` | è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ | `stock-basic-info` |
| `get-index-quote` | è·å–æŒ‡æ•°æŠ¥ä»· | `index-quote` |
| `get-market-status` | è·å–å¸‚åœºçŠ¶æ€ | `market-status` |
| `get-trading-days` | è·å–äº¤æ˜“æ—¥å† | `trading-days` |

## ğŸ“ æ–‡ä»¶å‘½åè§„èŒƒ

- **æä¾›å•†ç›®å½•**: ä½¿ç”¨å°å†™å­—æ¯ï¼Œå¯é€‰è¿å­—ç¬¦ï¼Œå¦‚ `longport`ã€`longport-sg`
- **Providerç±»**: ä½¿ç”¨PascalCase + Provideråç¼€ï¼Œå¦‚ `LongportProvider`ã€`LongportSgProvider`
- **Moduleç±»**: ä½¿ç”¨PascalCase + Moduleåç¼€ï¼Œå¦‚ `LongportModule`ã€`LongportSgModule`  
- **èƒ½åŠ›æ–‡ä»¶**: ä½¿ç”¨è¿å­—ç¬¦åˆ†éš”ï¼Œå¦‚ `get-stock-quote.ts`
- **ç±»å‹æ–‡ä»¶**: ç»Ÿä¸€å‘½åä¸º `types.ts`
- **ContextæœåŠ¡**: ä½¿ç”¨è¿å­—ç¬¦ + context.service.tsï¼Œå¦‚ `longport-context.service.ts`

**å®é™…æ¡ˆä¾‹**ï¼š
```
src/providers/
â”œâ”€â”€ longport/                        # æ— è¿å­—ç¬¦
â”‚   â”œâ”€â”€ longport.provider.ts         # ç±»å: LongportProvider
â”‚   â”œâ”€â”€ longport.module.ts           # ç±»å: LongportModule
â”‚   â””â”€â”€ longport-context.service.ts  # ç±»å: LongportContextService
â””â”€â”€ longport-sg/                     # æœ‰è¿å­—ç¬¦ï¼ˆåŒºåˆ†åœ°åŒºï¼‰
    â”œâ”€â”€ longport-sg.provider.ts      # ç±»å: LongportSgProvider
    â”œâ”€â”€ longport-sg.module.ts        # ç±»å: LongportSgModule
    â””â”€â”€ longport-sg-context.service.ts # ç±»å: LongportSgContextService
```

## ğŸ”§ å®é™…ç¤ºä¾‹ï¼šå‚è€ƒLongPortå®ç°

### ç›®å½•ç»“æ„
```
src/providers/longport/
â”œâ”€â”€ capabilities/
â”‚   â”œâ”€â”€ get-stock-quote.ts
â”‚   â”œâ”€â”€ get-stock-basic-info.ts
â”‚   â””â”€â”€ get-index-quote.ts
â”œâ”€â”€ longport.provider.ts
â”œâ”€â”€ longport.module.ts
â”œâ”€â”€ longport-context.service.ts
â””â”€â”€ types.ts
```

### æ ¸å¿ƒå®ç°è¦ç‚¹

1. **ä¸Šä¸‹æ–‡æœåŠ¡**: ç”¨äºç®¡ç†è¿æ¥æ± å’Œä¼šè¯
2. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
3. **æ•°æ®è½¬æ¢**: å°†æä¾›å•†åŸå§‹æ•°æ®è½¬æ¢ä¸ºç³»ç»Ÿæ ‡å‡†æ ¼å¼
4. **é…ç½®ç®¡ç†**: é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†APIå‡­è¯

## âš¡ è‡ªåŠ¨å‘ç°éªŒè¯

ç³»ç»Ÿå¯åŠ¨åï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯æ–°æä¾›å•†æ˜¯å¦æˆåŠŸæ³¨å†Œï¼š

### 1. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
```bash
bun run dev
# æŸ¥æ‰¾ç±»ä¼¼æ—¥å¿—ï¼š
# [CapabilityRegistryService] åŠ è½½æä¾›å•† newprovider çš„ 3 ä¸ªèƒ½åŠ›
# [CapabilityRegistryService] èƒ½åŠ›å‘ç°å®Œæˆï¼Œå…±æ³¨å†Œ X ä¸ªèƒ½åŠ›
```

### 2. APIæ£€æŸ¥
```bash
# æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„èƒ½åŠ›
curl http://localhost:3000/api/v1/providers/capabilities

# æŸ¥çœ‹ç‰¹å®šæä¾›å•†èƒ½åŠ›
curl http://localhost:3000/api/v1/providers/newprovider/capabilities

# æµ‹è¯•æœ€ä½³æä¾›å•†é€‰æ‹©
curl http://localhost:3000/api/v1/providers/best-provider/get-stock-quote/HK
```

### 3. ä½¿ç”¨æ–°æä¾›å•†
```bash
# ä½¿ç”¨receiveræ¥å£æµ‹è¯•
curl -X POST http://localhost:3000/api/v1/receiver/data \
  -H "Content-Type: application/json" \
  -d '{
    "symbols": ["700.HK"], 
    "capabilityType": "get-stock-quote",
    "options": {"preferredProvider": "newprovider"}
  }'
```

## ğŸš¨ å¸¸è§é—®é¢˜å’Œæ³¨æ„äº‹é¡¹

### 1. èƒ½åŠ›æ–‡ä»¶å¯¼å‡ºè§„èŒƒ
```typescript
// âœ… æ¨èï¼šé»˜è®¤å¯¼å‡ºï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
export default getStockQuote;

// âœ… å¤‡é€‰ï¼šå‘½åå¯¼å‡ºï¼ˆä½œä¸ºfallbackï¼‰
export const getStockQuote: ICapability = { ... };

// âŒ é”™è¯¯ - ä»…ä½¿ç”¨è§£æ„å¯¼å‡º
export { getStockQuote };
```

**åŠ è½½æœºåˆ¶è¯´æ˜**ï¼šç³»ç»Ÿä¼šæŒ‰ä¼˜å…ˆçº§å°è¯•åŠ è½½ï¼š
1. é¦–å…ˆå°è¯• `capabilityModule.default`
2. å¦‚æœå¤±è´¥ï¼Œå°è¯• `capabilityModule[camelCaseName]`
3. ä¸¤è€…éƒ½å¤±è´¥åˆ™è·³è¿‡è¯¥èƒ½åŠ›

### 2. ç›®å½•ç»“æ„å¿…é¡»æ­£ç¡®
```
src/providers/
â””â”€â”€ newprovider/          # æä¾›å•†ç›®å½•
    â””â”€â”€ capabilities/     # èƒ½åŠ›ç›®å½•ï¼ˆå¿…éœ€ï¼‰
        â””â”€â”€ *.ts         # èƒ½åŠ›æ–‡ä»¶
```

### 3. å®ç°ICapabilityæ¥å£
æ‰€æœ‰èƒ½åŠ›æ–‡ä»¶å¿…é¡»å®ç°å®Œæ•´çš„ `ICapability` æ¥å£ï¼Œç‰¹åˆ«æ˜¯ `execute` æ–¹æ³•ã€‚

### 4. é”™è¯¯å¤„ç†
åœ¨ `execute` æ–¹æ³•ä¸­è¿›è¡Œå……åˆ†çš„é”™è¯¯å¤„ç†ï¼Œå¹¶æŠ›å‡ºæœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯ã€‚

### 5. æ•°æ®æ ¼å¼æ ‡å‡†åŒ–
è¿”å›çš„æ•°æ®åº”è¯¥è½¬æ¢ä¸ºç³»ç»Ÿæ ‡å‡†æ ¼å¼ï¼Œä¾¿äºåç»­å¤„ç†ã€‚

## ğŸ”„ å®Œæ•´çš„æ³¨å†Œå’Œå‘ç°æœºåˆ¶

### åŒé‡æ³¨å†Œæœºåˆ¶

ç³»ç»Ÿé‡‡ç”¨**èƒ½åŠ›è‡ªåŠ¨å‘ç°** + **Providerå®ä¾‹æ‰‹åŠ¨æ³¨å†Œ**çš„åŒé‡æœºåˆ¶ï¼š

#### 1. èƒ½åŠ›è‡ªåŠ¨å‘ç°ï¼ˆå¯åŠ¨æ—¶ï¼‰
```typescript
// CapabilityRegistryService è‡ªåŠ¨æ‰«æå’Œæ³¨å†Œèƒ½åŠ›
async discoverCapabilities(): Promise<void> {
  // 1. æ‰«æ src/providers/ ç›®å½•
  // 2. å‘ç°æ‰€æœ‰ capabilities/*.ts æ–‡ä»¶
  // 3. åŠ¨æ€å¯¼å…¥å¹¶æ³¨å†Œèƒ½åŠ›
  // 4. é»˜è®¤ä¼˜å…ˆçº§ä¸º1ï¼ŒçŠ¶æ€ä¸ºenabled
}
```

#### 2. Providerå®ä¾‹æ‰‹åŠ¨æ³¨å†Œï¼ˆæ¨¡å—åˆå§‹åŒ–æ—¶ï¼‰
```typescript
// ProvidersModule æ‰‹åŠ¨æ³¨å†ŒProviderå®ä¾‹
private async registerProviders(): Promise<void> {
  this.capabilityRegistry.registerProvider(this.newProvider);
  // æ³¨å†ŒProviderå®ä¾‹ï¼Œç”¨äºè·å–ä¸Šä¸‹æ–‡æœåŠ¡å’Œè¿æ¥ç®¡ç†
}
```

### èƒ½åŠ›ä¼˜å…ˆçº§å’Œé€‰æ‹©

ç³»ç»Ÿä¼šæ ¹æ®ä»¥ä¸‹è§„åˆ™é€‰æ‹©æœ€ä½³æä¾›å•†ï¼š

1. **ä¼˜å…ˆçº§æ•°å­—**: æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆé»˜è®¤ä¸º1ï¼‰
2. **å¸‚åœºæ”¯æŒ**: æä¾›å•†å¿…é¡»æ”¯æŒè¯·æ±‚çš„å¸‚åœº
3. **èƒ½åŠ›å¯ç”¨çŠ¶æ€**: åªè€ƒè™‘å·²å¯ç”¨çš„èƒ½åŠ›

```typescript
// èƒ½åŠ›æ³¨å†Œæ—¶çš„é»˜è®¤è®¾ç½®
this.registerCapability(providerName, capability, 1, true);
//                                                 â†‘  â†‘
//                                              ä¼˜å…ˆçº§ å¯ç”¨çŠ¶æ€
```

### æ³¨å†ŒçŠ¶æ€éªŒè¯

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯æ³¨å†ŒçŠ¶æ€ï¼š

```bash
# 1. æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„èƒ½åŠ›
curl -H "X-App-Key: YOUR_KEY" -H "X-Access-Token: YOUR_TOKEN" \
  http://localhost:3000/api/v1/providers/capabilities

# 2. æŸ¥çœ‹ç‰¹å®šæä¾›å•†çš„Providerå®ä¾‹æ˜¯å¦æ³¨å†Œ
# åœ¨å¯åŠ¨æ—¥å¿—ä¸­æŸ¥æ‰¾: "Providerå®ä¾‹æ³¨å†ŒæˆåŠŸ: newprovider"
```

## ğŸ“ˆ æµ‹è¯•å’ŒéªŒè¯

1. **å•å…ƒæµ‹è¯•**: ä¸ºæ¯ä¸ªèƒ½åŠ›ç¼–å†™å•å…ƒæµ‹è¯•
2. **é›†æˆæµ‹è¯•**: æµ‹è¯•ä¸ç³»ç»Ÿå…¶ä»–ç»„ä»¶çš„é›†æˆ
3. **APIæµ‹è¯•**: é€šè¿‡Swagger UIæˆ–curlæµ‹è¯•APIç«¯ç‚¹
4. **å‹åŠ›æµ‹è¯•**: éªŒè¯é€Ÿç‡é™åˆ¶å’Œæ€§èƒ½è¡¨ç°

## ğŸ‰ æ¥å…¥å®Œæˆ

æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤å®Œæˆåï¼Œæ–°çš„æ•°æ®æºå°†ï¼š

1. âœ… **èƒ½åŠ›è‡ªåŠ¨å‘ç°**: ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æ‰«æå’Œæ³¨å†Œæ‰€æœ‰èƒ½åŠ›
2. âœ… **Providerå®ä¾‹æ³¨å†Œ**: åœ¨ProvidersModuleä¸­æ‰‹åŠ¨æ³¨å†ŒProviderå®ä¾‹
3. âœ… **APIæ–‡æ¡£æ˜¾ç¤º**: è‡ªåŠ¨åœ¨Swaggeræ–‡æ¡£ä¸­æ˜¾ç¤ºæ–°çš„èƒ½åŠ›
4. âœ… **æ™ºèƒ½æä¾›å•†é€‰æ‹©**: å‚ä¸æœ€ä½³æä¾›å•†é€‰æ‹©ç®—æ³•
5. âœ… **å¤šç§è°ƒç”¨æ–¹å¼**: æ”¯æŒé€šè¿‡Receiverã€Queryç­‰æ–¹å¼è°ƒç”¨
6. âœ… **ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œç›‘æ§**: äº«å—ç³»ç»Ÿçº§çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ç›‘æ§

## ğŸ“ æ¥å…¥æ¸…å•

å®Œæˆæ–°æ•°æ®æºæ¥å…¥éœ€è¦å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

- [ ] **ç¬¬ä¸€æ­¥**: åˆ›å»ºæä¾›å•†ç›®å½•ç»“æ„ (`src/providers/newprovider/`)
- [ ] **ç¬¬äºŒæ­¥**: å®ç°Providerç±» (`newprovider.provider.ts`)
- [ ] **ç¬¬ä¸‰æ­¥**: åˆ›å»ºNestJSæ¨¡å— (`newprovider.module.ts`)
- [ ] **ç¬¬å››æ­¥**: å®ç°èƒ½åŠ›æ–‡ä»¶ (`capabilities/*.ts`)
- [ ] **ç¬¬äº”æ­¥**: æ›´æ–°ProvidersModuleå¯¼å…¥å’Œæ³¨å†Œ
- [ ] **éªŒè¯æ­¥éª¤**: å¯åŠ¨ç³»ç»Ÿå¹¶éªŒè¯èƒ½åŠ›å’ŒProviderå®ä¾‹éƒ½å·²æ³¨å†Œ

**å…³é”®è¦ç‚¹**ï¼š
- èƒ½åŠ›æ–‡ä»¶ä½¿ç”¨é»˜è®¤å¯¼å‡ºæˆ–å‘½åå¯¼å‡º
- å¿…é¡»åœ¨ProvidersModuleä¸­æ‰‹åŠ¨æ³¨å†ŒProviderå®ä¾‹
- èƒ½åŠ›è‡ªåŠ¨å‘ç°æœºåˆ¶å¤„ç†èƒ½åŠ›æ³¨å†Œï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
- ä¸¤ç§æ³¨å†Œæœºåˆ¶ç¼ºä¸€ä¸å¯ï¼Œå…±åŒç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œ

é€šè¿‡è¿™ç§è®¾è®¡ï¼Œç³»ç»Ÿåœ¨ä¿æŒè‡ªåŠ¨åŒ–ä¾¿åˆ©æ€§çš„åŒæ—¶ï¼Œç¡®ä¿äº†Providerå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œä¾èµ–æ³¨å…¥çš„æ­£ç¡®æ€§ã€‚