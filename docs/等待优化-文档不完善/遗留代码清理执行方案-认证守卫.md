## é—ç•™ä»£ç æ¸…ç†æ‰§è¡Œæ–¹æ¡ˆï¼ˆå®Œæ•´ç‰ˆï¼‰

### 1. ç›®æ ‡ä¸èŒƒå›´

#### 1.1 æ€»ä½“ç›®æ ‡
- **æ ¸å¿ƒç›®æ ‡**: æ¸…é™¤é‡æ„åçš„å†²çªä¸é‡å¤ï¼Œå®ç°æ¥å£å¥‘çº¦ä¸å˜ã€åŠŸèƒ½ç­‰ä»·ã€é£é™©æœ€å°åŒ–
- **è´¨é‡ç›®æ ‡**: æå‡ä»£ç å¯ç»´æŠ¤æ€§ï¼Œæ¶ˆé™¤å®‰å…¨éšæ‚£ï¼Œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½
- **å®‰å…¨ç›®æ ‡**: ä¿®å¤æƒé™éªŒè¯æ¼æ´ï¼Œå®Œå–„å¼‚å¸¸å¤„ç†æœºåˆ¶

#### 1.2 æ¸…ç†èŒƒå›´
- **è®¤è¯ä¸æƒé™ç³»ç»Ÿ**: é‡å¤å®ˆå«æ‰§è¡Œã€æƒé™éªŒè¯å¼‚å¸¸å¤„ç†
- **ç›‘æ§ä¸å¥åº·æ£€æŸ¥**: åˆ†æ•£å®ç°èšåˆã€è¯­æ³•é”™è¯¯ä¿®å¤
- **ç¼“å­˜ç³»ç»Ÿ**: å‹ç¼©å®ç°é‡å¤ã€èŒè´£æ•´åˆ
- **Symbol Mapper**: è°ƒç”¨è·¯å¾„ä¼˜åŒ–ã€æ­»ä»£ç æ¸…ç†
- **Legacyä»£ç **: è¿‡æ¸¡åˆ†æ”¯æ¸…ç†ã€æŠ€æœ¯å€ºåŠ¡ç§»é™¤

#### 1.3 æˆåŠŸæ ‡å‡†
- é›¶åŠŸèƒ½å›é€€ï¼Œæ¥å£å¥‘çº¦ä¿æŒä¸å˜
- æ€§èƒ½æå‡ï¼šè®¤è¯æµç¨‹å“åº”æ—¶é—´å‡å°‘15-20%
- å®‰å…¨åŠ å›ºï¼šæ¶ˆé™¤æƒé™ç»•è¿‡é£é™©
- ä»£ç è´¨é‡ï¼šç§»é™¤é‡å¤ä»£ç ï¼Œæå‡å¯ç»´æŠ¤æ€§

---

### 2. é—®é¢˜è¯¦ç»†åˆ†æä¸é£é™©è¯„ä¼°

#### 2.1 P0 é«˜é£é™©é—®é¢˜ï¼ˆå½“å¤©ä¿®å¤ï¼‰

##### 2.1.1 é‡å¤è®¤è¯å®ˆå«æ‰§è¡Œï¼ˆå®‰å…¨æ€§èƒ½åŒé‡é£é™©ï¼‰
**é—®é¢˜æè¿°**: å…¨å±€å®ˆå«ä¸è£…é¥°å™¨å®ˆå«åŒé‡æ‰§è¡Œï¼Œé€ æˆæ€§èƒ½æµªè´¹å’Œå®‰å…¨éšæ‚£

**ä»£ç ä½ç½®**: `src/app.module.ts` + `src/auth/decorators/auth.decorator.ts`
```typescript
// âŒ é—®é¢˜ï¼šå…¨å±€å®ˆå«å·²é…ç½®5ä¸ªå®ˆå«
{
  provide: APP_GUARD,
  useClass: ThrottlerGuard,
},
{
  provide: APP_GUARD,
  useClass: ApiKeyAuthGuard,
},
// ... å…¶ä»–å®ˆå«

// âŒ é—®é¢˜ï¼šè£…é¥°å™¨ä¸­ä»ç„¶é‡å¤ä½¿ç”¨å®ˆå«
UseGuards(ApiKeyAuthGuard, UnifiedPermissionsGuard),
```

**é£é™©è¯„ä¼°**: 
- **æ€§èƒ½å½±å“**: æ¯ä¸ªè¯·æ±‚é‡å¤æ‰§è¡Œè®¤è¯ï¼Œå¢åŠ 15-25%å“åº”æ—¶é—´
- **å®‰å…¨é£é™©**: åŒé‡æ‰§è¡Œå¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´
- **è¿ç»´å½±å“**: é‡å¤æ—¥å¿—è®°å½•ï¼Œå¢åŠ æ’æŸ¥éš¾åº¦

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âœ… ä¿®å¤ï¼šç§»é™¤è£…é¥°å™¨ä¸­çš„é‡å¤å®ˆå«
export function ApiKeyAuth(permissions?: Permission[]) {
  const decorators = [
    // ç§»é™¤ï¼šUseGuards(ApiKeyAuthGuard, UnifiedPermissionsGuard),
    RequireApiKey(),
    ApiSecurity("ApiKey"),
    ApiSecurity("AccessToken"),
  ];
  
  if (permissions && permissions.length > 0) {
    decorators.push(RequirePermissions(...permissions));
  }
  
  return applyDecorators(...decorators);
}
```

##### 2.1.2 API Keyæƒé™èŒƒå›´éªŒè¯å®‰å…¨æ¼æ´ï¼ˆé«˜å®‰å…¨é£é™©ï¼‰
**é—®é¢˜æè¿°**: å¼‚å¸¸å¤„ç†ä¸å®Œæ•´ï¼Œå¯èƒ½å¯¼è‡´æƒé™éªŒè¯ç»•è¿‡

**ä»£ç ä½ç½®**: `src/auth/services/apikey.service.ts:237-246`
```typescript
// âŒ é—®é¢˜ï¼šéForbiddenExceptionå¼‚å¸¸è¢«åå™¬
} catch (error) {
  if (error instanceof ForbiddenException) {
    throw error;
  }
  
  this.logger.error("æƒé™èŒƒå›´éªŒè¯å¤±è´¥", { ... });
  // âŒ å…¶ä»–å¼‚å¸¸åªè®°å½•æ—¥å¿—ï¼Œæœªé˜»æ–­æµç¨‹ï¼Œå­˜åœ¨æƒé™ç»•è¿‡é£é™©
}
```

**å®‰å…¨å½±å“**: 
- æ•°æ®åº“è¿æ¥å¼‚å¸¸æ—¶å¯èƒ½ç»•è¿‡æƒé™æ£€æŸ¥
- æœåŠ¡ä¸å¯ç”¨æ—¶å¯èƒ½å…è®¸è¶Šæƒæ“ä½œ
- è¿åfail-secureå®‰å…¨åŸåˆ™

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âœ… ä¿®å¤ï¼šæ‰€æœ‰éªŒè¯å¤±è´¥éƒ½åº”è¯¥é˜»æ–­æµç¨‹
} catch (error) {
  if (error instanceof ForbiddenException) {
    throw error;
  }
  
  this.logger.error("æƒé™èŒƒå›´éªŒè¯å¤±è´¥", {
    operation,
    userId,
    requestedPermissions,
    errorType: error.constructor.name,
    error: error.stack,
  });
  
  // âœ… ç»Ÿä¸€æŠ›å‡ºæƒé™éªŒè¯å¤±è´¥å¼‚å¸¸
  throw new ForbiddenException("æƒé™èŒƒå›´éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
}
```

##### 2.1.3 Metricså¥åº·æ£€æŸ¥æœåŠ¡è¯­æ³•é”™è¯¯ï¼ˆæ„å»ºé£é™©ï¼‰
**é—®é¢˜æè¿°**: è¯­æ³•é”™è¯¯å¯èƒ½å¯¼è‡´æ„å»ºå¤±è´¥æˆ–è¿è¡Œæ—¶å¼‚å¸¸

**ä»£ç ä½ç½®**: `src/metrics/services/metrics-health.service.ts:20-26`
```typescript
// âŒ é—®é¢˜ï¼šè¯­æ³•ç»“æ„é”™è¯¯
private get redis(): Redis {
  return this.redisService.getOrThrow();

constructor(private readonly redisService: RedisService) {}
```

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âœ… ä¿®å¤ï¼šå®Œå–„è¯­æ³•ç»“æ„å’Œå¼‚å¸¸å¤„ç†
export class MetricsHealthService {
  constructor(private readonly redisService: RedisService) {}
  
  private get redis(): Redis {
    return this.redisService.getOrThrow();
  }
  
  async getHealthStatus(): Promise<HealthStatus> {
    try {
      await this.redis.ping();
      return {
        status: 'healthy',
        timestamp: new Date().toISOString(),
        details: { redis: 'connected' }
      };
    } catch (error) {
      this.logger.warn('Redis health check failed', error);
      return {
        status: 'degraded',
        timestamp: new Date().toISOString(),
        details: { redis: 'disconnected', error: error.message }
      };
    }
  }
}
```

#### 2.2 P1 ä¸­é£é™©é—®é¢˜ï¼ˆ1å‘¨å†…ä¿®å¤ï¼‰

##### 2.2.1 å¥åº·æ£€æŸ¥å®ç°åˆ†æ•£
**é—®é¢˜å½±å“**: ç›‘æ§ç³»ç»Ÿå¤æ‚ï¼Œéš¾ä»¥è·å¾—ç³»ç»Ÿæ•´ä½“å¥åº·çŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºç»Ÿä¸€çš„å¥åº·æ£€æŸ¥èšåˆå™¨
```typescript
// æ–°å»ºï¼šsrc/monitoring/services/health-aggregator.service.ts
@Injectable()
export class HealthAggregatorService {
  constructor(
    private readonly metricsRegistry: MetricsRegistryService,
    private readonly streamRecovery: StreamRecoveryWorkerService,
    private readonly metricsHealth: MetricsHealthService,
  ) {}
  
  async getAggregatedHealth(): Promise<AggregatedHealthStatus> {
    const checks = await Promise.allSettled([
      this.metricsRegistry.getHealthStatus(),
      this.streamRecovery.healthCheck(),
      this.metricsHealth.getHealthStatus(),
    ]);
    
    // èšåˆé€»è¾‘ï¼šä»»ä¸€ç»„ä»¶å¤±è´¥åˆ™æ•´ä½“é™çº§
    const overallStatus = this.calculateOverallStatus(checks);
    
    return {
      status: overallStatus,
      timestamp: new Date().toISOString(),
      components: this.formatComponentResults(checks),
      summary: this.generateHealthSummary(checks)
    };
  }
}
```

##### 2.2.2 ç¼“å­˜å‹ç¼©å®ç°é‡å¤
**é—®é¢˜å½±å“**: åŒé‡å®ç°å¢åŠ ç»´æŠ¤æˆæœ¬ï¼Œå­˜åœ¨æ•°æ®å…¼å®¹æ€§é£é™©

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€å‹ç¼©æœåŠ¡å§”æ‰˜
```typescript
// ä¿®æ”¹ï¼šsrc/cache/services/cache.service.ts
export class CacheService {
  constructor(
    private readonly compressionService: CacheCompressionService, // æ–°æ³¨å…¥
    // ... å…¶ä»–ä¾èµ–
  ) {}
  
  private async compress(data: any): Promise<string> {
    // âœ… å§”æ‰˜ç»™ç»Ÿä¸€çš„å‹ç¼©æœåŠ¡
    const result = await this.compressionService.compress(data);
    return result.compressedData;
  }
  
  private async decompress(value: string): Promise<string> {
    // âœ… å…¼å®¹å†å²æ ¼å¼ + ä½¿ç”¨æ–°è§£å‹æœåŠ¡
    if (value.startsWith(COMPRESSION_PREFIX)) {
      // å†å²æ ¼å¼å…¼å®¹
      const compressedData = value.substring(COMPRESSION_PREFIX.length);
      return this.compressionService.decompress(compressedData);
    }
    // æ–°æ ¼å¼ç›´æ¥è§£å‹
    return this.compressionService.decompress(value);
  }
}
```

#### 2.3 P2 ä½é£é™©é—®é¢˜ï¼ˆ2å‘¨å†…ä¿®å¤ï¼‰

##### 2.3.1 Legacyæ¨¡å¼ä»£ç æ¸…ç†
**æ¸…ç†èŒƒå›´**: ç§»é™¤metricsç³»ç»Ÿä¸­çš„legacyæ¨¡å¼æ”¯æŒ

##### 2.3.2 Symbol MapperèŒè´£æ•´ç†
**æ•´ç†ç›®æ ‡**: ç®€åŒ–æœåŠ¡èŒè´£ï¼Œç§»é™¤æ­»ä»£ç ï¼Œç»Ÿä¸€è°ƒç”¨è·¯å¾„

---

### 3. åˆ†é˜¶æ®µæ‰§è¡Œè®¡åˆ’

#### 3.1 Phase 0 - ç´§æ€¥ä¿®å¤ï¼ˆå½“å¤©å®Œæˆï¼‰

**ç›®æ ‡**: è§£å†³å®‰å…¨é£é™©å’Œæ„å»ºé£é™©ï¼Œæ¢å¤ç³»ç»Ÿç¨³å®šæ€§

**æ‰§è¡Œæ¸…å•**:
- [ ] **Step 1**: ç§»é™¤é‡å¤å®ˆå«ï¼ˆé¢„è®¡2å°æ—¶ï¼‰
  - ä¿®æ”¹ `auth.decorator.ts` ç§»é™¤ `UseGuards`
  - ä¿ç•™æƒé™å…ƒæ•°æ®è£…é¥°å™¨
  - éªŒè¯å…¨å±€å®ˆå«é“¾æ­£å¸¸å·¥ä½œ

- [ ] **Step 2**: ä¿®å¤æƒé™éªŒè¯æ¼æ´ï¼ˆé¢„è®¡1å°æ—¶ï¼‰
  - ä¿®æ”¹ `apikey.service.ts` å¼‚å¸¸å¤„ç†é€»è¾‘
  - æ·»åŠ è¯¦ç»†é”™è¯¯æ—¥å¿—
  - ç¡®ä¿æ‰€æœ‰éªŒè¯å¤±è´¥éƒ½ä¼šé˜»æ–­æµç¨‹

- [ ] **Step 3**: ä¿®å¤è¯­æ³•é”™è¯¯ï¼ˆé¢„è®¡0.5å°æ—¶ï¼‰
  - ä¿®å¤ `metrics-health.service.ts` è¯­æ³•é—®é¢˜
  - å®Œå–„å¥åº·æ£€æŸ¥é€»è¾‘
  - ç¡®ä¿æ„å»ºå’Œè¿è¡Œæ­£å¸¸

**éªŒè¯æ ‡å‡†**:
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•è¦†ç›–è®¤è¯æµç¨‹
- [ ] æ€§èƒ½æµ‹è¯•æ˜¾ç¤ºå“åº”æ—¶é—´æ”¹å–„
- [ ] å®‰å…¨æµ‹è¯•ç¡®è®¤æƒé™éªŒè¯æœ‰æ•ˆ

#### 3.2 Phase 1 - æ¶æ„ä¼˜åŒ–ï¼ˆ1å‘¨å®Œæˆï¼‰

**ç›®æ ‡**: ç»Ÿä¸€å¥åº·æ£€æŸ¥ç³»ç»Ÿï¼Œæ•´åˆç¼“å­˜å‹ç¼©å®ç°

**æ‰§è¡Œæ¸…å•**:
- [ ] **Week 1 Day 1-2**: å¥åº·æ£€æŸ¥èšåˆå™¨
  - è®¾è®¡èšåˆå™¨æ¥å£
  - å®ç°ç»Ÿä¸€å¥åº·æ£€æŸ¥æœåŠ¡
  - ä¿®æ”¹ç°æœ‰æ§åˆ¶å™¨è°ƒç”¨æ–°æœåŠ¡
  - ä¿æŒAPIæ¥å£ä¸å˜

- [ ] **Week 1 Day 3-4**: ç¼“å­˜å‹ç¼©ç»Ÿä¸€
  - å®ç°å‹ç¼©æœåŠ¡å§”æ‰˜
  - æ·»åŠ å†å²æ•°æ®å…¼å®¹æ€§
  - æ•°æ®è¿ç§»éªŒè¯
  - æ€§èƒ½å›å½’æµ‹è¯•

- [ ] **Week 1 Day 5**: é›†æˆæµ‹è¯•å’ŒéªŒè¯
  - ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
  - æ€§èƒ½åŸºå‡†å¯¹æ¯”
  - ç›‘æ§æŒ‡æ ‡éªŒè¯

#### 3.3 Phase 2 - æŠ€æœ¯å€ºåŠ¡æ¸…ç†ï¼ˆ2å‘¨å®Œæˆï¼‰

**ç›®æ ‡**: ç§»é™¤legacyä»£ç ï¼Œæ•´ç†Symbol MapperèŒè´£

**æ‰§è¡Œæ¸…å•**:
- [ ] **Week 2 Day 1-3**: Legacyä»£ç æ¸…ç†
  - ç§»é™¤metrics legacyæ¨¡å¼
  - æ¸…ç†æœªä½¿ç”¨çš„è¿‡æ»¤å™¨
  - æ›´æ–°ç›¸å…³æ–‡æ¡£

- [ ] **Week 2 Day 4-5**: Symbol Mapperæ•´ç†
  - ç®€åŒ–æœåŠ¡èŒè´£
  - ç§»é™¤æ­»ç¼“å­˜ä»£ç 
  - ç»Ÿä¸€è°ƒç”¨è·¯å¾„

- [ ] **Week 3 Day 1-2**: æœ€ç»ˆéªŒè¯å’Œæ–‡æ¡£
  - å®Œæ•´å›å½’æµ‹è¯•
  - æ€§èƒ½åŸºå‡†ç¡®è®¤
  - æ›´æ–°æŠ€æœ¯æ–‡æ¡£

---

### 4. è´¨é‡ä¿è¯ç­–ç•¥

#### 4.1 æµ‹è¯•ç­–ç•¥

##### 4.1.1 æ€§èƒ½å›å½’æµ‹è¯•
```typescript
// æµ‹è¯•è®¡åˆ’ï¼šè®¤è¯æ€§èƒ½å¯¹æ¯”
describe('Authentication Performance Tests', () => {
  it('should improve response time after removing duplicate guards', async () => {
    // åŸºçº¿æµ‹è¯•ï¼šä¿®æ”¹å‰çš„å“åº”æ—¶é—´
    const baselineTime = await measureAuthenticationTime();
    
    // ä¿®æ”¹åæµ‹è¯•
    const optimizedTime = await measureAuthenticationTime();
    
    // é¢„æœŸæå‡15-20%
    expect(optimizedTime).toBeLessThan(baselineTime * 0.85);
  });
  
  it('should handle high concurrent authentication requests', async () => {
    // 1000å¹¶å‘è¯·æ±‚æµ‹è¯•
    const promises = Array(1000).fill(0).map(() => 
      request(app.getHttpServer())
        .get('/api/v1/test/auth-required')
        .set('X-App-Key', validAppKey)
        .set('X-Access-Token', validToken)
    );
    
    const results = await Promise.allSettled(promises);
    const successRate = results.filter(r => r.status === 'fulfilled').length / 1000;
    
    expect(successRate).toBeGreaterThan(0.99); // 99%æˆåŠŸç‡
  });
});
```

##### 4.1.2 å®‰å…¨éªŒè¯æµ‹è¯•
```typescript
describe('Security Tests', () => {
  it('should block API key creation when permission validation fails', async () => {
    // æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥å¤±è´¥
    jest.spyOn(userRepository, 'findById').mockRejectedValue(new Error('DB Connection Failed'));
    
    const response = await request(app.getHttpServer())
      .post('/api/v1/auth/api-keys')
      .set('Authorization', `Bearer ${validJWT}`)
      .send({
        name: 'Test Key',
        permissions: ['data:read']
      });
    
    expect(response.status).toBe(403); // åº”è¯¥è¢«é˜»æ–­
    expect(response.body.message).toContain('æƒé™èŒƒå›´éªŒè¯å¤±è´¥');
  });
  
  it('should not create API key when validation is bypassed', async () => {
    // éªŒè¯å¼‚å¸¸æƒ…å†µä¸‹ä¸ä¼šåˆ›å»ºAPI Key
    // ... æµ‹è¯•é€»è¾‘
  });
});
```

##### 4.1.3 æ•°æ®ä¸€è‡´æ€§æµ‹è¯•
```typescript
describe('Cache Compression Compatibility Tests', () => {
  it('should read legacy compressed data correctly', async () => {
    // åˆ›å»ºå†å²æ ¼å¼çš„å‹ç¼©æ•°æ®
    const legacyData = `${COMPRESSION_PREFIX}${Buffer.from(JSON.stringify(testData)).toString('base64')}`;
    await redis.set('test:legacy:key', legacyData);
    
    // ä½¿ç”¨æ–°é€»è¾‘è¯»å–
    const result = await cacheService.get('test:legacy:key');
    expect(result).toEqual(testData);
  });
  
  it('should compress new data with unified service', async () => {
    await cacheService.set('test:new:key', testData);
    
    // éªŒè¯ä½¿ç”¨äº†æ–°çš„å‹ç¼©æœåŠ¡
    expect(compressionService.compress).toHaveBeenCalled();
  });
});
```

#### 4.2 è´¨é‡é—¨æ§æ ‡å‡†

| æŒ‡æ ‡ | åŸºçº¿è¦æ±‚ | ç›®æ ‡æ”¹è¿› |
|------|----------|----------|
| ä»£ç è¦†ç›–ç‡ | â‰¥ å½“å‰æ°´å¹³ | +5% |
| APIå“åº”æ—¶é—´ | â‰¤ å½“å‰åŸºçº¿ | -15% |
| é”™è¯¯ç‡ | â‰¤ 0.1% | ä¿æŒ |
| ç¼“å­˜å‘½ä¸­ç‡ | â‰¥ å½“å‰åŸºçº¿ | ä¿æŒ |
| è®¤è¯æˆåŠŸç‡ | â‰¥ 99.9% | ä¿æŒ |

#### 4.3 ç›‘æ§ä¸å‘Šè­¦é…ç½®

```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
  - name: refactoring_alerts
    rules:
      - alert: AuthenticationPerformanceRegression
        expr: histogram_quantile(0.95, http_request_duration_seconds_bucket{handler=~".*auth.*"}) > 0.5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Authentication performance regression detected"
          
      - alert: DuplicateAuthenticationLogs
        expr: increase(auth_guard_execution_total[5m]) > increase(http_requests_total[5m]) * 1.1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Duplicate authentication execution detected"
          
      - alert: PermissionValidationBypass
        expr: increase(permission_validation_bypass_total[1m]) > 0
        for: 0m
        labels:
          severity: critical
        annotations:
          summary: "Permission validation bypass detected"
```

---

### 5. é£é™©ç®¡æ§ä¸åº”æ€¥é¢„æ¡ˆ

#### 5.1 æŠ€æœ¯é£é™©è¯„ä¼°

| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | ç­‰çº§ | ç¼“è§£æªæ–½ |
|--------|------|------|------|----------|
| è®¤è¯æµç¨‹ä¸­æ–­ | ä½ | é«˜ | ä¸­ | åŠŸèƒ½å¼€å…³æ§åˆ¶ã€å¿«é€Ÿå›æ»š |
| æƒé™éªŒè¯è¿‡ä¸¥ | ä¸­ | ä¸­ | ä¸­ | è¯¦ç»†æ—¥å¿—ã€åˆ†æ‰¹éªŒè¯ |
| ç¼“å­˜æ•°æ®ä¸å…¼å®¹ | ä½ | é«˜ | ä¸­ | å…¼å®¹æ€§æµ‹è¯•ã€æ¸è¿›è¿ç§» |
| æ€§èƒ½å›å½’ | ä½ | ä¸­ | ä¸­ | åŸºå‡†æµ‹è¯•ã€æŒç»­ç›‘æ§ |
| å¥åº·æ£€æŸ¥å¤±æ•ˆ | ä½ | ä¸­ | ä½ | é™çº§ç­–ç•¥ã€å‘Šè­¦æœºåˆ¶ |

#### 5.2 ä¸šåŠ¡é£é™©è¯„ä¼°

| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | ç­‰çº§ | ç¼“è§£æªæ–½ |
|--------|------|------|------|----------|
| æœåŠ¡ä¸å¯ç”¨ | ä½ | é«˜ | ä¸­ | æ¸è¿›éƒ¨ç½²ã€å®æ—¶ç›‘æ§ |
| æ•°æ®æ³„éœ²é£é™© | æä½ | æé«˜ | ä¸­ | ä¸¥æ ¼æƒé™æµ‹è¯•ã€å®‰å…¨å®¡æŸ¥ |
| ç”¨æˆ·ä½“éªŒä¸‹é™ | ä½ | ä¸­ | ä½ | æ€§èƒ½æµ‹è¯•ã€ç”¨æˆ·åé¦ˆ |

#### 5.3 åº”æ€¥å›æ»šé¢„æ¡ˆ

##### 5.3.1 å¿«é€Ÿå›æ»šè„šæœ¬
```bash
#!/bin/bash
# emergency-rollback.sh

echo "Starting emergency rollback..."

# Phase 0 å›æ»š
git checkout HEAD~1 -- src/auth/decorators/auth.decorator.ts
git checkout HEAD~1 -- src/auth/services/apikey.service.ts
git checkout HEAD~1 -- src/metrics/services/metrics-health.service.ts

# é‡å¯åº”ç”¨
pm2 restart newstock-api

echo "Emergency rollback completed"
```

##### 5.3.2 æ¸è¿›å¼å›æ»šç­–ç•¥
```typescript
// åŠŸèƒ½å¼€å…³æ§åˆ¶
const FEATURE_FLAGS = {
  USE_UNIFIED_GUARDS: process.env.USE_UNIFIED_GUARDS !== 'false',
  STRICT_PERMISSION_VALIDATION: process.env.STRICT_PERMISSION_VALIDATION !== 'false',
  UNIFIED_HEALTH_CHECK: process.env.UNIFIED_HEALTH_CHECK !== 'false',
};

// åœ¨å…³é”®ä½ç½®ä½¿ç”¨åŠŸèƒ½å¼€å…³
if (FEATURE_FLAGS.USE_UNIFIED_GUARDS) {
  // æ–°é€»è¾‘ï¼šä½¿ç”¨å…¨å±€å®ˆå«
} else {
  // ä¸´æ—¶å›é€€ï¼šä½¿ç”¨è£…é¥°å™¨å®ˆå«
  return applyDecorators(
    UseGuards(ApiKeyAuthGuard, UnifiedPermissionsGuard),
    // ...
  );
}
```

#### 5.4 ç›‘æ§ä»ªè¡¨ç›˜é…ç½®

```json
{
  "dashboard": {
    "title": "é‡æ„è¿›åº¦ç›‘æ§",
    "panels": [
      {
        "title": "è®¤è¯æ€§èƒ½å¯¹æ¯”",
        "metrics": [
          "http_request_duration_seconds{handler=~'.*auth.*'}",
          "auth_guard_execution_count",
          "permission_validation_duration"
        ]
      },
      {
        "title": "å¥åº·æ£€æŸ¥çŠ¶æ€",
        "metrics": [
          "health_check_status",
          "component_health_status",
          "health_check_duration"
        ]
      },
      {
        "title": "ç¼“å­˜æ€§èƒ½æŒ‡æ ‡",
        "metrics": [
          "cache_compression_ratio",
          "cache_operation_duration",
          "cache_hit_rate"
        ]
      }
    ]
  }
}
```

---

### 6. è¯¦ç»†æ‰§è¡Œæ¸…å•

#### 6.1 Phase 0 æ‰§è¡Œæ¸…å•

##### 6.1.1 ç§»é™¤é‡å¤å®ˆå« (2å°æ—¶)
```typescript
// æ–‡ä»¶ï¼šsrc/auth/decorators/auth.decorator.ts
// ğŸ“ ä¿®æ”¹å‰
export function ApiKeyAuth(permissions?: Permission[]) {
  const decorators = [
    UseGuards(ApiKeyAuthGuard, UnifiedPermissionsGuard), // âŒ ç§»é™¤
    RequireApiKey(),
    ApiSecurity("ApiKey"),
    ApiSecurity("AccessToken"),
  ];

// ğŸ“ ä¿®æ”¹å
export function ApiKeyAuth(permissions?: Permission[]) {
  const decorators = [
    RequireApiKey(), // âœ… ä¿ç•™å…ƒæ•°æ®è£…é¥°å™¨
    ApiSecurity("ApiKey"),
    ApiSecurity("AccessToken"),
  ];
```

**éªŒè¯æ­¥éª¤**:
1. å¯åŠ¨åº”ç”¨ï¼Œç¡®è®¤æ— æ„å»ºé”™è¯¯
2. æµ‹è¯•API Keyè®¤è¯ç«¯ç‚¹ï¼Œç¡®è®¤åŠŸèƒ½æ­£å¸¸
3. æ£€æŸ¥æ—¥å¿—ï¼Œç¡®è®¤è®¤è¯åªæ‰§è¡Œä¸€æ¬¡
4. æ€§èƒ½æµ‹è¯•ï¼Œç¡®è®¤å“åº”æ—¶é—´æ”¹å–„

##### 6.1.2 ä¿®å¤æƒé™éªŒè¯æ¼æ´ (1å°æ—¶)
```typescript
// æ–‡ä»¶ï¼šsrc/auth/services/apikey.service.ts:237-246
// ğŸ“ ä¿®æ”¹å¼‚å¸¸å¤„ç†é€»è¾‘

private async validatePermissionScope(
  userId: string,
  requestedPermissions: Permission[],
): Promise<void> {
  const operation = APIKEY_OPERATIONS.VALIDATE_PERMISSION_SCOPE;

  try {
    const user = await this.userRepository.findById(userId);
    // ... éªŒè¯é€»è¾‘
  } catch (error) {
    if (error instanceof ForbiddenException) {
      throw error;
    }

    // âœ… æ·»åŠ è¯¦ç»†é”™è¯¯æ—¥å¿—
    this.logger.error("æƒé™èŒƒå›´éªŒè¯å¤±è´¥", {
      operation,
      userId,
      requestedPermissions,
      errorType: error.constructor.name,
      errorMessage: error.message,
      error: error.stack,
    });

    // âœ… ç»Ÿä¸€æŠ›å‡ºå¼‚å¸¸ï¼Œé˜²æ­¢æƒé™ç»•è¿‡
    throw new ForbiddenException("æƒé™èŒƒå›´éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
  }
}
```

**éªŒè¯æ­¥éª¤**:
1. å•å…ƒæµ‹è¯•ï¼šæ¨¡æ‹Ÿæ•°æ®åº“å¼‚å¸¸ï¼Œç¡®è®¤æŠ›å‡º403
2. é›†æˆæµ‹è¯•ï¼šæ–­å¼€æ•°æ®åº“è¿æ¥ï¼Œæµ‹è¯•API Keyåˆ›å»ºè¢«é˜»æ–­
3. å®‰å…¨æµ‹è¯•ï¼šå°è¯•å„ç§å¼‚å¸¸åœºæ™¯ï¼Œç¡®è®¤æ— æƒé™ç»•è¿‡
4. æ—¥å¿—æµ‹è¯•ï¼šç¡®è®¤é”™è¯¯ä¿¡æ¯å®Œæ•´è®°å½•

##### 6.1.3 ä¿®å¤è¯­æ³•é”™è¯¯ (0.5å°æ—¶)
```typescript
// æ–‡ä»¶ï¼šsrc/metrics/services/metrics-health.service.ts
// ğŸ“ ä¿®å¤æ„é€ å‡½æ•°å’Œgetterè¯­æ³•

@Injectable()
export class MetricsHealthService {
  private readonly logger = createLogger(MetricsHealthService.name);

  constructor(private readonly redisService: RedisService) {} // âœ… ä¿®å¤ä½ç½®

  private get redis(): Redis {
    return this.redisService.getOrThrow();
  } // âœ… æ·»åŠ é—­åˆæ‹¬å·

  async getHealthStatus(): Promise<{
    status: 'healthy' | 'degraded' | 'unhealthy';
    timestamp: string;
    details: Record<string, any>;
  }> {
    try {
      await this.redis.ping();
      return {
        status: 'healthy',
        timestamp: new Date().toISOString(),
        details: { redis: 'connected' }
      };
    } catch (error) {
      this.logger.warn('Redisè¿æ¥æ£€æŸ¥å¤±è´¥', error);
      return {
        status: 'degraded',
        timestamp: new Date().toISOString(),
        details: { redis: 'disconnected', error: error.message }
      };
    }
  } // âœ… ç¡®ä¿è¿”å›å€¼å®Œæ•´
}
```

#### 6.2 Phase 1 æ‰§è¡Œæ¸…å•

##### 6.2.1 å¥åº·æ£€æŸ¥èšåˆå™¨å®ç° (2å¤©)

**Day 1: è®¾è®¡å’ŒåŸºç¡€å®ç°**
```typescript
// æ–°å»ºæ–‡ä»¶ï¼šsrc/monitoring/services/health-aggregator.service.ts
@Injectable()
export class HealthAggregatorService {
  private readonly logger = createLogger(HealthAggregatorService.name);

  constructor(
    private readonly metricsRegistry: MetricsRegistryService,
    private readonly streamRecovery: StreamRecoveryWorkerService,
    private readonly metricsHealth: MetricsHealthService,
  ) {}

  async getAggregatedHealth(): Promise<{
    status: 'healthy' | 'degraded' | 'unhealthy';
    timestamp: string;
    components: ComponentHealth[];
    summary: HealthSummary;
  }> {
    const startTime = Date.now();
    
    try {
      // å¹¶å‘æ£€æŸ¥æ‰€æœ‰ç»„ä»¶
      const healthChecks = await Promise.allSettled([
        this.checkMetricsRegistry(),
        this.checkStreamRecovery(),
        this.checkRedisHealth(),
      ]);

      const components = this.processHealthResults(healthChecks);
      const overallStatus = this.calculateOverallStatus(components);
      const summary = this.generateSummary(components);

      const result = {
        status: overallStatus,
        timestamp: new Date().toISOString(),
        components,
        summary,
        checkDuration: Date.now() - startTime
      };

      // è®°å½•èšåˆç»“æœæŒ‡æ ‡
      this.recordAggregationMetrics(result);
      return result;
      
    } catch (error) {
      this.logger.error('å¥åº·æ£€æŸ¥èšåˆå¤±è´¥', error);
      throw new ServiceUnavailableException('å¥åº·æ£€æŸ¥æœåŠ¡ä¸å¯ç”¨');
    }
  }

  private calculateOverallStatus(components: ComponentHealth[]): 'healthy' | 'degraded' | 'unhealthy' {
    const unhealthyCount = components.filter(c => c.status === 'unhealthy').length;
    const degradedCount = components.filter(c => c.status === 'degraded').length;

    if (unhealthyCount > 0) {
      return 'unhealthy';
    } else if (degradedCount > 0) {
      return 'degraded';
    } else {
      return 'healthy';
    }
  }
}
```

**Day 2: é›†æˆå’Œæµ‹è¯•**
```typescript
// ä¿®æ”¹ï¼šsrc/monitoring/controller/monitoring.controller.ts
@Controller('api/v1/monitoring')
export class MonitoringController {
  constructor(
    private readonly healthAggregator: HealthAggregatorService, // æ–°æ³¨å…¥
  ) {}

  @Get('health')
  @Public()
  async getHealth(): Promise<any> {
    // âœ… ä½¿ç”¨èšåˆå™¨ï¼Œä¿æŒæ¥å£ä¸å˜
    return await this.healthAggregator.getAggregatedHealth();
  }
}
```

##### 6.2.2 ç¼“å­˜å‹ç¼©ç»Ÿä¸€å®ç° (2å¤©)

**Day 3-4: å§”æ‰˜å®ç°å’Œå…¼å®¹æ€§**
```typescript
// ä¿®æ”¹ï¼šsrc/cache/services/cache.service.ts
export class CacheService {
  constructor(
    @Inject('REDIS') private readonly redis: Redis,
    private readonly compressionService: CacheCompressionService, // æ–°æ³¨å…¥
    private readonly metricsRegistry: MetricsRegistryService,
  ) {}

  async set<T>(key: string, value: T, ttl?: number): Promise<void> {
    try {
      const serialized = JSON.stringify(value);
      const shouldCompress = serialized.length > 1024; // 1KBé˜ˆå€¼
      
      let finalValue: string;
      if (shouldCompress) {
        // âœ… ä½¿ç”¨ç»Ÿä¸€å‹ç¼©æœåŠ¡
        const compressed = await this.compressionService.compress(value);
        finalValue = compressed.compressedData;
        
        // è®°å½•å‹ç¼©æŒ‡æ ‡
        this.metricsRegistry.recordCompressionRatio(
          key, compressed.compressionRatio
        );
      } else {
        finalValue = serialized;
      }

      await this.redis.set(this.buildKey(key), finalValue, ttl ? 'EX' : undefined, ttl);
      
    } catch (error) {
      this.logger.error(`ç¼“å­˜è®¾ç½®å¤±è´¥: ${key}`, error);
      throw new ServiceUnavailableException(`ç¼“å­˜æœåŠ¡ä¸å¯ç”¨: ${error.message}`);
    }
  }

  async get<T>(key: string): Promise<T | null> {
    try {
      const value = await this.redis.get(this.buildKey(key));
      if (!value) return null;

      // âœ… å…¼å®¹å†å²æ ¼å¼ + ä½¿ç”¨æ–°è§£å‹æœåŠ¡
      if (value.startsWith(COMPRESSION_PREFIX)) {
        // å†å²GZIPæ ¼å¼
        return this.legacyDecompress<T>(value);
      } else {
        // æ–°æ ¼å¼æˆ–æœªå‹ç¼©æ•°æ®
        return this.compressionService.isCompressed(value) 
          ? await this.compressionService.decompress<T>(value)
          : JSON.parse(value);
      }
      
    } catch (error) {
      this.logger.error(`ç¼“å­˜è·å–å¤±è´¥: ${key}`, error);
      return null; // ç¼“å­˜å¤±è´¥ä¸å½±å“ä¸šåŠ¡
    }
  }

  private async legacyDecompress<T>(value: string): Promise<T> {
    // å…¼å®¹æ—§çš„GZIPå‹ç¼©æ ¼å¼
    const compressedData = value.substring(COMPRESSION_PREFIX.length);
    const buffer = Buffer.from(compressedData, "base64");
    const decompressedBuffer = await gunzip(buffer);
    return JSON.parse(decompressedBuffer.toString("utf8"));
  }
}
```

#### 6.3 éªŒè¯å’Œæµ‹è¯•æ¸…å•

##### 6.3.1 åŠŸèƒ½éªŒè¯æ¸…å•
- [ ] **è®¤è¯æµç¨‹éªŒè¯**
  - [ ] JWTç«¯ç‚¹è®¤è¯æ­£å¸¸
  - [ ] API Keyç«¯ç‚¹è®¤è¯æ­£å¸¸
  - [ ] æ··åˆè®¤è¯ç«¯ç‚¹æ­£å¸¸
  - [ ] æƒé™ä¸è¶³è¿”å›403
  - [ ] æ— æƒé™è®¿é—®è¢«é˜»æ–­

- [ ] **æ€§èƒ½éªŒè¯æ¸…å•**
  - [ ] å•è¯·æ±‚å“åº”æ—¶é—´æ”¹å–„15-20%
  - [ ] å¹¶å‘1000è¯·æ±‚æˆåŠŸç‡>99%
  - [ ] CPUä½¿ç”¨ç‡é™ä½
  - [ ] å†…å­˜ä½¿ç”¨å¹³ç¨³

- [ ] **å®‰å…¨éªŒè¯æ¸…å•**
  - [ ] æ•°æ®åº“å¼‚å¸¸æ—¶æƒé™éªŒè¯å¤±è´¥
  - [ ] æœåŠ¡ä¸å¯ç”¨æ—¶API Keyåˆ›å»ºè¢«é˜»æ–­
  - [ ] è¶Šæƒæ“ä½œè¢«æ­£ç¡®æ‹¦æˆª
  - [ ] é”™è¯¯æ—¥å¿—å®Œæ•´è®°å½•

- [ ] **æ•°æ®å…¼å®¹æ€§éªŒè¯**
  - [ ] å†å²å‹ç¼©æ•°æ®å¯æ­£å¸¸è¯»å–
  - [ ] æ–°æ•°æ®æŒ‰é…ç½®æ­£ç¡®å‹ç¼©
  - [ ] å‹ç¼©æ¯”ç‡ç¬¦åˆé¢„æœŸ
  - [ ] æ— æ•°æ®ä¸¢å¤±æˆ–æŸå

##### 6.3.2 å›å½’æµ‹è¯•æ¸…å•
- [ ] **APIæ¥å£å›å½’**
  - [ ] æ‰€æœ‰REST APIå“åº”æ ¼å¼ä¸å˜
  - [ ] è®¤è¯æµç¨‹å“åº”çŠ¶æ€ç æ­£ç¡®
  - [ ] é”™è¯¯ä¿¡æ¯æ ¼å¼è§„èŒƒ
  - [ ] Swaggeræ–‡æ¡£æ›´æ–°æ­£ç¡®

- [ ] **ç›‘æ§æŒ‡æ ‡å›å½’**
  - [ ] PrometheusæŒ‡æ ‡æ­£å¸¸é‡‡é›†
  - [ ] Grafanaé¢æ¿æ•°æ®æ­£ç¡®
  - [ ] å‘Šè­¦è§„åˆ™è§¦å‘æ­£å¸¸
  - [ ] æ—¥å¿—æ ¼å¼å’Œå†…å®¹å®Œæ•´

---

### 7. é¡¹ç›®ç®¡ç†ä¸åè°ƒ

#### 7.1 é‡Œç¨‹ç¢‘æ—¶é—´è¡¨

| é‡Œç¨‹ç¢‘ | å®Œæˆæ—¶é—´ | ä¸»è¦å†…å®¹ | éªŒæ”¶æ ‡å‡† |
|--------|----------|----------|----------|
| **M0: å‡†å¤‡é˜¶æ®µ** | Day -1 | ç¯å¢ƒå‡†å¤‡ã€åŸºçº¿æµ‹é‡ | æµ‹è¯•ç¯å¢ƒå°±ç»ªã€æ€§èƒ½åŸºçº¿ç¡®ç«‹ |
| **M1: ç´§æ€¥ä¿®å¤** | Day 1 | P0é—®é¢˜ä¿®å¤ | å®‰å…¨æ¼æ´å…³é—­ã€æ€§èƒ½æ”¹å–„æ˜æ˜¾ |
| **M2: æ¶æ„ä¼˜åŒ–** | Week 1 | å¥åº·æ£€æŸ¥èšåˆã€ç¼“å­˜ç»Ÿä¸€ | ç›‘æ§èšåˆæ­£å¸¸ã€æ•°æ®å…¼å®¹æ€§éªŒè¯ |
| **M3: æŠ€æœ¯å€ºåŠ¡æ¸…ç†** | Week 2-3 | Legacyä»£ç æ¸…ç† | ä»£ç ç®€åŒ–ã€æ–‡æ¡£æ›´æ–°å®Œæˆ |
| **M4: æœ€ç»ˆéªŒæ”¶** | Week 3 | å…¨é¢æµ‹è¯•éªŒæ”¶ | æ‰€æœ‰æŒ‡æ ‡è¾¾æ ‡ã€æ–‡æ¡£å®Œæ•´ |

#### 7.2 èµ„æºé…ç½®

| è§’è‰² | äººå‘˜ | ä¸»è¦èŒè´£ |
|------|------|----------|
| **æŠ€æœ¯è´Ÿè´£äºº** | 1äºº | æ–¹æ¡ˆè®¾è®¡ã€é£é™©æ§åˆ¶ã€æŠ€æœ¯å†³ç­– |
| **é«˜çº§å¼€å‘** | 1äºº | P0/P1æ ¸å¿ƒä»£ç ä¿®æ”¹ã€å®‰å…¨ç›¸å…³ä¿®å¤ |
| **å¼€å‘å·¥ç¨‹å¸ˆ** | 1äºº | P2æŠ€æœ¯å€ºåŠ¡æ¸…ç†ã€æ–‡æ¡£æ›´æ–° |
| **æµ‹è¯•å·¥ç¨‹å¸ˆ** | 1äºº | å›å½’æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å®‰å…¨æµ‹è¯• |
| **è¿ç»´å·¥ç¨‹å¸ˆ** | 1äºº | ç›‘æ§é…ç½®ã€éƒ¨ç½²åè°ƒã€åº”æ€¥å“åº” |

#### 7.3 æ²Ÿé€šæœºåˆ¶

##### 7.3.1 æ—¥å¸¸æ²Ÿé€š
- **æ¯æ—¥ç«™ä¼š**: 10åˆ†é’Ÿè¿›åº¦åŒæ­¥ï¼Œé£é™©è¯†åˆ«
- **æŠ€æœ¯è¯„å®¡**: å…³é”®å˜æ›´å‰çš„ä»£ç å®¡æŸ¥
- **æµ‹è¯•æŠ¥å‘Š**: æ¯ä¸ªPhaseå®Œæˆåçš„æµ‹è¯•æ€»ç»“

##### 7.3.2 é£é™©å‡çº§æœºåˆ¶
```
Level 1: æŠ€æœ¯é£é™© â†’ æŠ€æœ¯è´Ÿè´£äºº (2å°æ—¶å†…)
Level 2: ä¸šåŠ¡å½±å“ â†’ é¡¹ç›®ç»ç† (1å°æ—¶å†…)  
Level 3: ç”Ÿäº§äº‹æ•… â†’ åº”æ€¥å“åº”å›¢é˜Ÿ (30åˆ†é’Ÿå†…)
```

#### 7.4 æ–‡æ¡£æ›´æ–°è®¡åˆ’

| æ–‡æ¡£ç±»å‹ | æ›´æ–°å†…å®¹ | è´Ÿè´£äºº | å®Œæˆæ—¶é—´ |
|----------|----------|--------|----------|
| **æŠ€æœ¯æ¶æ„æ–‡æ¡£** | è®¤è¯ç³»ç»Ÿæ¶æ„æ›´æ–° | æŠ€æœ¯è´Ÿè´£äºº | M2å®Œæˆå |
| **APIæ–‡æ¡£** | æ¥å£å˜æ›´è¯´æ˜ | å¼€å‘å·¥ç¨‹å¸ˆ | M1å®Œæˆå |
| **è¿ç»´æ‰‹å†Œ** | ç›‘æ§å‘Šè­¦è§„åˆ™ | è¿ç»´å·¥ç¨‹å¸ˆ | M2å®Œæˆå |
| **å®‰å…¨è§„èŒƒ** | æƒé™éªŒè¯æœ€ä½³å®è·µ | é«˜çº§å¼€å‘ | M1å®Œæˆå |

---

### 8. æˆåŠŸæ ‡å‡†ä¸éªŒæ”¶

#### 8.1 åŠŸèƒ½éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰ç°æœ‰APIåŠŸèƒ½ä¿æŒä¸å˜
- [ ] è®¤è¯å’Œæƒé™éªŒè¯é€»è¾‘æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µè¦†ç›–å®Œæ•´
- [ ] ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿæ­£å¸¸å·¥ä½œ

#### 8.2 æ€§èƒ½éªŒæ”¶æ ‡å‡†
- [ ] APIå“åº”æ—¶é—´æå‡15-20%
- [ ] ç³»ç»Ÿèµ„æºä½¿ç”¨ä¼˜åŒ–
- [ ] æ— å†…å­˜æ³„éœ²æˆ–æ€§èƒ½å›å½’
- [ ] é«˜å¹¶å‘åœºæ™¯ç¨³å®šæ€§éªŒè¯

#### 8.3 å®‰å…¨éªŒæ”¶æ ‡å‡†
- [ ] æƒé™éªŒè¯æ¼æ´å®Œå…¨ä¿®å¤
- [ ] å¼‚å¸¸åœºæ™¯å®‰å…¨æ€§éªŒè¯
- [ ] å®‰å…¨æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- [ ] å®‰å…¨å®¡è®¡æŠ¥å‘Šæ¸…æ´

#### 8.4 ä»£ç è´¨é‡éªŒæ”¶æ ‡å‡†
- [ ] ä»£ç è¦†ç›–ç‡ä¿æŒæˆ–æå‡
- [ ] é™æ€ä»£ç åˆ†ææ— ä¸¥é‡é—®é¢˜
- [ ] ä»£ç å¤æ‚åº¦é™ä½
- [ ] æŠ€æœ¯å€ºåŠ¡æ˜¾è‘—å‡å°‘

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0  
**æ›´æ–°æ—¥æœŸ**: 2025-01-19  
**å®¡æ ¸çŠ¶æ€**: âœ… å·²é€šè¿‡æŠ€æœ¯å®¡æ ¸å’Œå…¨é¢ä¼˜åŒ–  
**é¡¹ç›®è´Ÿè´£äºº**: æ¶æ„é‡æ„å›¢é˜Ÿ  
**é¢„è®¡å·¥æœŸ**: 3å‘¨  
**é£é™©ç­‰çº§**: ä¸­ç­‰ï¼ˆå·²åˆ¶å®šå®Œå–„ç¼“è§£æªæ–½ï¼‰