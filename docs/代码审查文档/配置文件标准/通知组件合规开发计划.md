# é€šçŸ¥ç»„ä»¶å››å±‚é…ç½®ä½“ç³»åˆè§„å¼€å‘è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ğŸ¯ æ€»ä½“ç›®æ ‡
å°† notification æ¨¡å—ä»å½“å‰ä¸åˆè§„çŠ¶æ€ä¼˜åŒ–ä¸ºå®Œå…¨ç¬¦åˆå››å±‚é…ç½®ä½“ç³»æ ‡å‡†çš„è§„èŒƒæ¨¡å—ï¼Œå®ç°ï¼š
- **é…ç½®éªŒè¯è¦†ç›–ç‡**: 0% â†’ 100%
- **ç¯å¢ƒå˜é‡ç²¾ç®€**: 25ä¸ª â†’ 6ä¸ª (-76%)
- **å¸¸é‡èŒè´£æ˜ç¡®**: 50%è¿ç§»åˆ°æ­£ç¡®å±‚çº§
- **ç±»å‹å®‰å…¨æå‡**: è¿è¡Œæ—¶é”™è¯¯é˜²æŠ¤

### ğŸ“… å®æ–½æ—¶é—´çº¿
**æ€»ä½“å‘¨æœŸ**: 2-3å‘¨
- **é˜¶æ®µä¸€**: 3-4å¤© (é…ç½®æ¶æ„é‡å»º)
- **é˜¶æ®µäºŒ**: 4-5å¤© (å¸¸é‡é‡æ„åˆ†ç¦»)  
- **é˜¶æ®µä¸‰**: 3-4å¤© (æœåŠ¡å±‚é€‚é…)
- **é˜¶æ®µå››**: 2-3å¤© (æµ‹è¯•éªŒè¯å®Œå–„)

## ğŸ” ç°çŠ¶åˆ†æ

### ğŸš¨ ä¸»è¦ä¸åˆè§„é—®é¢˜

#### 1. é…ç½®éªŒè¯ç¼ºå¤± (ä¸¥é‡)
**å½“å‰çŠ¶æ€**: `notification-enhanced.config.ts` ç¼ºä¹å®Œæ•´çš„ç±»å‹éªŒè¯
- âŒ æ—  class-validator è£…é¥°å™¨éªŒè¯
- âŒ åŸºç¡€éªŒè¯è¿‡äºç®€å• (ä»…æ£€æŸ¥éé›¶å€¼)
- âŒ æ— ç±»å‹è½¬æ¢éªŒè¯

#### 2. ç¯å¢ƒå˜é‡è¿‡å¤š (ä¸¥é‡)
**æ£€æµ‹åˆ° 25+ ç¯å¢ƒå˜é‡**:
```typescript
NOTIFICATION_DEFAULT_BATCH_SIZE, NOTIFICATION_MAX_BATCH_SIZE, 
NOTIFICATION_MAX_CONCURRENCY, NOTIFICATION_BATCH_TIMEOUT,
NOTIFICATION_EMAIL_TIMEOUT, NOTIFICATION_SMS_TIMEOUT,
NOTIFICATION_WEBHOOK_TIMEOUT, NOTIFICATION_SLACK_TIMEOUT,
NOTIFICATION_DINGTALK_TIMEOUT, NOTIFICATION_DEFAULT_TIMEOUT,
// ... ç­‰ 15+ ä¸ªå˜é‡
```

#### 3. å¸¸é‡vsé…ç½®è¾¹ç•Œæ¨¡ç³Š (ä¸­ç­‰)
**æ··åˆå­˜å‚¨é—®é¢˜**:
- âœ… æ­£ç¡®ä¿ç•™: åè®®å¸¸é‡ (EMAIL_PATTERN, URL_PATTERN)
- âŒ é”™è¯¯è¿ç§»: æ•°å€¼é™åˆ¶ä»åœ¨å¸¸é‡ä¸­æ³¨é‡Šä½†åº”åœ¨é…ç½®ä¸­
- âŒ æ¨¡æ¿å¸¸é‡: åº”è¯¥è¿ç§»åˆ°é…ç½®å±‚

#### 4. é…ç½®ç»“æ„ä¸è§„èŒƒ (ä¸­ç­‰)
- âŒ è¾…åŠ©æ–¹æ³•åœ¨é…ç½®å¯¹è±¡å†… (getChannelTimeout, getPriorityWeight)
- âŒ ç¼ºä¹ç±»å‹å®šä¹‰å¯¼å‡º
- âŒ ç¼ºä¹é…ç½®åˆ†ç»„ (è¶…æ—¶ã€é‡è¯•ã€æ‰¹å¤„ç†æ··åˆ)

## ğŸ“ å¸¸é‡vsé…ç½®åˆ†ç±»åˆ†æ

### âœ… **ä¿ç•™ä¸ºå¸¸é‡** (ç¬¦åˆä¿ç•™æ ‡å‡†)

#### 1. `NOTIFICATION_OPERATIONS` - **å®Œå…¨ä¿ç•™**
**ç¬¦åˆæ ‡å‡†**: 
- âœ… **å›ºå®šä¸å˜æ€§**: æ“ä½œæ ‡è¯†åœ¨ä»»ä½•ç¯å¢ƒéƒ½ä¸å˜
- âœ… **è¯­ä¹‰æ˜ç¡®æ€§**: æ˜ç¡®è¡¨è¾¾ä¸šåŠ¡æ“ä½œç±»å‹
- âœ… **å•ä¸€èŒè´£æ€§**: ä»…ç”¨äºé€šçŸ¥ä¸šåŠ¡åŸŸ

#### 2. `NOTIFICATION_MESSAGES` - **å®Œå…¨ä¿ç•™**
**ç¬¦åˆæ ‡å‡†**:
- âœ… **å›ºå®šä¸å˜æ€§**: æ ‡å‡†åŒ–æ¶ˆæ¯æ–‡æœ¬ä¸åº”éšç¯å¢ƒæ”¹å˜
- âœ… **è¯­ä¹‰æ˜ç¡®æ€§**: æ¸…æ™°è¡¨è¾¾æ“ä½œç»“æœçŠ¶æ€
- âœ… **å•ä¸€èŒè´£æ€§**: ä¸“ç”¨äºé€šçŸ¥æ¶ˆæ¯

#### 3. `NOTIFICATION_CONSTANTS.VALIDATION` - **å®Œå…¨ä¿ç•™**
**ç¬¦åˆæ ‡å‡†**:
- âœ… **å›ºå®šä¸å˜æ€§**: åŸºäºå›½é™…æ ‡å‡†åè®® (RFC 5322, RFC 3986, E.164)
- âœ… **ä¸šåŠ¡æ ‡å‡†æ€§**: ä¸¥æ ¼éµå¾ªè¡Œä¸šæ ‡å‡†
- âœ… **è¯­ä¹‰æ˜ç¡®æ€§**: åè®®éªŒè¯æ¨¡å¼

#### 4. `NOTIFICATION_CONSTANTS.TEMPLATE.VARIABLES` - **å®Œå…¨ä¿ç•™**
**ç¬¦åˆæ ‡å‡†**:
- âœ… **å›ºå®šä¸å˜æ€§**: æ¨¡æ¿å˜é‡åæ˜¯ä¸šåŠ¡é¢†åŸŸå›ºå®šæ ‡è¯†
- âœ… **è¯­ä¹‰æ˜ç¡®æ€§**: æ¸…æ™°è¡¨è¾¾å‘Šè­¦ä¸šåŠ¡å­—æ®µ
- âœ… **å•ä¸€èŒè´£æ€§**: ä¸“ç”¨äºæ¨¡æ¿å˜é‡å®šä¹‰

#### 5. `NOTIFICATION_ERROR_TEMPLATES` - **å®Œå…¨ä¿ç•™**
**ç¬¦åˆæ ‡å‡†**:
- âœ… **å›ºå®šä¸å˜æ€§**: é”™è¯¯æ¶ˆæ¯æ¨¡æ¿æ ¼å¼å›ºå®š
- âœ… **è¯­ä¹‰æ˜ç¡®æ€§**: æ ‡å‡†åŒ–é”™è¯¯è¡¨è¾¾
- âœ… **å•ä¸€èŒè´£æ€§**: ä¸“ç”¨äºé”™è¯¯æ¶ˆæ¯

### âŒ **è¿ç§»åˆ°é…ç½®** (ç¬¦åˆè¿ç§»æ ‡å‡†)

#### 1. `DEFAULT_TEXT_TEMPLATE` - **è¿ç§»åˆ°é…ç½®æ–‡ä»¶**
**è¿ç§»ç†ç”±**:
- ğŸ”„ **ç¯å¢ƒå·®å¼‚æ€§**: ä¸åŒå®¢æˆ·å¯èƒ½éœ€è¦å®šåˆ¶æ¨¡æ¿æ ¼å¼
- ğŸ”„ **è¿è¡Œæ—¶å¯å˜æ€§**: ä¸šåŠ¡å‘å±•ä¸­æ¨¡æ¿å†…å®¹å¯èƒ½è°ƒæ•´
- ğŸ”„ **æ€§èƒ½è°ƒä¼˜æ€§**: æ¨¡æ¿é•¿åº¦å¯èƒ½éœ€è¦æ ¹æ®æ¸ é“é™åˆ¶è°ƒèŠ‚

#### 2. `DEFAULT_EMAIL_SUBJECT_TEMPLATE` - **è¿ç§»åˆ°é…ç½®æ–‡ä»¶**
**è¿ç§»ç†ç”±**:
- ğŸ”„ **ç¯å¢ƒå·®å¼‚æ€§**: ä¸åŒéƒ¨ç½²ç¯å¢ƒå¯èƒ½éœ€è¦ä¸åŒé‚®ä»¶ä¸»é¢˜æ ¼å¼
- ğŸ”„ **è¿è¡Œæ—¶å¯å˜æ€§**: é‚®ä»¶ä¸»é¢˜å¯èƒ½éœ€è¦æ ¹æ®å“ç‰Œè°ƒæ•´

#### 3. `DEFAULT_NOTIFICATION_TEMPLATES` - **è¿ç§»åˆ°é…ç½®æ–‡ä»¶**
**è¿ç§»ç†ç”±**:
- ğŸ”„ **ç¯å¢ƒå·®å¼‚æ€§**: æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå¯èƒ½éœ€è¦ä¸åŒæ¨¡æ¿
- ğŸ”„ **è¿è¡Œæ—¶å¯å˜æ€§**: æ¨¡æ¿å†…å®¹éšä¸šåŠ¡å‘å±•éœ€è¦è°ƒæ•´
- ğŸ”„ **æ€§èƒ½è°ƒä¼˜æ€§**: æ¨¡æ¿å¤æ‚åº¦å¯èƒ½å½±å“æ¸²æŸ“æ€§èƒ½

#### 4. `DEFAULT_CHANNEL_CONFIGS` - **è¿ç§»åˆ°é…ç½®æ–‡ä»¶**
**è¿ç§»ç†ç”±**:
- ğŸ”„ **ç¯å¢ƒå·®å¼‚æ€§**: ä¸åŒç¯å¢ƒæœ‰ä¸åŒçš„æ¸ é“é…ç½®éœ€æ±‚
- ğŸ”„ **è¿è¡Œæ—¶å¯å˜æ€§**: æ¸ é“é…ç½®å¯èƒ½éœ€è¦è¿è¡Œæ—¶è°ƒæ•´
- ğŸ”„ **æ€§èƒ½è°ƒä¼˜æ€§**: è¿æ¥å‚æ•°å¯èƒ½éœ€è¦æ ¹æ®è´Ÿè½½è°ƒä¼˜

## ğŸš€ é˜¶æ®µä¸€: é…ç½®æ¶æ„é‡å»º (3-4å¤©)

### æ­¥éª¤1.1: åˆ›å»ºç»Ÿä¸€é…ç½®éªŒè¯ä½“ç³» (1å¤©)

#### ğŸ¯ **ç›®æ ‡**: å»ºç«‹å®Œæ•´çš„ class-validator é…ç½®éªŒè¯æ¶æ„

**åˆ›å»ºæ–‡ä»¶**: `src/notification/config/notification-unified.config.ts`

```typescript
/**
 * Notificationç»Ÿä¸€é…ç½®ç®¡ç†
 * ğŸ¯ åŸºäºå››å±‚é…ç½®ä½“ç³»æ ‡å‡†çš„å®Œæ•´é…ç½®éªŒè¯ä½“ç³»
 * 
 * @description æ¶ˆé™¤25ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ç°100%ç±»å‹éªŒè¯è¦†ç›–
 * @see docs/ä»£ç å®¡æŸ¥æ–‡æ¡£/é…ç½®æ–‡ä»¶æ ‡å‡†/å››å±‚é…ç½®ä½“ç³»æ ‡å‡†è§„åˆ™ä¸å¼€å‘æŒ‡å—.md
 */

import { registerAs } from '@nestjs/config';
import { IsNumber, IsBoolean, IsString, Min, Max, MinLength, MaxLength, validateSync } from 'class-validator';
import { Type, plainToClass } from 'class-transformer';

// æ‰¹å¤„ç†é…ç½®ç»„
export class NotificationBatchConfig {
  @IsNumber() @Min(1) @Max(1000)
  defaultBatchSize: number = 10;

  @IsNumber() @Min(1) @Max(10000)
  maxBatchSize: number = 100;

  @IsNumber() @Min(1) @Max(100)
  maxConcurrency: number = 5;

  @IsNumber() @Min(1000) @Max(300000)
  batchTimeout: number = 60000;
}

// è¶…æ—¶é…ç½®ç»„ (ç²¾ç®€åŒ–ï¼Œç§»é™¤å†—ä½™çš„å„æ¸ é“è¶…æ—¶)
export class NotificationTimeoutConfig {
  @IsNumber() @Min(1000) @Max(180000)
  defaultTimeout: number = 15000;

  @IsNumber() @Min(1000) @Max(180000)
  emailTimeout: number = 30000;

  @IsNumber() @Min(1000) @Max(30000)
  smsTimeout: number = 5000;

  @IsNumber() @Min(1000) @Max(60000)
  webhookTimeout: number = 10000;
}

// é‡è¯•é…ç½®ç»„
export class NotificationRetryConfig {
  @IsNumber() @Min(1) @Max(10)
  maxRetryAttempts: number = 3;

  @IsNumber() @Min(100) @Max(10000)
  initialRetryDelay: number = 1000;

  @IsNumber() @Min(1.1) @Max(5.0)
  retryBackoffMultiplier: number = 2;

  @IsNumber() @Min(1000) @Max(300000)
  maxRetryDelay: number = 30000;

  @IsNumber() @Min(0.0) @Max(1.0)
  jitterFactor: number = 0.1;
}

// éªŒè¯é™åˆ¶é…ç½®ç»„ (ä»å¸¸é‡è¿ç§»è€Œæ¥)
export class NotificationValidationConfig {
  @IsNumber() @Min(1) @Max(100)
  variableNameMinLength: number = 1;

  @IsNumber() @Min(1) @Max(500)
  variableNameMaxLength: number = 50;

  @IsNumber() @Min(1) @Max(1000)
  minTemplateLength: number = 1;

  @IsNumber() @Min(100) @Max(50000)
  maxTemplateLength: number = 10000;

  @IsNumber() @Min(1) @Max(500)
  titleMaxLength: number = 200;

  @IsNumber() @Min(10) @Max(10000)
  contentMaxLength: number = 2000;
}

// åŠŸèƒ½å¼€å…³é…ç½®ç»„
export class NotificationFeatureConfig {
  @IsBoolean()
  enableBatchProcessing: boolean = true;

  @IsBoolean()
  enableRetryMechanism: boolean = true;

  @IsBoolean()
  enablePriorityQueue: boolean = true;

  @IsBoolean()
  enableMetricsCollection: boolean = true;
}

// æ¨¡æ¿é…ç½®ç»„ (ä»å¸¸é‡è¿ç§»è€Œæ¥)
export class NotificationTemplateConfig {
  @IsString() @MinLength(10) @MaxLength(5000)
  defaultTextTemplate: string = `å‘Šè­¦è¯¦æƒ…:
- è§„åˆ™åç§°: {{ruleName}}
- ç›‘æ§æŒ‡æ ‡: {{metric}}
- å½“å‰å€¼: {{value}}
- é˜ˆå€¼: {{threshold}}
- ä¸¥é‡çº§åˆ«: {{severity}}
- çŠ¶æ€: {{status}}
- å¼€å§‹æ—¶é—´: {{startTime}}
- æŒç»­æ—¶é—´: {{duration}}ç§’
- å‘Šè­¦æ¶ˆæ¯: {{message}}

{{#if tags}}
æ ‡ç­¾: {{{tags}}}
{{/if}}`;

  @IsString() @MinLength(5) @MaxLength(200)
  defaultEmailSubjectTemplate: string = `[{{severity}}] {{ruleName}} - {{status}}`;
}

// ä¸»é…ç½®ç±»
export class NotificationUnifiedConfigValidation {
  @Type(() => NotificationBatchConfig)
  batch: NotificationBatchConfig = new NotificationBatchConfig();

  @Type(() => NotificationTimeoutConfig)
  timeouts: NotificationTimeoutConfig = new NotificationTimeoutConfig();

  @Type(() => NotificationRetryConfig)
  retry: NotificationRetryConfig = new NotificationRetryConfig();

  @Type(() => NotificationValidationConfig)
  validation: NotificationValidationConfig = new NotificationValidationConfig();

  @Type(() => NotificationFeatureConfig)
  features: NotificationFeatureConfig = new NotificationFeatureConfig();

  @Type(() => NotificationTemplateConfig)
  templates: NotificationTemplateConfig = new NotificationTemplateConfig();
}

export default registerAs('notification', (): NotificationUnifiedConfigValidation => {
  const rawConfig = {
    batch: {
      defaultBatchSize: parseInt(process.env.NOTIFICATION_DEFAULT_BATCH_SIZE, 10) || 10,
      maxBatchSize: parseInt(process.env.NOTIFICATION_MAX_BATCH_SIZE, 10) || 100,
      maxConcurrency: parseInt(process.env.NOTIFICATION_MAX_CONCURRENCY, 10) || 5,
      batchTimeout: parseInt(process.env.NOTIFICATION_BATCH_TIMEOUT, 10) || 60000,
    },
    timeouts: {
      defaultTimeout: parseInt(process.env.NOTIFICATION_DEFAULT_TIMEOUT, 10) || 15000,
      emailTimeout: parseInt(process.env.NOTIFICATION_EMAIL_TIMEOUT, 10) || 30000,
      smsTimeout: parseInt(process.env.NOTIFICATION_SMS_TIMEOUT, 10) || 5000,
      webhookTimeout: parseInt(process.env.NOTIFICATION_WEBHOOK_TIMEOUT, 10) || 10000,
    },
    retry: {
      maxRetryAttempts: parseInt(process.env.NOTIFICATION_MAX_RETRY_ATTEMPTS, 10) || 3,
      initialRetryDelay: parseInt(process.env.NOTIFICATION_INITIAL_RETRY_DELAY, 10) || 1000,
      retryBackoffMultiplier: parseFloat(process.env.NOTIFICATION_RETRY_BACKOFF_MULTIPLIER) || 2,
      maxRetryDelay: parseInt(process.env.NOTIFICATION_MAX_RETRY_DELAY, 10) || 30000,
      jitterFactor: parseFloat(process.env.NOTIFICATION_JITTER_FACTOR) || 0.1,
    },
    validation: {
      variableNameMinLength: 1,
      variableNameMaxLength: 50,
      minTemplateLength: 1,
      maxTemplateLength: 10000,
      titleMaxLength: 200,
      contentMaxLength: 2000,
    },
    features: {
      enableBatchProcessing: process.env.NOTIFICATION_ENABLE_BATCH_PROCESSING !== 'false',
      enableRetryMechanism: process.env.NOTIFICATION_ENABLE_RETRY_MECHANISM !== 'false',
      enablePriorityQueue: process.env.NOTIFICATION_ENABLE_PRIORITY_QUEUE !== 'false',
      enableMetricsCollection: process.env.NOTIFICATION_ENABLE_METRICS_COLLECTION !== 'false',
    },
    templates: {
      defaultTextTemplate: process.env.NOTIFICATION_DEFAULT_TEXT_TEMPLATE || 
        'å‘Šè­¦è¯¦æƒ…:\\n- è§„åˆ™åç§°: {{ruleName}}\\n- ç›‘æ§æŒ‡æ ‡: {{metric}}\\n...',
      defaultEmailSubjectTemplate: process.env.NOTIFICATION_EMAIL_SUBJECT_TEMPLATE || 
        '[{{severity}}] {{ruleName}} - {{status}}',
    },
  };

  const config = plainToClass(NotificationUnifiedConfigValidation, rawConfig, {
    enableImplicitConversion: true,
  });
  
  const errors = validateSync(config, { 
    whitelist: true, 
    forbidNonWhitelisted: true,
    skipMissingProperties: false,
  });

  if (errors.length > 0) {
    const errorMessages = errors.map(error => 
      `${error.property}: ${Object.values(error.constraints || {}).join(', ')}`
    ).join('; ');
    throw new Error(`Notification configuration validation failed: ${errorMessages}`);
  }

  return config;
});

export type NotificationUnifiedConfig = NotificationUnifiedConfigValidation;
```

### æ­¥éª¤1.2: æ›´æ–°ç¯å¢ƒå˜é‡æ–‡æ¡£ (0.5å¤©)

**åˆ›å»ºæ–‡ä»¶**: `.env.notification.example`

```bash
# ================================
# Notificationæ¨¡å—ç¯å¢ƒå˜é‡é…ç½®
# ğŸ¯ åŸºäºå››å±‚é…ç½®ä½“ç³»æ ‡å‡†ç²¾ç®€ (25ä¸ªâ†’6ä¸ª)
# ================================

# æ ¸å¿ƒä¸šåŠ¡é…ç½® (3ä¸ª - ä¿ç•™)
NOTIFICATION_DEFAULT_TIMEOUT=15000          # é»˜è®¤è¶…æ—¶ (æ¯«ç§’)
NOTIFICATION_MAX_BATCH_SIZE=100             # æœ€å¤§æ‰¹å¤„ç†å¤§å°
NOTIFICATION_EMAIL_TIMEOUT=30000            # é‚®ä»¶è¶…æ—¶ (æ¯«ç§’)

# åŠŸèƒ½å¼€å…³ (3ä¸ª - ä¿ç•™)
NOTIFICATION_ENABLE_BATCH_PROCESSING=true   # å¯ç”¨æ‰¹å¤„ç†
NOTIFICATION_ENABLE_RETRY_MECHANISM=true    # å¯ç”¨é‡è¯•æœºåˆ¶
NOTIFICATION_ENABLE_METRICS_COLLECTION=true # å¯ç”¨æŒ‡æ ‡æ”¶é›†

# ================================
# ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²è¿ç§»åˆ°é…ç½®æ–‡ä»¶ï¼Œæ— éœ€è®¾ç½®
# ================================
# NOTIFICATION_DEFAULT_BATCH_SIZE=10           â†’ config.batch.defaultBatchSize
# NOTIFICATION_MAX_CONCURRENCY=5               â†’ config.batch.maxConcurrency  
# NOTIFICATION_BATCH_TIMEOUT=60000             â†’ config.batch.batchTimeout
# NOTIFICATION_SMS_TIMEOUT=5000                â†’ config.timeouts.smsTimeout
# NOTIFICATION_WEBHOOK_TIMEOUT=10000           â†’ config.timeouts.webhookTimeout
# NOTIFICATION_MAX_RETRY_ATTEMPTS=3            â†’ config.retry.maxRetryAttempts
# NOTIFICATION_INITIAL_RETRY_DELAY=1000        â†’ config.retry.initialRetryDelay
# NOTIFICATION_RETRY_BACKOFF_MULTIPLIER=2      â†’ config.retry.retryBackoffMultiplier
# NOTIFICATION_MAX_RETRY_DELAY=30000           â†’ config.retry.maxRetryDelay
# NOTIFICATION_JITTER_FACTOR=0.1               â†’ config.retry.jitterFactor
# [å…¶ä»–15ä¸ªç¯å¢ƒå˜é‡å·²ç§»é™¤]
```

### æ­¥éª¤1.3: åˆ›å»ºé…ç½®ç±»å‹å®šä¹‰å’Œè¾…åŠ©å·¥å…· (0.5å¤©)

**åˆ›å»ºæ–‡ä»¶**: `src/notification/config/index.ts`

```typescript
/**
 * Notificationé…ç½®æ¨¡å—ç»Ÿä¸€å¯¼å‡º
 * ğŸ¯ æä¾›ç±»å‹å®šä¹‰å’Œé…ç½®è®¿é—®å·¥å…·
 */

export { default as notificationUnifiedConfig } from './notification-unified.config';
export type { 
  NotificationUnifiedConfig,
  NotificationBatchConfig,
  NotificationTimeoutConfig,
  NotificationRetryConfig,
  NotificationValidationConfig,
  NotificationFeatureConfig,
  NotificationTemplateConfig,
} from './notification-unified.config';

// é…ç½®è®¿é—®è¾…åŠ©å‡½æ•°
export const getNotificationConfig = (configService: any): NotificationUnifiedConfig => {
  return configService.get<NotificationUnifiedConfig>('notification');
};
```

### æ­¥éª¤1.4: æ›´æ–°æ¨¡å—æ³¨å†Œ (1å¤©)

**ä¿®æ”¹æ–‡ä»¶**: `src/notification/notification.module.ts`

```typescript
// æ›¿æ¢é…ç½®å¯¼å…¥
- import notificationEnhancedConfig from './config/notification-enhanced.config';
+ import notificationUnifiedConfig from './config/notification-unified.config';

@Module({
  imports: [
    // å…¶ä»–å¯¼å…¥...
    // âš™ï¸ é…ç½®æ¨¡å— (ä½¿ç”¨æ–°çš„ç»Ÿä¸€é…ç½®)
-   ConfigModule.forFeature(notificationEnhancedConfig),
+   ConfigModule.forFeature(notificationUnifiedConfig),
  ],
  // ...
})
```

**éªŒè¯æ­¥éª¤**:
```bash
# å•æ–‡ä»¶ç±»å‹æ£€æŸ¥
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/notification/config/notification-unified.config.ts
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/notification/notification.module.ts

# æµ‹è¯•é…ç½®åŠ è½½
npm test -- --testPathPattern=notification/config
```

## ğŸ”§ é˜¶æ®µäºŒ: å¸¸é‡é‡æ„åˆ†ç¦» (4-5å¤©)

### æ­¥éª¤2.1: é‡æ„æ ¸å¿ƒå¸¸é‡æ–‡ä»¶ (2å¤©)

#### ğŸ¯ **ç›®æ ‡**: ä¸¥æ ¼æŒ‰ç…§å››å±‚æ ‡å‡†ä¿ç•™å›ºå®šä¸å˜çš„è¯­ä¹‰å¸¸é‡

**é‡æ„æ–‡ä»¶**: `src/notification/constants/notification-core.constants.ts`

```typescript
/**
 * Notificationæ ¸å¿ƒå¸¸é‡å®šä¹‰
 * ğŸ¯ åŸºäºå››å±‚é…ç½®ä½“ç³»æ ‡å‡†ï¼Œä¸¥æ ¼ä¿ç•™ç¬¦åˆæ ‡å‡†çš„å¸¸é‡
 * 
 * @description ä»…ä¿ç•™å›ºå®šä¸å˜ã€åŸºäºæ ‡å‡†åè®®çš„è¯­ä¹‰å¸¸é‡
 * @see docs/ä»£ç å®¡æŸ¥æ–‡æ¡£/é…ç½®æ–‡ä»¶æ ‡å‡†/å››å±‚é…ç½®ä½“ç³»æ ‡å‡†è§„åˆ™ä¸å¼€å‘æŒ‡å—.md
 */

/**
 * é€šçŸ¥æ“ä½œå¸¸é‡
 * âœ… ä¿ç•™ç†ç”±ï¼šå›ºå®šä¸å˜çš„ä¸šåŠ¡æ“ä½œæ ‡è¯†ï¼ŒåŸºäºä¸šåŠ¡æ ‡å‡†
 */
export const NOTIFICATION_OPERATIONS = Object.freeze({
  SEND_NOTIFICATION: "send_notification",
  SEND_BATCH_NOTIFICATIONS: "send_batch_notifications",
  SEND_RESOLUTION_NOTIFICATION: "send_resolution_notification",
  SEND_ACKNOWLEDGMENT_NOTIFICATION: "send_acknowledgment_notification",
  SEND_SUPPRESSION_NOTIFICATION: "send_suppression_notification",
  SEND_ESCALATION_NOTIFICATION: "send_escalation_notification",
  TEST_CHANNEL: "test_channel",
  GENERATE_TEMPLATE: "generate_template",
  INITIALIZE_SENDERS: "initialize_senders",
  RETRY_FAILED_NOTIFICATION: "retry_failed_notification",
  VALIDATE_CHANNEL_CONFIG: "validate_channel_config",
  
  // æ¨¡æ¿ç›¸å…³æ“ä½œ
  CREATE_TEMPLATE: "create_template",
  UPDATE_TEMPLATE: "update_template",
  DELETE_TEMPLATE: "delete_template",
  RENDER_TEMPLATE: "render_template",
  RENDER_TEMPLATES_BATCH: "render_templates_batch",
  QUERY_TEMPLATES: "query_templates",
  DUPLICATE_TEMPLATE: "duplicate_template",
  VALIDATE_TEMPLATE: "validate_template",
  INITIALIZE_DEFAULT_TEMPLATES: "initialize_default_templates",
} as const);

/**
 * é€šçŸ¥æ¶ˆæ¯å¸¸é‡
 * âœ… ä¿ç•™ç†ç”±ï¼šæ ‡å‡†åŒ–æ¶ˆæ¯æ–‡æœ¬ï¼Œè¯­ä¹‰æ˜ç¡®ï¼Œå›ºå®šä¸å˜
 */
export const NOTIFICATION_MESSAGES = Object.freeze({
  // Success messages
  NOTIFICATION_SENT: "é€šçŸ¥å‘é€æˆåŠŸ",
  BATCH_NOTIFICATIONS_SENT: "æ‰¹é‡é€šçŸ¥å‘é€æˆåŠŸ",
  CHANNEL_TESTED: "é€šé“æµ‹è¯•æˆåŠŸ",
  TEMPLATE_GENERATED: "æ¨¡æ¿ç”ŸæˆæˆåŠŸ",
  SENDERS_INITIALIZED: "å‘é€å™¨åˆå§‹åŒ–æˆåŠŸ",
  CHANNEL_TEST_PASSED: "é€šé“æµ‹è¯•é€šè¿‡",
  BATCH_NOTIFICATIONS_COMPLETED: "æ‰¹é‡é€šçŸ¥å®Œæˆ",
  NOTIFICATION_RETRIED: "é€šçŸ¥é‡è¯•æˆåŠŸ",
  CHANNEL_CONFIG_VALID: "é€šé“é…ç½®éªŒè¯é€šè¿‡",
  NO_CHANNELS_CONFIGURED: "æœªé…ç½®é€šçŸ¥æ¸ é“",
  
  // Error messages
  NOTIFICATION_FAILED: "é€šçŸ¥å‘é€å¤±è´¥",
  BATCH_NOTIFICATIONS_FAILED: "æ‰¹é‡é€šçŸ¥å‘é€å¤±è´¥",
  CHANNEL_TEST_FAILED: "é€šé“æµ‹è¯•å¤±è´¥",
  TEMPLATE_GENERATION_FAILED: "æ¨¡æ¿ç”Ÿæˆå¤±è´¥",
  SENDERS_INITIALIZATION_FAILED: "å‘é€å™¨åˆå§‹åŒ–å¤±è´¥",
  INVALID_CHANNEL_CONFIG: "é€šé“é…ç½®æ— æ•ˆ",
  TEMPLATE_NOT_FOUND: "æ¨¡æ¿æœªæ‰¾åˆ°",
  BATCH_NOTIFICATION_FAILED: "æ‰¹é‡é€šçŸ¥ä¸­çš„å•ä¸ªé€šçŸ¥å¤±è´¥",
  RETRY_LIMIT_EXCEEDED: "é‡è¯•æ¬¡æ•°è¶…å‡ºé™åˆ¶",
  NOTIFICATION_TIMEOUT: "é€šçŸ¥å‘é€è¶…æ—¶",
  CHANNEL_UNAVAILABLE: "é€šçŸ¥æ¸ é“ä¸å¯ç”¨",
  
  // Status messages
  SENDING: "å‘é€ä¸­...",
  TESTING: "æµ‹è¯•ä¸­...",
  GENERATING: "ç”Ÿæˆä¸­...",
  INITIALIZING: "åˆå§‹åŒ–ä¸­...",
  NOTIFICATION_PROCESSING_STARTED: "é€šçŸ¥å¤„ç†å·²å¼€å§‹",
  BATCH_PROCESSING_STARTED: "æ‰¹é‡å¤„ç†å·²å¼€å§‹",
  CHANNEL_TEST_STARTED: "é€šé“æµ‹è¯•å·²å¼€å§‹",
  TEMPLATE_GENERATION_STARTED: "æ¨¡æ¿ç”Ÿæˆå·²å¼€å§‹",
  RETRYING: "é‡è¯•ä¸­...",
  VALIDATING: "éªŒè¯ä¸­...",
} as const);

/**
 * é€šçŸ¥éªŒè¯æ¨¡å¼å¸¸é‡
 * âœ… ä¿ç•™ç†ç”±ï¼šåŸºäºå›½é™…æ ‡å‡†åè®®ï¼ˆRFC 5322, RFC 3986, E.164ï¼‰ï¼Œå›ºå®šä¸å˜
 */
export const NOTIFICATION_VALIDATION_PATTERNS = Object.freeze({
  // é‚®ç®±æ ¼å¼éªŒè¯ï¼ˆåŸºäºRFC 5322æ ‡å‡†ï¼‰
  EMAIL_PATTERN: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i,
  
  // URLæ ¼å¼éªŒè¯ï¼ˆåŸºäºRFC 3986æ ‡å‡†ï¼‰
  URL_PATTERN: /^https?:\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/i,
  
  // ç”µè¯å·ç æ ¼å¼éªŒè¯ï¼ˆåŸºäºE.164æ ‡å‡†ï¼‰
  PHONE_PATTERN: /^\+?[1-9]\d{1,14}$/,
  
  // å˜é‡åæ ¼å¼éªŒè¯ï¼ˆåŸºäºç¼–ç¨‹è¯­è¨€æ ‡å‡†ï¼‰
  VARIABLE_NAME_PATTERN: /^[a-zA-Z_][a-zA-Z0-9_]*$/i,
  
  // æ¨¡æ¿å˜é‡æ¨¡å¼ï¼ˆåŸºäºæ¨¡æ¿å¼•æ“æ ‡å‡†ï¼‰
  VARIABLE_PATTERN: /\{(\w+)\}/g,
} as const);

/**
 * é€šçŸ¥æ¨¡æ¿å˜é‡å®šä¹‰
 * âœ… ä¿ç•™ç†ç”±ï¼šå‘Šè­¦é¢†åŸŸå›ºå®šå­—æ®µï¼ŒåŸºäºä¸šåŠ¡æ ‡å‡†ï¼Œè¯­ä¹‰æ˜ç¡®
 */
export const NOTIFICATION_TEMPLATE_VARIABLES = Object.freeze({
  ALERT_ID: "alertId",
  RULE_NAME: "ruleName",
  METRIC: "metric", 
  VALUE: "value",
  THRESHOLD: "threshold",
  SEVERITY: "severity",
  STATUS: "status",
  MESSAGE: "message",
  START_TIME: "startTime",
  END_TIME: "endTime",
  DURATION: "duration",
  TAGS: "tags",
  RULE_ID: "ruleId",
  RULE_DESCRIPTION: "ruleDescription",
  RESOLVED_BY: "resolvedBy",
  ACKNOWLEDGED_BY: "acknowledgedBy",
  SUPPRESSED_BY: "suppressedBy",
  ESCALATION_REASON: "escalationReason",
} as const);

/**
 * é€šçŸ¥é”™è¯¯æ¨¡æ¿
 * âœ… ä¿ç•™ç†ç”±ï¼šæ ‡å‡†åŒ–é”™è¯¯è¡¨è¾¾ï¼Œå›ºå®šä¸å˜ï¼Œè¯­ä¹‰æ˜ç¡®
 */
export const NOTIFICATION_ERROR_TEMPLATES = Object.freeze({
  SEND_FAILED: "é€šçŸ¥å‘é€å¤±è´¥: {error}",
  CHANNEL_UNAVAILABLE: "é€šçŸ¥æ¸ é“ä¸å¯ç”¨: {channel}",
  TEMPLATE_ERROR: "æ¨¡æ¿é”™è¯¯: {details}",
  VALIDATION_ERROR: "éªŒè¯é”™è¯¯: {field} - {message}",
  TIMEOUT_ERROR: "å‘é€è¶…æ—¶: {timeout}ms",
  RETRY_EXHAUSTED: "é‡è¯•æ¬¡æ•°å·²ç”¨å°½: {attempts}æ¬¡",
  UNSUPPORTED_TYPE: "ä¸æ”¯æŒçš„é€šçŸ¥ç±»å‹: {type}",
  SEND_FAILED_WITH_REASON: "é€šçŸ¥å‘é€å¤±è´¥: {reason}",
  CONFIG_INVALID: "é…ç½®æ— æ•ˆ: {config}",
  RECIPIENT_INVALID: "æ¥æ”¶è€…æ ¼å¼æ— æ•ˆ: {recipient}",
  TEMPLATE_NOT_FOUND: "æ¨¡æ¿æœªæ‰¾åˆ°: {templateId}",
  CHANNEL_NOT_FOUND: "é€šçŸ¥æ¸ é“æœªæ‰¾åˆ°: {channelId}",
} as const);

// âŒ ä»¥ä¸‹å†…å®¹å·²è¿ç§»åˆ°é…ç½®æ–‡ä»¶
// - DEFAULT_TEXT_TEMPLATE â†’ NotificationTemplateConfig.defaultTextTemplate
// - DEFAULT_EMAIL_SUBJECT_TEMPLATE â†’ NotificationTemplateConfig.defaultEmailSubjectTemplate
// - DEFAULT_NOTIFICATION_TEMPLATES â†’ é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡æ¿é…ç½®
// - DEFAULT_CHANNEL_CONFIGS â†’ é…ç½®æ–‡ä»¶ä¸­çš„æ¸ é“é…ç½®
// - æ‰€æœ‰æ•°å€¼é™åˆ¶å¸¸é‡ â†’ NotificationValidationConfig
```

### æ­¥éª¤2.2: åˆ›å»ºæ¸ é“æ¨¡æ¿é…ç½® (1å¤©)

**åˆ›å»ºæ–‡ä»¶**: `src/notification/config/notification-channel-templates.config.ts`

```typescript
/**
 * é€šçŸ¥æ¸ é“æ¨¡æ¿é…ç½®
 * ğŸ¯ ä»å¸¸é‡è¿ç§»è€Œæ¥çš„å¯é…ç½®æ¨¡æ¿å®šä¹‰
 * 
 * @description æ”¯æŒç¯å¢ƒå·®å¼‚åŒ–å’Œè¿è¡Œæ—¶è°ƒæ•´çš„æ¨¡æ¿é…ç½®
 */

import { IsObject, ValidateNested } from 'class-validator';
import { Type } from 'class-transformer';

export class AlertTemplateConfig {
  @IsObject()
  email: {
    title: string;
    content: string;
  } = {
    title: "[{severity}] {ruleName} è­¦å‘Šè§¦å‘",
    content: `è­¦å‘Šè§„åˆ™: {ruleName}
ä¸¥é‡ç¨‹åº¦: {severity}
è§¦å‘æ—¶é—´: {startTime}
å½“å‰å€¼: {value}
é˜ˆå€¼: {threshold}
ç›‘æ§æŒ‡æ ‡: {metric}
æè¿°: {message}

è¯·åŠæ—¶å¤„ç†æ­¤è­¦å‘Šã€‚`,
  };

  @IsObject()
  sms: {
    content: string;
  } = {
    content: "{ruleName} è­¦å‘Šè§¦å‘ï¼Œå½“å‰å€¼: {value}ï¼Œé˜ˆå€¼: {threshold}",
  };

  @IsObject()
  webhook: {
    payload: Record<string, any>;
  } = {
    payload: {
      alert: {
        id: "{alertId}",
        ruleName: "{ruleName}", 
        severity: "{severity}",
        status: "{status}",
        value: "{value}",
        threshold: "{threshold}",
        metric: "{metric}",
        startTime: "{startTime}",
        message: "{message}",
      },
    },
  };
}

export class NotificationChannelTemplatesConfig {
  @ValidateNested()
  @Type(() => AlertTemplateConfig)
  alertFired: AlertTemplateConfig = new AlertTemplateConfig();

  @ValidateNested() 
  @Type(() => AlertTemplateConfig)
  alertResolved: AlertTemplateConfig = new AlertTemplateConfig();

  @ValidateNested()
  @Type(() => AlertTemplateConfig)
  alertAcknowledged: AlertTemplateConfig = new AlertTemplateConfig();
}
```

### æ­¥éª¤2.3: åˆ›å»ºæ¸ é“é»˜è®¤é…ç½® (1å¤©)

**åˆ›å»ºæ–‡ä»¶**: `src/notification/config/notification-channel-defaults.config.ts`

```typescript
/**
 * é€šçŸ¥æ¸ é“é»˜è®¤é…ç½®
 * ğŸ¯ ä»å¸¸é‡è¿ç§»è€Œæ¥çš„å¯é…ç½®æ¸ é“è®¾ç½®
 */

import { IsString, IsNumber, IsBoolean, IsObject, Min, Max } from 'class-validator';
import { Type } from 'class-transformer';

export class EmailChannelDefaultConfig {
  @IsString()
  defaultHost: string = "";

  @IsNumber() @Min(1) @Max(65535)
  defaultPort: number = 587;

  @IsBoolean()
  defaultSecure: boolean = false;

  @IsString()
  defaultFrom: string = "";
}

export class SmsChannelDefaultConfig {
  @IsString()
  defaultProvider: string = "aliyun";

  @IsString()
  defaultSignName: string = "";

  @IsString()
  defaultTemplateCode: string = "";
}

export class WebhookChannelDefaultConfig {
  @IsString()
  defaultMethod: string = "POST";

  @IsObject()
  defaultHeaders: Record<string, string> = {};

  @IsBoolean()
  defaultVerifySSL: boolean = true;
}

export class SlackChannelDefaultConfig {
  @IsString()
  defaultUsername: string = "AlertBot";

  @IsString()
  defaultIconEmoji: string = ":warning:";
}

export class NotificationChannelDefaultsConfig {
  @Type(() => EmailChannelDefaultConfig)
  email: EmailChannelDefaultConfig = new EmailChannelDefaultConfig();

  @Type(() => SmsChannelDefaultConfig)
  sms: SmsChannelDefaultConfig = new SmsChannelDefaultConfig();

  @Type(() => WebhookChannelDefaultConfig)
  webhook: WebhookChannelDefaultConfig = new WebhookChannelDefaultConfig();

  @Type(() => SlackChannelDefaultConfig)
  slack: SlackChannelDefaultConfig = new SlackChannelDefaultConfig();
}
```

### æ­¥éª¤2.4: æ•´åˆé…ç½®åˆ°ä¸»é…ç½®æ–‡ä»¶ (0.5å¤©)

**ä¿®æ”¹æ–‡ä»¶**: `src/notification/config/notification-unified.config.ts`

```typescript
// æ·»åŠ å¯¼å…¥
import { NotificationChannelTemplatesConfig } from './notification-channel-templates.config';
import { NotificationChannelDefaultsConfig } from './notification-channel-defaults.config';

// åœ¨ä¸»é…ç½®ç±»ä¸­æ·»åŠ 
export class NotificationUnifiedConfigValidation {
  // ç°æœ‰é…ç½®...

  @Type(() => NotificationChannelTemplatesConfig)
  channelTemplates: NotificationChannelTemplatesConfig = new NotificationChannelTemplatesConfig();

  @Type(() => NotificationChannelDefaultsConfig)
  channelDefaults: NotificationChannelDefaultsConfig = new NotificationChannelDefaultsConfig();
}
```

## ğŸ”— é˜¶æ®µä¸‰: æœåŠ¡å±‚é€‚é… (3-4å¤©)

### æ­¥éª¤3.1: åˆ›å»ºé…ç½®è®¿é—®æœåŠ¡ (1.5å¤©)

#### ğŸ¯ **ç›®æ ‡**: åˆ†ç¦»ä¸šåŠ¡é€»è¾‘ï¼Œæä¾›ç±»å‹å®‰å…¨çš„é…ç½®è®¿é—®

**åˆ›å»ºæ–‡ä»¶**: `src/notification/services/notification-config.service.ts`

```typescript
/**
 * Notificationé…ç½®è®¿é—®æœåŠ¡
 * ğŸ¯ æä¾›ç±»å‹å®‰å…¨çš„é…ç½®è®¿é—®å’Œä¸šåŠ¡é€»è¾‘è¾…åŠ©æ–¹æ³•
 * 
 * @description å°†åŸconfigå¯¹è±¡ä¸­çš„ä¸šåŠ¡é€»è¾‘è¿ç§»åˆ°ä¸“é—¨æœåŠ¡
 */

import { Injectable, Inject } from '@nestjs/common';
import { NotificationUnifiedConfig } from '../config';

@Injectable()
export class NotificationConfigService {
  constructor(
    @Inject('notification') private readonly config: NotificationUnifiedConfig,
  ) {}

  // ============ æ‰¹å¤„ç†é…ç½®è®¿é—® ============
  getBatchConfig() {
    return this.config.batch;
  }

  getDefaultBatchSize(): number {
    return this.config.batch.defaultBatchSize;
  }

  getMaxBatchSize(): number {
    return this.config.batch.maxBatchSize;
  }

  getMaxConcurrency(): number {
    return this.config.batch.maxConcurrency;
  }

  getBatchTimeout(): number {
    return this.config.batch.batchTimeout;
  }

  // ============ è¶…æ—¶é…ç½®è®¿é—® ============
  getTimeoutConfig() {
    return this.config.timeouts;
  }

  /**
   * è·å–æ¸ é“ç‰¹å®šè¶…æ—¶æ—¶é—´
   * @param channelType æ¸ é“ç±»å‹
   * @returns è¶…æ—¶æ—¶é—´(æ¯«ç§’)
   */
  getChannelTimeout(channelType: string): number {
    const channelTimeouts: Record<string, number> = {
      'email': this.config.timeouts.emailTimeout,
      'sms': this.config.timeouts.smsTimeout,
      'webhook': this.config.timeouts.webhookTimeout,
      'slack': this.config.timeouts.webhookTimeout, // ä½¿ç”¨webhookè¶…æ—¶
      'dingtalk': this.config.timeouts.webhookTimeout, // ä½¿ç”¨webhookè¶…æ—¶
    };
    return channelTimeouts[channelType.toLowerCase()] || this.config.timeouts.defaultTimeout;
  }

  // ============ é‡è¯•é…ç½®è®¿é—® ============
  getRetryConfig() {
    return this.config.retry;
  }

  getMaxRetryAttempts(): number {
    return this.config.retry.maxRetryAttempts;
  }

  getInitialRetryDelay(): number {
    return this.config.retry.initialRetryDelay;
  }

  /**
   * è®¡ç®—é‡è¯•å»¶è¿Ÿæ—¶é—´
   * @param attempt é‡è¯•æ¬¡æ•°
   * @returns å»¶è¿Ÿæ—¶é—´(æ¯«ç§’)
   */
  calculateRetryDelay(attempt: number): number {
    const baseDelay = this.config.retry.initialRetryDelay;
    const multiplier = this.config.retry.retryBackoffMultiplier;
    const jitter = this.config.retry.jitterFactor;
    const maxDelay = this.config.retry.maxRetryDelay;

    let delay = baseDelay * Math.pow(multiplier, attempt - 1);
    
    // æ·»åŠ æŠ–åŠ¨
    const jitterRange = delay * jitter;
    delay += (Math.random() - 0.5) * 2 * jitterRange;
    
    return Math.min(delay, maxDelay);
  }

  // ============ éªŒè¯é…ç½®è®¿é—® ============
  getValidationConfig() {
    return this.config.validation;
  }

  // ============ åŠŸèƒ½å¼€å…³è®¿é—® ============
  getFeaturesConfig() {
    return this.config.features;
  }

  isBatchProcessingEnabled(): boolean {
    return this.config.features.enableBatchProcessing;
  }

  isRetryMechanismEnabled(): boolean {
    return this.config.features.enableRetryMechanism;
  }

  isPriorityQueueEnabled(): boolean {
    return this.config.features.enablePriorityQueue;
  }

  isMetricsCollectionEnabled(): boolean {
    return this.config.features.enableMetricsCollection;
  }

  // ============ æ¨¡æ¿é…ç½®è®¿é—® ============
  getTemplateConfig() {
    return this.config.templates;
  }

  getDefaultTextTemplate(): string {
    return this.config.templates.defaultTextTemplate;
  }

  getDefaultEmailSubjectTemplate(): string {
    return this.config.templates.defaultEmailSubjectTemplate;
  }

  // ============ æ¸ é“æ¨¡æ¿è®¿é—® ============
  getChannelTemplate(alertType: 'alertFired' | 'alertResolved' | 'alertAcknowledged', channelType: string) {
    return this.config.channelTemplates[alertType]?.[channelType];
  }

  // ============ æ¸ é“é»˜è®¤é…ç½®è®¿é—® ============
  getChannelDefaults(channelType: string) {
    return this.config.channelDefaults[channelType];
  }

  // ============ ä¸šåŠ¡é€»è¾‘è¾…åŠ©æ–¹æ³• ============
  
  /**
   * éªŒè¯æ‰¹å¤„ç†å¤§å°æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
   * @param size æ‰¹å¤„ç†å¤§å°
   * @returns æ˜¯å¦æœ‰æ•ˆ
   */
  isValidBatchSize(size: number): boolean {
    return size >= 1 && size <= this.getMaxBatchSize();
  }

  /**
   * éªŒè¯æ¨¡æ¿å˜é‡åæ˜¯å¦ç¬¦åˆè§„èŒƒ
   * @param variableName å˜é‡å
   * @returns æ˜¯å¦æœ‰æ•ˆ
   */
  isValidVariableName(variableName: string): boolean {
    const minLength = this.config.validation.variableNameMinLength;
    const maxLength = this.config.validation.variableNameMaxLength;
    return variableName.length >= minLength && variableName.length <= maxLength;
  }

  /**
   * éªŒè¯æ¨¡æ¿é•¿åº¦æ˜¯å¦ç¬¦åˆè§„èŒƒ
   * @param template æ¨¡æ¿å†…å®¹
   * @returns æ˜¯å¦æœ‰æ•ˆ
   */
  isValidTemplateLength(template: string): boolean {
    const minLength = this.config.validation.minTemplateLength;
    const maxLength = this.config.validation.maxTemplateLength;
    return template.length >= minLength && template.length <= maxLength;
  }
}
```

### æ­¥éª¤3.2: æ›´æ–°ä¸»è¦æœåŠ¡ (1.5å¤©)

**ä¿®æ”¹æ–‡ä»¶**: `src/notification/services/notification.service.ts`

```typescript
// æ·»åŠ å¯¼å…¥
import { NotificationConfigService } from './notification-config.service';
- import { NOTIFICATION_CONSTANTS, DEFAULT_TEXT_TEMPLATE } from '../constants/notification.constants';
+ import { 
+   NOTIFICATION_OPERATIONS, 
+   NOTIFICATION_MESSAGES, 
+   NOTIFICATION_VALIDATION_PATTERNS,
+   NOTIFICATION_TEMPLATE_VARIABLES,
+   NOTIFICATION_ERROR_TEMPLATES,
+ } from '../constants/notification-core.constants';

@Injectable()
export class NotificationService {
  constructor(
    // ç°æœ‰ä¾èµ–...
+   private readonly notificationConfig: NotificationConfigService,
  ) {}

  // æ›´æ–°é…ç½®è®¿é—®æ–¹æ³•
  private get notificationConfig() {
-   return this.configService.get<NotificationConfig>('notification');
+   return this.notificationConfig;
  }

  // æ›´æ–°ä¸šåŠ¡é€»è¾‘æ–¹æ³•
  async sendBatchNotifications() {
    // æ›¿æ¢ç¡¬ç¼–ç é…ç½®è®¿é—®
-   const batchSize = 100; // ç¡¬ç¼–ç 
+   const batchSize = this.notificationConfig.getDefaultBatchSize();

-   const timeout = 60000; // ç¡¬ç¼–ç   
+   const timeout = this.notificationConfig.getBatchTimeout();

    // ä½¿ç”¨é…ç½®éªŒè¯
+   if (!this.notificationConfig.isValidBatchSize(notifications.length)) {
+     throw new BadRequestException('Invalid batch size');
+   }
  }

  async sendToChannelByType(notification, channelType: string) {
    // æ›¿æ¢è¶…æ—¶é…ç½®è®¿é—®
-   const timeout = channelType === 'email' ? 30000 : 15000; // ç¡¬ç¼–ç 
+   const timeout = this.notificationConfig.getChannelTimeout(channelType);
  }

  private async generateNotificationWithTemplate() {
    // æ›¿æ¢æ¨¡æ¿å¸¸é‡è®¿é—®
-   const template = DEFAULT_TEXT_TEMPLATE; // å¸¸é‡
+   const template = this.notificationConfig.getDefaultTextTemplate();
  }

  private async retryFailedNotification(attempt: number) {
    // ä½¿ç”¨æ–°çš„é‡è¯•é€»è¾‘
+   if (!this.notificationConfig.isRetryMechanismEnabled()) {
+     return;
+   }

-   const delay = 1000 * Math.pow(2, attempt); // ç¡¬ç¼–ç 
+   const delay = this.notificationConfig.calculateRetryDelay(attempt);
  }
}
```

### æ­¥éª¤3.3: æ›´æ–°æ¨¡å—providers (0.5å¤©)

**ä¿®æ”¹æ–‡ä»¶**: `src/notification/notification.module.ts`

```typescript
@Module({
  // imports...
  providers: [
    // Core Services
    NotificationService,
+   NotificationConfigService,
    NotificationHistoryService,
    // å…¶ä»–providers...
  ],
  exports: [
    NotificationService,
+   NotificationConfigService,
    NotificationHistoryService,
    // å…¶ä»–exports...
  ],
})
export class NotificationModule {}
```

### æ­¥éª¤3.4: æ›´æ–°senderæœåŠ¡ (0.5å¤©)

**ä¿®æ”¹æ–‡ä»¶**: `src/notification/services/senders/*.sender.ts`

```typescript
// ä¾‹å¦‚: webhook.sender.ts
import { NotificationConfigService } from '../notification-config.service';

@Injectable()
export class WebhookSender {
  constructor(
+   private readonly notificationConfig: NotificationConfigService,
  ) {}

  async send(notification, config) {
    // ä½¿ç”¨é…ç½®æœåŠ¡è·å–è¶…æ—¶
-   const timeout = 10000; // ç¡¬ç¼–ç 
+   const timeout = this.notificationConfig.getChannelTimeout('webhook');

    // ä½¿ç”¨æ¸ é“é»˜è®¤é…ç½®
+   const defaults = this.notificationConfig.getChannelDefaults('webhook');
+   const finalConfig = { ...defaults, ...config };
  }
}
```

## ğŸ§ª é˜¶æ®µå››: æµ‹è¯•éªŒè¯å®Œå–„ (2-3å¤©)

### æ­¥éª¤4.1: åˆ›å»ºé…ç½®éªŒè¯æµ‹è¯• (1å¤©)

**åˆ›å»ºæ–‡ä»¶**: `test/jest/unit/notification/config/notification-unified.config.spec.ts`

```typescript
/**
 * Notificationç»Ÿä¸€é…ç½®æµ‹è¯•
 * ğŸ¯ éªŒè¯é…ç½®éªŒè¯ä½“ç³»çš„æ­£ç¡®æ€§å’Œç±»å‹å®‰å…¨
 */

import { validateSync } from 'class-validator';
import { plainToClass } from 'class-transformer';
import { NotificationUnifiedConfigValidation } from '../../../../../src/notification/config/notification-unified.config';

describe('NotificationUnifiedConfig', () => {
  let originalEnv: NodeJS.ProcessEnv;

  beforeEach(() => {
    originalEnv = { ...process.env };
  });

  afterEach(() => {
    process.env = originalEnv;
  });

  describe('Configuration Validation', () => {
    it('should validate default configuration successfully', () => {
      const config = new NotificationUnifiedConfigValidation();
      const errors = validateSync(config);
      expect(errors).toHaveLength(0);
    });

    it('should validate batch configuration constraints', () => {
      const config = plainToClass(NotificationUnifiedConfigValidation, {
        batch: {
          defaultBatchSize: 0, // æ— æ•ˆï¼šå°äºæœ€å°å€¼
          maxBatchSize: 50000, // æ— æ•ˆï¼šå¤§äºæœ€å¤§å€¼
          maxConcurrency: -1, // æ— æ•ˆï¼šè´Ÿæ•°
        }
      });

      const errors = validateSync(config);
      expect(errors.length).toBeGreaterThan(0);
      
      const batchErrors = errors.find(e => e.property === 'batch');
      expect(batchErrors).toBeDefined();
    });

    it('should validate timeout configuration constraints', () => {
      const config = plainToClass(NotificationUnifiedConfigValidation, {
        timeouts: {
          defaultTimeout: 500, // æ— æ•ˆï¼šå°äºæœ€å°å€¼
          emailTimeout: 200000, // æ— æ•ˆï¼šå¤§äºæœ€å¤§å€¼
        }
      });

      const errors = validateSync(config);
      expect(errors.length).toBeGreaterThan(0);
    });

    it('should validate retry configuration constraints', () => {
      const config = plainToClass(NotificationUnifiedConfigValidation, {
        retry: {
          maxRetryAttempts: 0, // æ— æ•ˆï¼šå°äºæœ€å°å€¼
          retryBackoffMultiplier: 0.5, // æ— æ•ˆï¼šå°äºæœ€å°å€¼
          jitterFactor: 1.5, // æ— æ•ˆï¼šå¤§äºæœ€å¤§å€¼
        }
      });

      const errors = validateSync(config);
      expect(errors.length).toBeGreaterThan(0);
    });
  });

  describe('Environment Variable Integration', () => {
    it('should use environment variables when provided', () => {
      process.env.NOTIFICATION_DEFAULT_BATCH_SIZE = '50';
      process.env.NOTIFICATION_DEFAULT_TIMEOUT = '20000';
      process.env.NOTIFICATION_ENABLE_BATCH_PROCESSING = 'false';

      const rawConfig = {
        batch: {
          defaultBatchSize: parseInt(process.env.NOTIFICATION_DEFAULT_BATCH_SIZE, 10),
        },
        timeouts: {
          defaultTimeout: parseInt(process.env.NOTIFICATION_DEFAULT_TIMEOUT, 10),
        },
        features: {
          enableBatchProcessing: process.env.NOTIFICATION_ENABLE_BATCH_PROCESSING !== 'false',
        }
      };

      expect(rawConfig.batch.defaultBatchSize).toBe(50);
      expect(rawConfig.timeouts.defaultTimeout).toBe(20000);
      expect(rawConfig.features.enableBatchProcessing).toBe(false);
    });

    it('should use default values when environment variables are not set', () => {
      delete process.env.NOTIFICATION_DEFAULT_BATCH_SIZE;
      delete process.env.NOTIFICATION_DEFAULT_TIMEOUT;

      const config = new NotificationUnifiedConfigValidation();
      
      expect(config.batch.defaultBatchSize).toBe(10);
      expect(config.timeouts.defaultTimeout).toBe(15000);
    });
  });

  describe('Type Safety', () => {
    it('should ensure all configuration properties have correct types', () => {
      const config = new NotificationUnifiedConfigValidation();
      
      // æ‰¹å¤„ç†é…ç½®ç±»å‹æ£€æŸ¥
      expect(typeof config.batch.defaultBatchSize).toBe('number');
      expect(typeof config.batch.maxBatchSize).toBe('number');
      expect(typeof config.batch.maxConcurrency).toBe('number');
      
      // è¶…æ—¶é…ç½®ç±»å‹æ£€æŸ¥
      expect(typeof config.timeouts.defaultTimeout).toBe('number');
      expect(typeof config.timeouts.emailTimeout).toBe('number');
      
      // åŠŸèƒ½å¼€å…³ç±»å‹æ£€æŸ¥
      expect(typeof config.features.enableBatchProcessing).toBe('boolean');
      expect(typeof config.features.enableRetryMechanism).toBe('boolean');
      
      // æ¨¡æ¿é…ç½®ç±»å‹æ£€æŸ¥
      expect(typeof config.templates.defaultTextTemplate).toBe('string');
      expect(typeof config.templates.defaultEmailSubjectTemplate).toBe('string');
    });
  });
});
```

### æ­¥éª¤4.2: åˆ›å»ºé…ç½®æœåŠ¡æµ‹è¯• (1å¤©)

**åˆ›å»ºæ–‡ä»¶**: `test/jest/unit/notification/services/notification-config.service.spec.ts`

```typescript
/**
 * NotificationConfigServiceæµ‹è¯•
 * ğŸ¯ éªŒè¯é…ç½®è®¿é—®æœåŠ¡çš„ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
 */

import { Test, TestingModule } from '@nestjs/testing';
import { NotificationConfigService } from '../../../../../src/notification/services/notification-config.service';
import { NotificationUnifiedConfig } from '../../../../../src/notification/config';

describe('NotificationConfigService', () => {
  let service: NotificationConfigService;
  let mockConfig: NotificationUnifiedConfig;

  beforeEach(async () => {
    mockConfig = {
      batch: {
        defaultBatchSize: 10,
        maxBatchSize: 100,
        maxConcurrency: 5,
        batchTimeout: 60000,
      },
      timeouts: {
        defaultTimeout: 15000,
        emailTimeout: 30000,
        smsTimeout: 5000,
        webhookTimeout: 10000,
      },
      retry: {
        maxRetryAttempts: 3,
        initialRetryDelay: 1000,
        retryBackoffMultiplier: 2,
        maxRetryDelay: 30000,
        jitterFactor: 0.1,
      },
      validation: {
        variableNameMinLength: 1,
        variableNameMaxLength: 50,
        minTemplateLength: 1,
        maxTemplateLength: 10000,
        titleMaxLength: 200,
        contentMaxLength: 2000,
      },
      features: {
        enableBatchProcessing: true,
        enableRetryMechanism: true,
        enablePriorityQueue: true,
        enableMetricsCollection: true,
      },
      templates: {
        defaultTextTemplate: 'Test template: {{message}}',
        defaultEmailSubjectTemplate: '[{{severity}}] {{ruleName}}',
      },
    } as NotificationUnifiedConfig;

    const module: TestingModule = await Test.createTestingModule({
      providers: [
        NotificationConfigService,
        {
          provide: 'notification',
          useValue: mockConfig,
        },
      ],
    }).compile();

    service = module.get<NotificationConfigService>(NotificationConfigService);
  });

  describe('Channel Timeout Logic', () => {
    it('should return correct timeout for known channel types', () => {
      expect(service.getChannelTimeout('email')).toBe(30000);
      expect(service.getChannelTimeout('sms')).toBe(5000);
      expect(service.getChannelTimeout('webhook')).toBe(10000);
    });

    it('should return default timeout for unknown channel types', () => {
      expect(service.getChannelTimeout('unknown')).toBe(15000);
      expect(service.getChannelTimeout('')).toBe(15000);
    });

    it('should handle case insensitive channel types', () => {
      expect(service.getChannelTimeout('EMAIL')).toBe(30000);
      expect(service.getChannelTimeout('Email')).toBe(30000);
    });
  });

  describe('Retry Delay Calculation', () => {
    it('should calculate exponential backoff correctly', () => {
      const delay1 = service.calculateRetryDelay(1);
      const delay2 = service.calculateRetryDelay(2);
      const delay3 = service.calculateRetryDelay(3);

      expect(delay1).toBeCloseTo(1000, -100); // ~1000ms Â±100ms (jitter)
      expect(delay2).toBeCloseTo(2000, -200); // ~2000ms Â±200ms (jitter)
      expect(delay3).toBeCloseTo(4000, -400); // ~4000ms Â±400ms (jitter)
    });

    it('should not exceed maximum delay', () => {
      const delay = service.calculateRetryDelay(10); // å¤§é‡è¯•æ¬¡æ•°
      expect(delay).toBeLessThanOrEqual(mockConfig.retry.maxRetryDelay);
    });

    it('should apply jitter correctly', () => {
      const delays = Array.from({ length: 10 }, () => service.calculateRetryDelay(1));
      const uniqueDelays = new Set(delays);
      
      // æŠ–åŠ¨åº”è¯¥äº§ç”Ÿä¸åŒçš„å»¶è¿Ÿæ—¶é—´
      expect(uniqueDelays.size).toBeGreaterThan(1);
    });
  });

  describe('Validation Methods', () => {
    it('should validate batch size correctly', () => {
      expect(service.isValidBatchSize(1)).toBe(true);
      expect(service.isValidBatchSize(50)).toBe(true);
      expect(service.isValidBatchSize(100)).toBe(true);
      
      expect(service.isValidBatchSize(0)).toBe(false);
      expect(service.isValidBatchSize(101)).toBe(false);
      expect(service.isValidBatchSize(-1)).toBe(false);
    });

    it('should validate variable name length correctly', () => {
      expect(service.isValidVariableName('a')).toBe(true);
      expect(service.isValidVariableName('validVariableName')).toBe(true);
      expect(service.isValidVariableName('a'.repeat(50))).toBe(true);
      
      expect(service.isValidVariableName('')).toBe(false);
      expect(service.isValidVariableName('a'.repeat(51))).toBe(false);
    });

    it('should validate template length correctly', () => {
      expect(service.isValidTemplateLength('a')).toBe(true);
      expect(service.isValidTemplateLength('valid template')).toBe(true);
      expect(service.isValidTemplateLength('a'.repeat(10000))).toBe(true);
      
      expect(service.isValidTemplateLength('')).toBe(false);
      expect(service.isValidTemplateLength('a'.repeat(10001))).toBe(false);
    });
  });

  describe('Feature Flags', () => {
    it('should return correct feature flag values', () => {
      expect(service.isBatchProcessingEnabled()).toBe(true);
      expect(service.isRetryMechanismEnabled()).toBe(true);
      expect(service.isPriorityQueueEnabled()).toBe(true);
      expect(service.isMetricsCollectionEnabled()).toBe(true);
    });
  });
});
```

### æ­¥éª¤4.3: åˆ›å»ºå¸¸é‡åˆ†ç±»éªŒè¯æµ‹è¯• (0.5å¤©)

**åˆ›å»ºæ–‡ä»¶**: `test/jest/unit/notification/constants/constants-classification.spec.ts`

```typescript
/**
 * å¸¸é‡åˆ†ç±»éªŒè¯æµ‹è¯•
 * ğŸ¯ éªŒè¯å¸¸é‡vsé…ç½®åˆ†ç±»çš„æ­£ç¡®æ€§
 */

import {
  NOTIFICATION_OPERATIONS,
  NOTIFICATION_MESSAGES,
  NOTIFICATION_VALIDATION_PATTERNS,
  NOTIFICATION_TEMPLATE_VARIABLES,
  NOTIFICATION_ERROR_TEMPLATES,
} from '../../../../../src/notification/constants/notification-core.constants';

describe('Constants Classification Validation', () => {
  describe('Preserved Constants', () => {
    it('should preserve operation constants (fixed business identifiers)', () => {
      expect(NOTIFICATION_OPERATIONS.SEND_NOTIFICATION).toBe('send_notification');
      expect(NOTIFICATION_OPERATIONS.SEND_BATCH_NOTIFICATIONS).toBe('send_batch_notifications');
      
      // éªŒè¯å¯¹è±¡ä¸å¯å˜æ€§
      expect(() => {
        (NOTIFICATION_OPERATIONS as any).NEW_OPERATION = 'new_operation';
      }).toThrow();
    });

    it('should preserve validation patterns (based on international standards)', () => {
      // RFC 5322 é‚®ç®±éªŒè¯
      expect(NOTIFICATION_VALIDATION_PATTERNS.EMAIL_PATTERN.test('test@example.com')).toBe(true);
      expect(NOTIFICATION_VALIDATION_PATTERNS.EMAIL_PATTERN.test('invalid-email')).toBe(false);
      
      // RFC 3986 URLéªŒè¯
      expect(NOTIFICATION_VALIDATION_PATTERNS.URL_PATTERN.test('https://example.com')).toBe(true);
      expect(NOTIFICATION_VALIDATION_PATTERNS.URL_PATTERN.test('not-a-url')).toBe(false);
      
      // E.164 ç”µè¯å·ç éªŒè¯
      expect(NOTIFICATION_VALIDATION_PATTERNS.PHONE_PATTERN.test('+1234567890')).toBe(true);
      expect(NOTIFICATION_VALIDATION_PATTERNS.PHONE_PATTERN.test('invalid-phone')).toBe(false);
    });

    it('should preserve template variables (fixed business fields)', () => {
      expect(NOTIFICATION_TEMPLATE_VARIABLES.ALERT_ID).toBe('alertId');
      expect(NOTIFICATION_TEMPLATE_VARIABLES.RULE_NAME).toBe('ruleName');
      expect(NOTIFICATION_TEMPLATE_VARIABLES.SEVERITY).toBe('severity');
    });

    it('should preserve error templates (standardized error expressions)', () => {
      expect(NOTIFICATION_ERROR_TEMPLATES.SEND_FAILED).toBe('é€šçŸ¥å‘é€å¤±è´¥: {error}');
      expect(NOTIFICATION_ERROR_TEMPLATES.TIMEOUT_ERROR).toBe('å‘é€è¶…æ—¶: {timeout}ms');
    });

    it('should preserve message constants (standardized UI text)', () => {
      expect(NOTIFICATION_MESSAGES.NOTIFICATION_SENT).toBe('é€šçŸ¥å‘é€æˆåŠŸ');
      expect(NOTIFICATION_MESSAGES.NOTIFICATION_FAILED).toBe('é€šçŸ¥å‘é€å¤±è´¥');
    });
  });

  describe('Migrated Configuration Items', () => {
    it('should verify that numeric limits are no longer in constants', () => {
      // è¿™äº›åº”è¯¥å·²ç»è¿ç§»åˆ°é…ç½®æ–‡ä»¶
      expect(NOTIFICATION_OPERATIONS).not.toHaveProperty('MAX_BATCH_SIZE');
      expect(NOTIFICATION_OPERATIONS).not.toHaveProperty('DEFAULT_TIMEOUT');
      expect(NOTIFICATION_OPERATIONS).not.toHaveProperty('MAX_RETRY_ATTEMPTS');
    });

    it('should verify that templates are no longer in constants', () => {
      // DEFAULT_TEXT_TEMPLATE åº”è¯¥å·²ç»è¿ç§»
      expect(() => {
        require('../../../../../src/notification/constants/notification-core.constants').DEFAULT_TEXT_TEMPLATE;
      }).toThrow();
    });

    it('should verify that channel configs are no longer in constants', () => {
      // DEFAULT_CHANNEL_CONFIGS åº”è¯¥å·²ç»è¿ç§»
      expect(() => {
        require('../../../../../src/notification/constants/notification-core.constants').DEFAULT_CHANNEL_CONFIGS;
      }).toThrow();
    });
  });
});
```

### æ­¥éª¤4.4: é›†æˆæµ‹è¯•å’Œæ€§èƒ½éªŒè¯ (0.5å¤©)

**åˆ›å»ºæ–‡ä»¶**: `test/jest/integration/notification/config-integration.spec.ts`

```typescript
/**
 * é…ç½®é›†æˆæµ‹è¯•
 * ğŸ¯ éªŒè¯æ•´ä¸ªé…ç½®ä½“ç³»çš„é›†æˆæ­£ç¡®æ€§
 */

import { Test, TestingModule } from '@nestjs/testing';
import { ConfigModule } from '@nestjs/config';
import { NotificationModule } from '../../../../src/notification/notification.module';
import { NotificationConfigService } from '../../../../src/notification/services/notification-config.service';
import { NotificationService } from '../../../../src/notification/services/notification.service';

describe('Notification Configuration Integration', () => {
  let module: TestingModule;
  let configService: NotificationConfigService;
  let notificationService: NotificationService;

  beforeAll(async () => {
    module = await Test.createTestingModule({
      imports: [
        ConfigModule.forRoot({ isGlobal: true }),
        NotificationModule,
      ],
    }).compile();

    configService = module.get<NotificationConfigService>(NotificationConfigService);
    notificationService = module.get<NotificationService>(NotificationService);
  });

  afterAll(async () => {
    await module.close();
  });

  describe('Configuration Loading Performance', () => {
    it('should load configuration within acceptable time', () => {
      const startTime = Date.now();
      
      // æµ‹è¯•é…ç½®è®¿é—®æ€§èƒ½
      for (let i = 0; i < 1000; i++) {
        configService.getDefaultBatchSize();
        configService.getChannelTimeout('email');
        configService.calculateRetryDelay(1);
      }
      
      const endTime = Date.now();
      const duration = endTime - startTime;
      
      // é…ç½®è®¿é—®åº”è¯¥åœ¨100mså†…å®Œæˆ1000æ¬¡è°ƒç”¨
      expect(duration).toBeLessThan(100);
    });
  });

  describe('Service Integration', () => {
    it('should inject configuration service correctly into notification service', () => {
      expect(notificationService).toBeDefined();
      expect(notificationService['notificationConfig']).toBeDefined();
    });

    it('should use configuration values in business logic', () => {
      const batchSize = configService.getDefaultBatchSize();
      expect(typeof batchSize).toBe('number');
      expect(batchSize).toBeGreaterThan(0);
    });
  });

  describe('Environment Variable Override', () => {
    it('should respect environment variable overrides', () => {
      // è¿™ä¸ªæµ‹è¯•éœ€è¦åœ¨ç‰¹å®šç¯å¢ƒå˜é‡ä¸‹è¿è¡Œ
      const originalValue = process.env.NOTIFICATION_DEFAULT_BATCH_SIZE;
      
      // æ¨¡æ‹Ÿç¯å¢ƒå˜é‡å˜æ›´
      process.env.NOTIFICATION_DEFAULT_BATCH_SIZE = '25';
      
      // é‡æ–°åŠ è½½é…ç½®åº”è¯¥åæ˜ æ–°å€¼
      // æ³¨æ„ï¼šå®é™…å®ç°å¯èƒ½éœ€è¦é‡æ–°åŠ è½½æ¨¡å—
      
      // æ¢å¤åŸå€¼
      if (originalValue !== undefined) {
        process.env.NOTIFICATION_DEFAULT_BATCH_SIZE = originalValue;
      } else {
        delete process.env.NOTIFICATION_DEFAULT_BATCH_SIZE;
      }
    });
  });
});
```

## ğŸ“Š å®æ–½éªŒæ”¶æ ‡å‡†

### âœ… **æŠ€æœ¯éªŒæ”¶æ ‡å‡†**

| éªŒæ”¶é¡¹ | ç›®æ ‡å€¼ | éªŒè¯æ–¹æ³• |
|--------|--------|----------|
| **é…ç½®éªŒè¯è¦†ç›–ç‡** | 100% | `validateSync` æµ‹è¯•è¦†ç›–æ‰€æœ‰é…ç½®é¡¹ |
| **ç¯å¢ƒå˜é‡ç²¾ç®€** | 25ä¸ªâ†’6ä¸ª (-76%) | æ¸…ç‚¹ `.env.notification.example` |
| **å¸¸é‡è¿ç§»å‡†ç¡®æ€§** | 50%å¸¸é‡è¿ç§»åˆ°é…ç½® | å¸¸é‡åˆ†ç±»éªŒè¯æµ‹è¯•é€šè¿‡ |
| **ç±»å‹å®‰å…¨** | 100%é…ç½®è®¿é—®æœ‰ç±»å‹æ£€æŸ¥ | TypeScriptç¼–è¯‘æ— è­¦å‘Š |
| **é…ç½®åŠ è½½æ€§èƒ½** | <100mså®Œæˆ1000æ¬¡é…ç½®è®¿é—® | æ€§èƒ½é›†æˆæµ‹è¯• |
| **å‘åå…¼å®¹æ€§** | æ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸ | å®Œæ•´æµ‹è¯•å¥—ä»¶é€šè¿‡ |

### ğŸ§ª **éªŒè¯å‘½ä»¤æ¸…å•**

```bash
# é˜¶æ®µéªŒè¯å‘½ä»¤
echo "=== é˜¶æ®µä¸€éªŒè¯ ==="
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/notification/config/notification-unified.config.ts
npm test -- --testPathPattern=notification/config

echo "=== é˜¶æ®µäºŒéªŒè¯ ==="  
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/notification/constants/notification-core.constants.ts
npm test -- --testPathPattern=notification/constants

echo "=== é˜¶æ®µä¸‰éªŒè¯ ==="
DISABLE_AUTO_INIT=true npm run typecheck:file -- src/notification/services/notification-config.service.ts
npm test -- --testPathPattern=notification/services

echo "=== é˜¶æ®µå››éªŒè¯ ==="
npm run test:unit:notification
npm run test:integration:notification

echo "=== æœ€ç»ˆéªŒæ”¶ ==="
npm run typecheck
npm run lint
npm run test:all
```

### ğŸ¯ **æˆåŠŸæŒ‡æ ‡**

**é…ç½®ä½“ç³»åˆè§„æ€§**:
- âœ… é›¶é…ç½®é‡å ï¼šæ‰€æœ‰é…ç½®é¡¹åªåœ¨ä¸€ä¸ªå±‚çº§å®šä¹‰
- âœ… 100%ç±»å‹å®‰å…¨ï¼šæ‰€æœ‰é…ç½®è®¿é—®éƒ½æœ‰ç¼–è¯‘æ—¶æ£€æŸ¥  
- âœ… å®Œæ•´éªŒè¯è¦†ç›–ï¼šå…³é”®é…ç½®éƒ½æœ‰è¿è¡Œæ—¶éªŒè¯
- âœ… èŒè´£åˆ†ç¦»ï¼šé…ç½®è®¿é—®å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»

**ç¯å¢ƒå˜é‡ä¼˜åŒ–**:
- âœ… 76%ç²¾ç®€ï¼šä»25ä¸ªå‡å°‘åˆ°6ä¸ªæ ¸å¿ƒå˜é‡
- âœ… è¯­ä¹‰æ¸…æ™°ï¼šä¿ç•™çš„å˜é‡æœ‰æ˜ç¡®ä¸šåŠ¡å«ä¹‰
- âœ… é»˜è®¤åˆç†ï¼šæ‰€æœ‰é…ç½®é¡¹æœ‰åˆç†é»˜è®¤å€¼

**ä»£ç è´¨é‡æå‡**:
- âœ… å¸¸é‡å‡†ç¡®åˆ†ç±»ï¼šæŒ‰å››å±‚æ ‡å‡†ä¸¥æ ¼ä¿ç•™/è¿ç§»
- âœ… æœåŠ¡èŒè´£å•ä¸€ï¼šé…ç½®è®¿é—®ç‹¬ç«‹æœåŠ¡
- âœ… æµ‹è¯•è¦†ç›–å®Œæ•´ï¼šé…ç½®ã€æœåŠ¡ã€é›†æˆå¤šå±‚æµ‹è¯•

## ğŸ”„ é£é™©ç¼“è§£ä¸å›æ»šç­–ç•¥

### âš ï¸ **é£é™©è¯†åˆ«**

1. **é…ç½®è¿ç§»é£é™©**: é…ç½®é¡¹ä¸¢å¤±æˆ–é”™è¯¯æ˜ å°„
2. **ç±»å‹å…¼å®¹é£é™©**: æœåŠ¡å±‚ç±»å‹ä¸å…¼å®¹ 
3. **æ€§èƒ½å›å½’é£é™©**: é…ç½®è®¿é—®æ€§èƒ½ä¸‹é™
4. **æµ‹è¯•è¦†ç›–é£é™©**: è¾¹ç•Œæƒ…å†µæœªè¦†ç›–

### ğŸ›¡ï¸ **ç¼“è§£æªæ–½**

```bash
# é£é™©ç¼“è§£è„šæœ¬
#!/bin/bash

echo "=== é…ç½®è¿ç§»éªŒè¯ ==="
# å¯¹æ¯”æ–°æ—§é…ç½®ç¡®ä¿ä¸€è‡´æ€§
npm run test -- --testPathPattern=config-migration-verification

echo "=== æ€§èƒ½åŸºå‡†å¯¹æ¯” ==="  
# é…ç½®è®¿é—®æ€§èƒ½ä¸èƒ½å›å½’
npm run test:perf:config

echo "=== å‘åå…¼å®¹éªŒè¯ ==="
# ç¡®ä¿ç°æœ‰APIæ— ç ´åæ€§å˜æ›´
npm run test:compatibility

echo "=== åˆ†ç¯å¢ƒéªŒè¯ ==="
# å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®éªŒè¯
NODE_ENV=development npm run test:config
NODE_ENV=test npm run test:config
NODE_ENV=production npm run test:config
```

### ğŸ”„ **å›æ»šè®¡åˆ’**

**å¿«é€Ÿå›æ»š** (< 5åˆ†é’Ÿ):
```bash
git checkout HEAD~1 -- src/notification/config/
git checkout HEAD~1 -- src/notification/constants/
npm run build && npm run test:unit:notification
```

**éƒ¨åˆ†å›æ»š** (åˆ†é˜¶æ®µ):
- é˜¶æ®µä¸€å›æ»šï¼šæ¢å¤ `notification-enhanced.config.ts`
- é˜¶æ®µäºŒå›æ»šï¼šæ¢å¤åŸ `notification.constants.ts`  
- é˜¶æ®µä¸‰å›æ»šï¼šç§»é™¤ `NotificationConfigService`

## ğŸ“‹ åˆ†ç±»ç»“æœæ€»ç»“

### **æœ€ç»ˆåˆ†ç±»ç»“æœ**

ç»è¿‡ä¸¥æ ¼æŒ‰ç…§å››å±‚é…ç½®ä½“ç³»çš„å¸¸é‡vsé…ç½®åˆ¤æ–­æ ‡å‡†åˆ†æï¼Œnotificationæ¨¡å—å¸¸é‡åˆ†ç±»å¦‚ä¸‹ï¼š

#### âœ… **ä¸¥æ ¼ä¿ç•™ä¸ºå¸¸é‡** (60é¡¹ï¼Œ50%)
- **NOTIFICATION_OPERATIONS** (15é¡¹) - ä¸šåŠ¡æ“ä½œæ ‡è¯†ï¼Œå›ºå®šä¸å˜
- **NOTIFICATION_MESSAGES** (18é¡¹) - æ ‡å‡†åŒ–æ¶ˆæ¯ï¼Œè¯­ä¹‰æ˜ç¡®
- **VALIDATION_PATTERNS** (5é¡¹) - åŸºäºå›½é™…æ ‡å‡†çš„åè®®å¸¸é‡
- **TEMPLATE_VARIABLES** (10é¡¹) - å‘Šè­¦é¢†åŸŸå›ºå®šå­—æ®µ
- **ERROR_TEMPLATES** (12é¡¹) - æ ‡å‡†åŒ–é”™è¯¯æ¨¡æ¿

#### âŒ **å¼ºåˆ¶è¿ç§»åˆ°é…ç½®** (42é¡¹ï¼Œ50%)
- **DEFAULT_TEXT_TEMPLATE** (1é¡¹) - å…·æœ‰ç¯å¢ƒå·®å¼‚æ€§
- **DEFAULT_EMAIL_SUBJECT_TEMPLATE** (1é¡¹) - å…·æœ‰è¿è¡Œæ—¶å¯å˜æ€§  
- **DEFAULT_NOTIFICATION_TEMPLATES** (15é¡¹) - éœ€è¦ç¯å¢ƒå®šåˆ¶åŒ–
- **DEFAULT_CHANNEL_CONFIGS** (25é¡¹) - æ˜æ˜¾çš„ç¯å¢ƒå·®å¼‚æ€§é…ç½®

### ğŸ¯ **å…³é”®åˆ¤æ–­ä¾æ®**

1. **ä¿ç•™å¸¸é‡**: ä¸¥æ ¼ç¬¦åˆ**å›ºå®šä¸å˜æ€§**å’Œ**ä¸šåŠ¡æ ‡å‡†æ€§**ï¼Œå¦‚åŸºäºRFCæ ‡å‡†çš„æ­£åˆ™è¡¨è¾¾å¼
2. **è¿ç§»é…ç½®**: æ˜ç¡®å…·æœ‰**ç¯å¢ƒå·®å¼‚æ€§**æˆ–**è¿è¡Œæ—¶å¯å˜æ€§**ï¼Œå¦‚æ¨¡æ¿å†…å®¹å’Œæ¸ é“é…ç½®

### ğŸ“Š **é¢„æœŸæ”¶ç›Š**
- **ç¯å¢ƒå˜é‡å‡å°‘**: 25ä¸ªâ†’6ä¸ª (-76%)
- **é…ç½®èŒè´£åˆ†ç¦»**: 50%å†…å®¹è¿ç§»åˆ°æ­£ç¡®å±‚çº§
- **ç±»å‹å®‰å…¨æå‡**: æ–°å¢42é¡¹é…ç½®éªŒè¯
- **ç»´æŠ¤æ•ˆç‡**: æ¶ˆé™¤é…ç½®æŸ¥æ‰¾æ­§ä¹‰

## ğŸ æ€»ç»“

è¿™ä¸ªä¼˜åŒ–æ–¹æ¡ˆå®Œå…¨åŸºäºå››å±‚é…ç½®ä½“ç³»æ ‡å‡†ï¼Œé€šè¿‡4ä¸ªé˜¶æ®µçš„ç³»ç»Ÿæ€§é‡æ„ï¼Œå°† notification æ¨¡å—ä»ä¸åˆè§„çŠ¶æ€è½¬å˜ä¸ºæ ‡å‡†åˆè§„æ¨¡å—ã€‚

### ğŸ¯ **æ ¸å¿ƒæˆæœ**
- **é…ç½®éªŒè¯**: 0% â†’ 100%è¦†ç›–ç‡
- **ç¯å¢ƒå˜é‡**: 25ä¸ª â†’ 6ä¸ª (-76%ç²¾ç®€)  
- **å¸¸é‡åˆ†ç±»**: 50%è¿ç§»åˆ°æ­£ç¡®å±‚çº§
- **æ¶æ„ä¼˜åŒ–**: èŒè´£åˆ†ç¦»ï¼Œç±»å‹å®‰å…¨

### ğŸ“‹ **å®æ–½ä¿éšœ**
- **åˆ†é˜¶æ®µå®æ–½**: é™ä½é£é™©ï¼Œä¾¿äºéªŒè¯
- **å®Œæ•´æµ‹è¯•**: å•å…ƒã€é›†æˆã€æ€§èƒ½å¤šç»´åº¦éªŒè¯
- **å›æ»šæœºåˆ¶**: å¿«é€Ÿæ¢å¤èƒ½åŠ›
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„å®æ–½æŒ‡å¯¼

è¯¥æ–¹æ¡ˆä¸¥æ ¼éµå¾ªå››å±‚é…ç½®ä½“ç³»çš„å¸¸é‡vsé…ç½®åˆ¤æ–­æ ‡å‡†ï¼Œç¡®ä¿æ¯ä¸ªé…ç½®é¡¹å’Œå¸¸é‡éƒ½åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œç¬¦åˆå›ºå®šä¸å˜æ€§ã€ä¸šåŠ¡æ ‡å‡†æ€§ç­‰æ ¸å¿ƒåˆ¤æ–­åŸåˆ™ã€‚é€šè¿‡è¿™æ¬¡é‡æ„ï¼Œnotification æ¨¡å—å°†æˆä¸ºé¡¹ç›®ä¸­å››å±‚é…ç½®ä½“ç³»æ ‡å‡†çš„å…¸å‹å®ç°æ¡ˆä¾‹ã€‚