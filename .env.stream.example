# Stream Components Environment Variables Example
# 流组件环境变量配置示例
# 
# 遵循环境变量命名规范：所有Stream相关变量使用STREAM_前缀
# 用于：src/core/03-fetching/stream-data-fetcher/ 和相关流处理组件
#
# 🎯 修复记录：
# - STREAM_RATE_WINDOW 替代了违规的 AUTH_RATE_LIMIT_TTL 使用
# - 建立Stream组件独立的配置边界

# ========================================
# Stream Recovery 配置
# ========================================

# Stream速率限流窗口时间（毫秒）
# 替代原来违规使用的 AUTH_RATE_LIMIT_TTL
# 用于：stream-recovery.config.ts 中的 longport 和 itick 提供商
STREAM_RATE_WINDOW=60000

# Recovery队列名称
RECOVERY_QUEUE_NAME=stream-recovery

# Recovery Worker并发数
RECOVERY_WORKER_CONCURRENCY=4

# Recovery最大重试次数
RECOVERY_MAX_RETRIES=3

# Recovery重试延迟（毫秒）
RECOVERY_RETRY_DELAY=5000

# ========================================
# Stream Rate Limiting 配置
# ========================================

# 默认QPS限制
RECOVERY_DEFAULT_QPS=100

# 默认突发大小
RECOVERY_DEFAULT_BURST=150

# Recovery速率窗口（毫秒）
RECOVERY_RATE_WINDOW=1000

# Longport提供商专用QPS限制
RECOVERY_LONGPORT_QPS=200
RECOVERY_LONGPORT_BURST=250

# iTick提供商专用QPS限制
RECOVERY_ITICK_QPS=50
RECOVERY_ITICK_BURST=75

# ========================================
# Stream Priority 配置
# ========================================

# 高优先级权重
RECOVERY_PRIORITY_HIGH=100

# 普通优先级权重
RECOVERY_PRIORITY_NORMAL=50

# 低优先级权重
RECOVERY_PRIORITY_LOW=10

# ========================================
# Stream Recovery Data 配置
# ========================================

# 最大补发时间窗口（毫秒，5分钟）
RECOVERY_MAX_WINDOW=300000

# 批量发送大小
RECOVERY_BATCH_SIZE=100

# 单次补发最大数据点
RECOVERY_MAX_DATA_POINTS=10000

# ========================================
# Stream Reconnection 配置
# ========================================

# 最大重连尝试次数
RECONNECT_MAX_ATTEMPTS=5

# 重连延迟策略类型 (fixed|linear|exponential)
RECONNECT_DELAY_TYPE=exponential

# 初始重连延迟（毫秒）
RECONNECT_INITIAL_DELAY=1000

# 最大重连延迟（毫秒）
RECONNECT_MAX_DELAY=30000

# 指数退避因子（用于exponential策略）
RECONNECT_DELAY_FACTOR=2

# 自动恢复订阅（true|false）
RECONNECT_AUTO_RESTORE=true

# 自动数据恢复（true|false）
RECONNECT_AUTO_RECOVER=true

# 恢复优先级 (high|normal|low)
RECONNECT_RECOVERY_PRIORITY=normal

# 心跳超时（毫秒）
RECONNECT_HEARTBEAT_TIMEOUT=60000

# ========================================
# Stream Cleanup 配置
# ========================================

# 保留完成任务数量
RECOVERY_CLEANUP_COMPLETE=1000

# 保留失败任务数量
RECOVERY_CLEANUP_FAIL=5000

# ========================================
# Stream Cache 相关配置
# 注意：这些变量将在AppCore统一TTL配置中管理
# ========================================

# Stream Warm Cache TTL (由 APP_STREAM_WARM_TTL 管理)
# CACHE_STREAM_WARM_TTL=300

# ========================================
# 使用说明
# ========================================
# 
# 1. 复制此文件为 .env.stream 在项目根目录
# 2. 根据实际需求调整各项参数值
# 3. 重启应用使配置生效
#
# 重要提醒：
# - 所有Stream组件相关的环境变量都应使用 STREAM_ 前缀
# - RECOVERY_ 前缀用于Stream恢复相关功能
# - RECONNECT_ 前缀用于Stream重连相关功能
# - 避免使用其他组件的环境变量前缀（如 AUTH_, CACHE_ 等）
#
# 修复历史：
# ✅ 2025-01-16: 将 AUTH_RATE_LIMIT_TTL → STREAM_RATE_WINDOW 消除组件间耦合